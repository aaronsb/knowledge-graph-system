---
match: regex
pattern: \boperator\b|docker.*kg|container|\.sh.*(start|stop|restart|status)
commands: operator\.sh|docker\s
---
# Operator Way

`operator.sh` is a shim to the operator container. Most commands delegate to scripts inside the container.

## Dev Setup (from repo)

```bash
./operator.sh init               # Guided setup (creates .env, builds containers)
./operator.sh init --headless    # Automated setup (CI/scripts)
./operator.sh start              # Start platform (uses dev overlay)
```

## Container Names

| Service | Container |
|---------|-----------|
| API | `kg-api-dev` |
| Web | `kg-web-dev` |
| Database | `knowledge-graph-postgres` |
| Storage | `knowledge-graph-garage` |
| Operator | `kg-operator` |

## Lifecycle Commands

```bash
./operator.sh start              # Start platform (infra + app)
./operator.sh stop               # Stop platform
./operator.sh stop --keep-infra  # Stop apps, keep postgres/garage
./operator.sh restart api        # Restart specific service
./operator.sh status             # Container status
./operator.sh logs api -f        # Follow logs
```

## Upgrade/Update

```bash
./operator.sh update             # Pull images only
./operator.sh upgrade            # Pull, migrate, restart
./operator.sh self-update        # Update operator container
```

## Configuration (via operator shell)

```bash
./operator.sh shell              # Enter operator container
# Inside container:
configure.py status              # Show all config
configure.py ai-provider         # Set extraction provider
configure.py embedding           # Set embedding profile
configure.py api-key <name>      # Store API key
```

Or directly:
```bash
./operator.sh admin              # Manage admin user
./operator.sh ai-provider        # Configure AI extraction
./operator.sh embedding          # Configure embeddings
./operator.sh api-key            # Store API keys
```

## Database

```bash
./operator.sh query 'SELECT ...' # Run SQL (no TTY needed)
./operator.sh pg                 # Alias for query
```

## Infrastructure

```bash
./operator.sh garage status      # Garage storage health
./operator.sh garage init        # Initialize Garage buckets
./operator.sh garage repair      # Repair Garage state
```

## Teardown

```bash
./operator.sh teardown           # Remove containers
./operator.sh teardown --full    # Remove containers + volumes (data loss!)
```

## Secrets

- `.env` - Generated by `./operator.sh init`, never edit manually
- Contains: `ENCRYPTION_KEY`, `POSTGRES_PASSWORD`, `OAUTH_SIGNING_KEY`, `INTERNAL_KEY_SERVICE_SECRET`
