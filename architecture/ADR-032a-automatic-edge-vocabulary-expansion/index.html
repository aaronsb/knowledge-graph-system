
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Multi-dimensional knowledge extraction system using Apache AGE">
      
      
        <meta name="author" content="Knowledge Graph System Contributors">
      
      
      
        <link rel="prev" href="../ADR-031-encrypted-api-key-storage/">
      
      
        <link rel="next" href="../ADR-032b-IMPLEMENTATION-NOTES/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>ADR-032: Automatic Edge Vocabulary Expansion with Intelligent Pruning - Knowledge Graph System</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#adr-032-automatic-edge-vocabulary-expansion-with-intelligent-pruning" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Knowledge Graph System" class="md-header__button md-logo" aria-label="Knowledge Graph System" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Knowledge Graph System
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ADR-032: Automatic Edge Vocabulary Expansion with Intelligent Pruning
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/aaronsb/knowledge-graph-system" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    aaronsb/knowledge-graph-system
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Knowledge Graph System" class="md-nav__button md-logo" aria-label="Knowledge Graph System" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Knowledge Graph System
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aaronsb/knowledge-graph-system" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    aaronsb/knowledge-graph-system
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation Index
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/COLD-START.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5-Minute Cold Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/DEPLOYMENT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/VOCABULARY_CATEGORIES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vocabulary Categories
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Manual
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Manual
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Graph System Manual
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Introduction
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/00-introduction/01-WHAT_AND_WHY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What is the Knowledge Graph System?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/01-getting-started/02-CLI_USAGE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg CLI Usage Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/01-getting-started/03-INGESTION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document Ingestion Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/02-configuration/01-AI_PROVIDERS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Provider Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/02-configuration/02-EXTRACTION_CONFIGURATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Extraction Configuration Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/02-configuration/03-EMBEDDING_CONFIGURATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Embedding Configuration Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/02-configuration/04-SWITCHING_EXTRACTION_PROVIDERS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Switching Extraction Providers - Quick Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/02-configuration/05-LOCAL_INFERENCE_IMPLEMENTATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local LLM Inference Implementation Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/02-configuration/06-EXTRACTION_QUALITY_COMPARISON/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Extraction Quality Comparison
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/03-integration/01-MCP_SETUP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Server Setup Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/03-integration/02-VOCABULARY_CONSOLIDATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Edge Vocabulary Consolidation Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security & Access
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security & Access
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/04-security-and-access/01-AUTHENTICATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/04-security-and-access/02-RBAC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RBAC Operations Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/04-security-and-access/03-SECURITY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/04-security-and-access/04-PASSWORD_RECOVERY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Password Recovery and Account Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Maintenance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Maintenance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/05-maintenance/01-BACKUP_RESTORE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup and Restore Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/05-maintenance/02-DATABASE_MIGRATIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Migrations Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/06-reference/01-SCHEMA_REFERENCE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PostgreSQL Schema Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/06-reference/02-USE_CASES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use Cases: Practical Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/06-reference/03-EXAMPLES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Examples: Real Queries, Real Results
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/06-reference/04-github_project_history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub Project History Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/06-reference/05-CONCEPTS_AND_TERMINOLOGY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concepts and Terminology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/06-reference/06-CONCEPT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concept: Why Knowledge Graphs, Not Just RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/06-reference/07-ENRICHMENT_JOURNEY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Enrichment Journey: From Empty Graph to Multi-Perspective Understanding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/06-reference/08-DISTRIBUTED_SHARDING_RESEARCH/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distributed Graph Database Sharding: Research and Architectural Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/06-reference/09-CYPHER_PATTERNS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced Cypher Query Patterns for Apache AGE
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/06-reference/10-OPENCYPHER_QUERIES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    openCypher Query Examples
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manual/06-reference/11-LLM_EDGE_DISCOVERY_FLOW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Edge Discovery Flow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tool Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tool Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tool &amp; API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CLI Commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    CLI Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Command Reference (Auto-Generated)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/commands/admin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg admin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/commands/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/commands/database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/commands/health/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg health
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/commands/ingest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg ingest
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/commands/job/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg job
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/commands/login/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg login
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/commands/logout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg logout
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/commands/oauth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg oauth
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/commands/ontology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg ontology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/commands/search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/commands/vocabulary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg vocabulary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    media
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    media
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/media/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Media Assets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    MCP Tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    MCP Tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Server Tool Reference (Auto-Generated)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_2" >
        
          
          <label class="md-nav__link" for="__nav_4_3_2" id="__nav_4_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    media
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    media
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mcp/media/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Media Assets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3_3" id="__nav_4_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mcp/tools/concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    concept
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mcp/tools/ingest-directory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ingest-directory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mcp/tools/ingest-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ingest-file
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mcp/tools/ingest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ingest
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mcp/tools/inspect-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    inspect-file
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mcp/tools/job/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    job
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mcp/tools/ontology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ontology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mcp/tools/search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mcp/tools/source/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    source
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    REST API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    REST API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    REST API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-001-multi-tier-agent-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-001: Multi-Tier Agent Access Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-002-node-fitness-scoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-002: Node Fitness Scoring System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-003-semantic-tool-hints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-003: Semantic Tool Hint Networks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-004-pure-graph-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-004: Pure Graph Design (Library Metaphor)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-005-source-text-tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-005: Source Text Tracking and Retrieval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-006-staging-migration-workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-006: Staging and Migration Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-011-cli-admin-separation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-011: CLI and Admin Tooling Separation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-012-api-server-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-012: API Server Architecture for Scalable Neo4j Access
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-013-unified-typescript-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-013: Unified TypeScript Client (CLI + MCP Server)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-014-job-approval-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-014: Job Approval Workflow with Pre-Ingestion Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-015-backup-restore-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-015: Backup/Restore Streaming Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-016-apache-age-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-016: Apache AGE Migration (Neo4j Replacement)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-017-sensitive-auth-verification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture Decision Record: Client-Initiated Token Revocation for Elevated Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-018-server-sent-events-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-018: Server-Sent Events for Real-Time Progress Streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-019-type-based-table-formatting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-019: Type-Based Table Formatting System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-020-admin-module-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-020: Admin Module Architecture Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-021-live-man-switch-ai-safety/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-021: Live Man Switch - AI Safety for Critical Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-022-semantic-relationship-taxonomy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-022: Semantically Sparse 30-Type Relationship Taxonomy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-023-markdown-structured-content-preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-023: Markdown Structured Content Preprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-024-multi-schema-postgresql-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-024: Multi-Schema PostgreSQL Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-025-dynamic-relationship-vocabulary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-025: Dynamic Relationship Vocabulary Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-026-autonomous-vocabulary-curation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-026: Autonomous Vocabulary Curation and Ontology Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-027-user-management-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-027: User Management API with Lightweight JWT Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-028-dynamic-rbac-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-028: Dynamic Role-Based Access Control (RBAC) System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-029-cli-theory-of-operation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-029: CLI Theory of Operation - Hybrid Unix/Domain-Specific Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-030-concept-deduplication-validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-030: Concept Deduplication Quality Validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-031-encrypted-api-key-storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-031: Encrypted API Key Storage with Container Secrets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    ADR-032: Automatic Edge Vocabulary Expansion with Intelligent Pruning
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-032: Automatic Edge Vocabulary Expansion with Intelligent Pruning
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Current Limitations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-insight" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Insight
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decision" class="md-nav__link">
    <span class="md-ellipsis">
      
        Decision
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Decision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-proactive-expansion-reactive-pruning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture: Proactive Expansion + Reactive Pruning
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture: Proactive Expansion + Reactive Pruning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-auto-expansion-during-ingestion" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Auto-Expansion During Ingestion
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Auto-Expansion During Ingestion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#category-classification-for-new-edge-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Category Classification for New Edge Types
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-sliding-window-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Sliding Window Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-aggressiveness-curve-graduated-response-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Aggressiveness Curve: Graduated Response System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Aggressiveness Curve: Graduated Response System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cubic-bezier-aggressiveness-curve" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cubic Bezier Aggressiveness Curve
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-three-tier-pruning-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Three-Tier Pruning Modes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Three-Tier Pruning Modes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mode-1-naive-algorithmic" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mode 1: Naive (Algorithmic)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mode-2-hitl-human-in-the-loop-default" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mode 2: HITL (Human-in-the-Loop) - DEFAULT
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mode-3-aitl-ai-in-the-loop" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mode 3: AITL (AI-in-the-Loop)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-value-scoring-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Value Scoring Algorithm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-protected-core-set" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Protected Core Set
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-edge-compaction-synonym-merging" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Edge Compaction (Synonym Merging)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-deletion-history-rollback" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Deletion History &amp; Rollback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-vocabulary-state-portability-backuprestore-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Vocabulary State Portability (Backup/Restore Integration)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-plan" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Plan
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-auto-expansion-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: Auto-Expansion Infrastructure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-aggressiveness-curve-naive-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: Aggressiveness Curve + Naive Mode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-hitl-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: HITL Mode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-aitl-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: AITL Mode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-rollback-analytics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 5: Rollback &amp; Analytics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Endpoints
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vocabulary-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vocabulary Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hitl-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        HITL Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aitl-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        AITL Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analytics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Analytics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Benefits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benefits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-self-regulating-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Self-Regulating System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-domain-adaptability" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Domain Adaptability
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-intelligent-oversight" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Intelligent Oversight
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-learning-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Learning System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-auditability" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Auditability
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trade-offs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trade-offs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#complexity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complexity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ai-decision-risk" class="md-nav__link">
    <span class="md-ellipsis">
      
        AI Decision Risk
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-cost" class="md-nav__link">
    <span class="md-ellipsis">
      
        Token Cost
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synonym-detection-accuracy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Synonym Detection Accuracy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring &amp; Metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring &amp; Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alerts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alerts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-governance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security &amp; Governance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security &amp; Governance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-control-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      
        Access Control (RBAC)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-trail" class="md-nav__link">
    <span class="md-ellipsis">
      
        Audit Trail
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternatives-considered" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alternatives Considered
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Alternatives Considered">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-manual-approval-for-every-type-adr-025" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Manual Approval for Every Type (ADR-025)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-unlimited-vocabulary-growth" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Unlimited Vocabulary Growth
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-time-based-pruning" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Time-Based Pruning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-no-pruning-only-expansion" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. No Pruning (Only Expansion)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-hardcoded-ifelse-threshold-logic" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Hardcoded If/Else Threshold Logic
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#success-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      
        Success Criteria
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Success Criteria">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-auto-expansion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1 (Auto-Expansion)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-hitl" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2 (HITL)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-aitl" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3 (AITL)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-rollback" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4 (Rollback)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Enhancements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Enhancements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-5-advanced-learning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 5: Advanced Learning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-6-distributed-vocabulary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 6: Distributed Vocabulary
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-032b-IMPLEMENTATION-NOTES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-032 Implementation Quick Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-033-multimodal-ingestion-configurable-prompts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-033: Multimodal Image Ingestion with Configurable Prompt System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-034-graph-visualization-query-workbench/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-034: Graph Visualization &amp; Interactive Query Explorers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-035-explorer-methods-uses-capabilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-035: Explorer Methods, Uses, and Capabilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-036-universal-visual-query-builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-036: Universal Visual Query Builder
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-037-human-guided-graph-editing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-037: Human-Guided Graph Editing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-038-official-project-apparel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-038: Official Project Apparel Design Specifications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-039-local-embedding-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-039: Local Embedding Service with Hybrid Client/Server Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-040-database-schema-migrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-040: Database Schema Migration Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-041-ai-extraction-config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-041: AI Extraction Provider Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-042-local-extraction-inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-042: Local LLM Inference for Concept Extraction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-043-single-node-resource-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-043: Single-Node Resource Management for Local Inference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-044-probabilistic-truth-convergence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-044: Probabilistic Truth Convergence Through Contradiction Resolution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-045-046-MIGRATION-PLAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migration Plan: ADR-045/046 Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-045-unified-embedding-generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-045: Unified Embedding Generation System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-046-grounding-aware-vocabulary-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-046: Grounding-Aware Vocabulary Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-047-probabilistic-vocabulary-categorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-047: Probabilistic Vocabulary Categorization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-048-vocabulary-metadata-as-graph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-048: Vocabulary Metadata as First-Class Graph
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-049-rate-limiting-and-concurrency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-049: Rate Limiting and Per-Provider Concurrency Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-050-scheduled-jobs-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-050: Scheduled Jobs System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-051a-graph-document-deduplication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-051: Graph-Based Provenance Tracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-051b-API-CHANGES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-051: API Changes for Graph-Based Document Deduplication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-052-vocabulary-expansion-consolidation-cycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-052: Vocabulary Expansion-Consolidation Cycle (The "Dreaming" Pattern)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-053-eager-vocabulary-categorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-053: Eager Vocabulary Categorization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-054-oauth-client-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-054: OAuth 2.0 Client Management for Multi-Client Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-055-cdn-serverless-deployment-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-055: CDN and Serverless Deployment Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-056-timezone-aware-datetime-utilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-056: Timezone-Aware Datetime Utilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-057a-multimodal-image-ingestion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-057: Multimodal Image Ingestion with Visual Context Injection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-057b-appendix-single-vs-two-stage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-057 Appendix: Single-Stage vs Two-Stage Image Processing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-058-polarity-axis-triangulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-058: Polarity Axis Triangulation for Grounding Calculation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-059-llm-determined-relationship-direction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-059: LLM-Determined Relationship Direction Semantics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-060-endpoint-security-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-060: API Endpoint Security Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-061-operator-pattern-lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-061: Operator Pattern for Platform Lifecycle Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-062-mcp-file-ingestion-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-062: MCP File Ingestion Security Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-063-semantic-diversity-authenticity-signal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-063: Semantic Diversity as Authenticity Signal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-064-specialized-truth-convergence-visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-064: Specialized Truth Convergence Visualizations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-065-vocabulary-based-provenance-relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-065: Vocabulary-Based Provenance Relationships
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-066-published-query-endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-066: Published Query Endpoints
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-067-web-app-workstation-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-067: Web Application Workstation Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-068-source-text-embeddings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-068: Source Text Embeddings for Grounding Truth Retrieval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-069-semantic-fuse-filesystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-069: Semantic FUSE Filesystem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-070-polarity-axis-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-070: Polarity Axis Analysis for Bidirectional Semantic Dimensions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ARCHITECTURE_DECISIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture Decision Records (ADRs)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ARCHITECTURE_OVERVIEW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Graph System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DATA_CONTRACT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Contract Pattern: Schema Governance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../QUERY_SAFETY_BASELINE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Query Safety Baseline - Technical Debt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RECURSIVE_UPSERT_ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Recursive Upsert Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Visualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/AUTO-DOCUMENTATION-STRATEGY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Auto-Documentation Strategy for CLI Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/DEV_JOURNAL_chunked_ingestion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development Journal: Chunked Ingestion System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/DEV_JOURNAL_minio_integration_and_emergent_visual_relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development Journal: MinIO Integration &amp; Emergent Visual Relationships
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/LEARNED_KNOWLEDGE_MCP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Learned Knowledge Synthesis - MCP Enhancement Plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/pattern-repetition-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pattern Repetition in Growth Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/relationship-semantics-comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Relationship Semantics: How Others Do It vs. Our Proposal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/vocabulary-direction-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vocabulary Direction Semantics Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/API_AUTH_AUDIT_RESULTS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Endpoint Authentication Audit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/API_AUTH_AUDIT_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Authentication Audit Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/API_AUTH_TESTING_RESEARCH/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Authentication Testing Research
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/INTEGRATION_TEST_NOTES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integration Test Notes - Working Commands &amp; Observations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/INTEGRATION_TEST_PLAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Graph System - Integration Test Plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/SCHEMA_MIGRATION_TEST_REPORT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PostgreSQL Schema Migration - Functional Test Report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/TEST_COVERAGE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Coverage Areas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Current Limitations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-insight" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Insight
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decision" class="md-nav__link">
    <span class="md-ellipsis">
      
        Decision
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Decision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-proactive-expansion-reactive-pruning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture: Proactive Expansion + Reactive Pruning
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture: Proactive Expansion + Reactive Pruning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-auto-expansion-during-ingestion" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Auto-Expansion During Ingestion
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Auto-Expansion During Ingestion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#category-classification-for-new-edge-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Category Classification for New Edge Types
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-sliding-window-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Sliding Window Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-aggressiveness-curve-graduated-response-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Aggressiveness Curve: Graduated Response System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Aggressiveness Curve: Graduated Response System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cubic-bezier-aggressiveness-curve" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cubic Bezier Aggressiveness Curve
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-three-tier-pruning-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Three-Tier Pruning Modes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Three-Tier Pruning Modes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mode-1-naive-algorithmic" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mode 1: Naive (Algorithmic)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mode-2-hitl-human-in-the-loop-default" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mode 2: HITL (Human-in-the-Loop) - DEFAULT
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mode-3-aitl-ai-in-the-loop" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mode 3: AITL (AI-in-the-Loop)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-value-scoring-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Value Scoring Algorithm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-protected-core-set" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Protected Core Set
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-edge-compaction-synonym-merging" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Edge Compaction (Synonym Merging)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-deletion-history-rollback" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Deletion History &amp; Rollback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-vocabulary-state-portability-backuprestore-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Vocabulary State Portability (Backup/Restore Integration)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-plan" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Plan
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-auto-expansion-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: Auto-Expansion Infrastructure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-aggressiveness-curve-naive-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: Aggressiveness Curve + Naive Mode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-hitl-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: HITL Mode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-aitl-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: AITL Mode
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-rollback-analytics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 5: Rollback &amp; Analytics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Endpoints
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vocabulary-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vocabulary Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hitl-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        HITL Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aitl-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        AITL Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analytics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Analytics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Benefits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benefits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-self-regulating-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Self-Regulating System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-domain-adaptability" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Domain Adaptability
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-intelligent-oversight" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Intelligent Oversight
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-learning-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Learning System
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-auditability" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Auditability
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trade-offs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trade-offs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#complexity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complexity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ai-decision-risk" class="md-nav__link">
    <span class="md-ellipsis">
      
        AI Decision Risk
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token-cost" class="md-nav__link">
    <span class="md-ellipsis">
      
        Token Cost
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synonym-detection-accuracy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Synonym Detection Accuracy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring &amp; Metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring &amp; Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alerts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alerts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-governance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security &amp; Governance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security &amp; Governance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-control-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      
        Access Control (RBAC)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-trail" class="md-nav__link">
    <span class="md-ellipsis">
      
        Audit Trail
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternatives-considered" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alternatives Considered
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Alternatives Considered">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-manual-approval-for-every-type-adr-025" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Manual Approval for Every Type (ADR-025)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-unlimited-vocabulary-growth" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Unlimited Vocabulary Growth
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-time-based-pruning" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Time-Based Pruning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-no-pruning-only-expansion" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. No Pruning (Only Expansion)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-hardcoded-ifelse-threshold-logic" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Hardcoded If/Else Threshold Logic
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#success-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      
        Success Criteria
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Success Criteria">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-auto-expansion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1 (Auto-Expansion)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-hitl" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2 (HITL)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-aitl" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3 (AITL)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-rollback" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4 (Rollback)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Enhancements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Enhancements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-5-advanced-learning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 5: Advanced Learning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-6-distributed-vocabulary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 6: Distributed Vocabulary
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="adr-032-automatic-edge-vocabulary-expansion-with-intelligent-pruning">ADR-032: Automatic Edge Vocabulary Expansion with Intelligent Pruning</h1>
<p><strong>Status:</strong> Proposed
<strong>Date:</strong> 2025-10-15
<strong>Deciders:</strong> System Architects
<strong>Related:</strong> ADR-022 (30-Type Taxonomy), ADR-025 (Dynamic Vocabulary), ADR-026 (Autonomous Curation)</p>
<h2 id="context">Context</h2>
<p>The current system uses a static 30-type relationship vocabulary defined in <code>src/api/constants.py</code>. While ADR-025 and ADR-026 propose dynamic vocabulary management with manual curator approval, this creates a bottleneck during high-volume ingestion.</p>
<h3 id="current-limitations">Current Limitations</h3>
<p><strong>Static Vocabulary (ADR-022):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">RELATIONSHIP_TYPES</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="s1">&#39;IMPLIES&#39;</span><span class="p">,</span> <span class="s1">&#39;SUPPORTS&#39;</span><span class="p">,</span> <span class="s1">&#39;CONTRADICTS&#39;</span><span class="p">,</span> <span class="s1">&#39;CAUSES&#39;</span><span class="p">,</span> <span class="s1">&#39;ENABLES&#39;</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="c1"># ... 25 more fixed types</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Problems:</strong>
1. <strong>Ingestion Blocking:</strong> Novel edge types from LLM extraction are rejected
2. <strong>Lost Semantics:</strong> Domain-specific relationships (e.g., <code>TRAINS_ON</code>, <code>OPTIMIZES</code> for ML) get mapped to generic types or skipped
3. <strong>Manual Bottleneck:</strong> Every new type requires code change and deployment
4. <strong>No Self-Regulation:</strong> Vocabulary can only grow, never shrink</p>
<p><strong>ADR-025 Proposed Flow (Not Implemented):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>LLM extracts &quot;OPTIMIZES&quot;  Skipped  Logged to skipped_relationships
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a> Curator reviews  Curator approves  Type added  Backfill process
</code></pre></div></p>
<p>This works but doesn't scale for rapid iteration or domain-specific ontologies.</p>
<h3 id="core-insight">Core Insight</h3>
<p><strong>Vocabulary should behave like a self-regulating cache:</strong>
- <strong>Auto-expand</strong> on first use (like cache miss  fetch)
- <strong>Value-based retention</strong> (frequently used types stay, unused types pruned)
- <strong>Sliding window</strong> (30-90 types, tunable)
- <strong>Intelligent pruning</strong> (AI or human decides what to remove when limit reached)</p>
<h2 id="decision">Decision</h2>
<p>Implement <strong>automatic edge vocabulary expansion with three-tier intelligent pruning</strong>.</p>
<h3 id="architecture-proactive-expansion-reactive-pruning">Architecture: Proactive Expansion + Reactive Pruning</h3>
<h4 id="1-auto-expansion-during-ingestion">1. Auto-Expansion During Ingestion</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">upsert_relationship</span><span class="p">(</span><span class="n">from_id</span><span class="p">,</span> <span class="n">to_id</span><span class="p">,</span> <span class="n">rel_type</span><span class="p">,</span> <span class="n">confidence</span><span class="p">):</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="sd">    Auto-expand vocabulary on first use.</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="c1"># 1. Check if type exists in vocabulary</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">canonical_type</span><span class="p">,</span> <span class="n">category</span> <span class="o">=</span> <span class="n">normalize_relationship_type</span><span class="p">(</span><span class="n">rel_type</span><span class="p">)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="k">if</span> <span class="n">canonical_type</span><span class="p">:</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>        <span class="c1"># Known type or fuzzy match</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        <span class="n">create_graph_edge</span><span class="p">(</span><span class="n">from_id</span><span class="p">,</span> <span class="n">to_id</span><span class="p">,</span> <span class="n">canonical_type</span><span class="p">,</span> <span class="n">confidence</span><span class="p">)</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>        <span class="n">increment_usage_count</span><span class="p">(</span><span class="n">canonical_type</span><span class="p">)</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>        <span class="c1"># Unknown type - AUTO-EXPAND VOCABULARY</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>        <span class="k">if</span> <span class="n">is_valid_edge_type</span><span class="p">(</span><span class="n">rel_type</span><span class="p">):</span>  <span class="c1"># Basic validation</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>            <span class="c1"># Add to vocabulary immediately</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>            <span class="n">add_to_vocabulary</span><span class="p">(</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>                <span class="n">relationship_type</span><span class="o">=</span><span class="n">rel_type</span><span class="p">,</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>                <span class="n">category</span><span class="o">=</span><span class="n">infer_category</span><span class="p">(</span><span class="n">rel_type</span><span class="p">),</span>  <span class="c1"># LLM-assisted</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Auto-added during ingestion&quot;</span><span class="p">,</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>                <span class="n">added_by</span><span class="o">=</span><span class="s2">&quot;system:auto-expansion&quot;</span><span class="p">,</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>                <span class="n">is_builtin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>                <span class="n">is_active</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>            <span class="p">)</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>            <span class="c1"># Create edge</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>            <span class="n">create_graph_edge</span><span class="p">(</span><span class="n">from_id</span><span class="p">,</span> <span class="n">to_id</span><span class="p">,</span> <span class="n">rel_type</span><span class="p">,</span> <span class="n">confidence</span><span class="p">)</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>            <span class="c1"># Log expansion</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>            <span class="n">log_vocabulary_expansion</span><span class="p">(</span><span class="n">rel_type</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>                <span class="s2">&quot;from_concept&quot;</span><span class="p">:</span> <span class="n">get_label</span><span class="p">(</span><span class="n">from_id</span><span class="p">),</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>                <span class="s2">&quot;to_concept&quot;</span><span class="p">:</span> <span class="n">get_label</span><span class="p">(</span><span class="n">to_id</span><span class="p">),</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>                <span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">current_job_id</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>            <span class="p">})</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>            <span class="c1"># Check if pruning needed</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>            <span class="k">if</span> <span class="n">get_active_vocabulary_size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">VOCAB_MAX</span><span class="p">:</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>                <span class="n">trigger_pruning_workflow</span><span class="p">()</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>            <span class="c1"># Invalid type (e.g., profanity, malformed)</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>            <span class="n">log_rejected_type</span><span class="p">(</span><span class="n">rel_type</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;validation_failed&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Validation Rules:</strong>
- Uppercase alphanumeric + underscores only
- Length: 3-50 characters
- Not in blacklist (profanity, reserved terms)
- Not reverse form (<code>_BY</code> suffix rejected)</p>
<h5 id="category-classification-for-new-edge-types">Category Classification for New Edge Types</h5>
<blockquote>
<p><strong>Note:</strong> Category classification is now handled by <strong>ADR-047: Probabilistic Vocabulary Categorization</strong> using embedding similarity to seed types with satisficing (max similarity). The approach below is superseded.</p>
</blockquote>
<p><strong>Two-Tier Vocabulary Structure:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># High-level categories (8 protected groups from ADR-022, refined in ADR-047)</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">RELATIONSHIP_CATEGORIES</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="s2">&quot;logical_truth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;IMPLIES&quot;</span><span class="p">,</span> <span class="s2">&quot;CONTRADICTS&quot;</span><span class="p">,</span> <span class="s2">&quot;PRESUPPOSES&quot;</span><span class="p">,</span> <span class="s2">&quot;EQUIVALENT_TO&quot;</span><span class="p">],</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="s2">&quot;causal&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;CAUSES&quot;</span><span class="p">,</span> <span class="s2">&quot;ENABLES&quot;</span><span class="p">,</span> <span class="s2">&quot;PREVENTS&quot;</span><span class="p">,</span> <span class="s2">&quot;INFLUENCES&quot;</span><span class="p">,</span> <span class="s2">&quot;RESULTS_FROM&quot;</span><span class="p">],</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="s2">&quot;structural&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;PART_OF&quot;</span><span class="p">,</span> <span class="s2">&quot;CONTAINS&quot;</span><span class="p">,</span> <span class="s2">&quot;COMPOSED_OF&quot;</span><span class="p">,</span> <span class="s2">&quot;SUBSET_OF&quot;</span><span class="p">,</span> <span class="s2">&quot;INSTANCE_OF&quot;</span><span class="p">],</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="s2">&quot;evidential&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SUPPORTS&quot;</span><span class="p">,</span> <span class="s2">&quot;REFUTES&quot;</span><span class="p">,</span> <span class="s2">&quot;EXEMPLIFIES&quot;</span><span class="p">,</span> <span class="s2">&quot;MEASURED_BY&quot;</span><span class="p">],</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="s2">&quot;similarity&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SIMILAR_TO&quot;</span><span class="p">,</span> <span class="s2">&quot;ANALOGOUS_TO&quot;</span><span class="p">,</span> <span class="s2">&quot;CONTRASTS_WITH&quot;</span><span class="p">,</span> <span class="s2">&quot;OPPOSITE_OF&quot;</span><span class="p">],</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="s2">&quot;temporal&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;PRECEDES&quot;</span><span class="p">,</span> <span class="s2">&quot;CONCURRENT_WITH&quot;</span><span class="p">,</span> <span class="s2">&quot;EVOLVES_INTO&quot;</span><span class="p">],</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    <span class="s2">&quot;functional&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;USED_FOR&quot;</span><span class="p">,</span> <span class="s2">&quot;REQUIRES&quot;</span><span class="p">,</span> <span class="s2">&quot;PRODUCES&quot;</span><span class="p">,</span> <span class="s2">&quot;REGULATES&quot;</span><span class="p">],</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;DEFINED_AS&quot;</span><span class="p">,</span> <span class="s2">&quot;CATEGORIZED_AS&quot;</span><span class="p">],</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Category Assignment Algorithm:</strong></p>
<p>When a new edge type is auto-added, it must be classified into an existing category:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">infer_category</span><span class="p">(</span><span class="n">new_edge_type</span><span class="p">):</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="sd">    Classify new edge type into existing category using semantic analysis.</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="sd">    Only create new category if confidence is extremely low (&lt;0.3) for ALL categories.</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="c1"># Get embeddings for the new type</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="n">new_embedding</span> <span class="o">=</span> <span class="n">generate_embedding</span><span class="p">(</span><span class="n">new_edge_type</span><span class="p">)</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="c1"># Calculate similarity to each category</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="n">category_scores</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">existing_types</span> <span class="ow">in</span> <span class="n">RELATIONSHIP_CATEGORIES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>        <span class="c1"># Average similarity to all types in this category</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>        <span class="n">similarities</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>        <span class="k">for</span> <span class="n">existing_type</span> <span class="ow">in</span> <span class="n">existing_types</span><span class="p">:</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>            <span class="n">existing_embedding</span> <span class="o">=</span> <span class="n">generate_embedding</span><span class="p">(</span><span class="n">existing_type</span><span class="p">)</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>            <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">new_embedding</span><span class="p">,</span> <span class="n">existing_embedding</span><span class="p">)</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>            <span class="n">similarities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">similarity</span><span class="p">)</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>        <span class="n">category_scores</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>            <span class="s2">&quot;avg_similarity&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">similarities</span><span class="p">),</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>            <span class="s2">&quot;max_similarity&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">similarities</span><span class="p">),</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>            <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">similarities</span><span class="p">)</span>  <span class="c1"># Use average for robustness</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>        <span class="p">}</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>    <span class="c1"># Find best-fit category</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>    <span class="n">best_category</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">category_scores</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;confidence&quot;</span><span class="p">])</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>    <span class="n">best_confidence</span> <span class="o">=</span> <span class="n">best_category</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;confidence&quot;</span><span class="p">]</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>    <span class="c1"># HIGH BAR: Only create new category if confidence &lt; 0.3 for ALL categories</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>    <span class="k">if</span> <span class="n">best_confidence</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>        <span class="c1"># Extremely poor fit to all existing categories</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>        <span class="k">return</span> <span class="n">propose_new_category</span><span class="p">(</span><span class="n">new_edge_type</span><span class="p">,</span> <span class="n">category_scores</span><span class="p">)</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>        <span class="c1"># Assign to best-fit category</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>        <span class="k">return</span> <span class="n">best_category</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
<p><strong>New Category Creation (High Bar):</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">propose_new_category</span><span class="p">(</span><span class="n">new_edge_type</span><span class="p">,</span> <span class="n">category_scores</span><span class="p">):</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="sd">    Propose a new high-level category (requires curator approval).</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="sd">    HIGH BAR: Only if confidence &lt; 0.3 for ALL existing categories.</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="c1"># Generate category name via LLM reasoning</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>        <span class="s2">&quot;new_category_name&quot;</span><span class="p">:</span> <span class="n">suggest_category_name</span><span class="p">(</span><span class="n">new_edge_type</span><span class="p">),</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>        <span class="s2">&quot;trigger_type&quot;</span><span class="p">:</span> <span class="n">new_edge_type</span><span class="p">,</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>        <span class="s2">&quot;poor_fit_evidence&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>            <span class="n">cat</span><span class="p">:</span> <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;confidence&quot;</span><span class="p">]</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>            <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">category_scores</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>        <span class="p">},</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>        <span class="s2">&quot;reasoning&quot;</span><span class="p">:</span> <span class="n">generate_category_justification</span><span class="p">(</span><span class="n">new_edge_type</span><span class="p">,</span> <span class="n">category_scores</span><span class="p">),</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;awaiting_curator_approval&quot;</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>    <span class="p">}</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>    <span class="c1"># Log proposal</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>    <span class="n">store_category_proposal</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>    <span class="c1"># FALLBACK: Temporarily assign to closest category (even if poor fit)</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>    <span class="n">fallback_category</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">category_scores</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;confidence&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>    <span class="n">notify_curator_new_category_proposal</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>    <span class="k">return</span> <span class="n">fallback_category</span>  <span class="c1"># Use fallback until approved</span>
</code></pre></div>
<p><strong>Example LLM Category Reasoning:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="s2">Analyze the relationship type &quot;</span><span class="si">{</span><span class="n">new_edge_type</span><span class="si">}</span><span class="s2">&quot; and determine if it fits existing categories:</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="s2">EXISTING CATEGORIES:</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="s2">- logical_truth: Logical entailment, contradiction, equivalence</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="s2">- causal: Cause-effect relationships, enablement</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="s2">- structural: Part-whole, composition, hierarchies</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="s2">- evidential: Evidence, support, examples</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="s2">- similarity: Likeness, analogy, contrast</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="s2">- temporal: Time-based sequences, evolution</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="s2">- functional: Purpose, requirements, usage</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="s2">- meta: Definitions, categorizations</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="s2">CONFIDENCE SCORES:</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">category_scores</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="s2">All scores &lt; 0.3 suggest poor fit to existing categories.</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="s2">Should we create a NEW category? If yes:</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="s2">1. Suggest category name (e.g., &quot;transformation&quot;, &quot;attribution&quot;)</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="s2">2. Explain semantic distinction from existing categories</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="s2">3. Predict other edge types that would belong to this category</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="s2">Return JSON:</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="se">{{</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="s2">  &quot;create_new_category&quot;: true|false,</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="s2">  &quot;suggested_name&quot;: &quot;category_name&quot;,</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="s2">  &quot;semantic_distinction&quot;: &quot;Why this doesn&#39;t fit existing categories&quot;,</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="s2">  &quot;predicted_members&quot;: [&quot;OTHER_TYPE_1&quot;, &quot;OTHER_TYPE_2&quot;],</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="s2">  &quot;confidence&quot;: 0.0-1.0</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="se">}}</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="s2">&quot;&quot;&quot;</span>
</code></pre></div>
<p><strong>Category Lifecycle Management:</strong></p>
<p>Just like edge types, categories can be merged:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">merge_categories</span><span class="p">(</span><span class="n">source_category</span><span class="p">,</span> <span class="n">target_category</span><span class="p">):</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="sd">    Merge two high-level categories.</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="sd">    Example: &quot;transformation&quot; + &quot;temporal&quot;  &quot;temporal&quot; (evolution is temporal)</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="c1"># Move all edge types from source to target</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">source_types</span> <span class="o">=</span> <span class="n">RELATIONSHIP_CATEGORIES</span><span class="p">[</span><span class="n">source_category</span><span class="p">]</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="k">for</span> <span class="n">edge_type</span> <span class="ow">in</span> <span class="n">source_types</span><span class="p">:</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        <span class="c1"># Update edge type metadata</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>        <span class="n">update_edge_category</span><span class="p">(</span><span class="n">edge_type</span><span class="p">,</span> <span class="n">target_category</span><span class="p">)</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="c1"># Update category registry</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>    <span class="n">RELATIONSHIP_CATEGORIES</span><span class="p">[</span><span class="n">target_category</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">source_types</span><span class="p">)</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>    <span class="k">del</span> <span class="n">RELATIONSHIP_CATEGORIES</span><span class="p">[</span><span class="n">source_category</span><span class="p">]</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    <span class="c1"># Audit trail</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>    <span class="n">log_category_merge</span><span class="p">(</span><span class="n">source_category</span><span class="p">,</span> <span class="n">target_category</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_types</span><span class="p">))</span>
</code></pre></div>
<p><strong>Category Protection Rules:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">CATEGORY_PROTECTION</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="s2">&quot;builtin_categories&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>        <span class="s2">&quot;logical_truth&quot;</span><span class="p">,</span> <span class="s2">&quot;causal&quot;</span><span class="p">,</span> <span class="s2">&quot;structural&quot;</span><span class="p">,</span> <span class="s2">&quot;evidential&quot;</span><span class="p">,</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>        <span class="s2">&quot;similarity&quot;</span><span class="p">,</span> <span class="s2">&quot;temporal&quot;</span><span class="p">,</span> <span class="s2">&quot;functional&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="p">],</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="s2">&quot;min_categories&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>   <span class="c1"># Never drop below original 8</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="s2">&quot;max_categories&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>  <span class="c1"># HIGH BAR: only 7 additional categories allowed</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="p">}</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">can_add_category</span><span class="p">(</span><span class="n">proposed_name</span><span class="p">):</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if new category creation is allowed.&quot;&quot;&quot;</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>    <span class="n">current_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">RELATIONSHIP_CATEGORIES</span><span class="p">)</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>    <span class="k">if</span> <span class="n">current_count</span> <span class="o">&gt;=</span> <span class="n">CATEGORY_PROTECTION</span><span class="p">[</span><span class="s2">&quot;max_categories&quot;</span><span class="p">]:</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>        <span class="c1"># At limit - must merge existing categories first</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Category limit reached (15/15). Merge existing categories first.&quot;</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Category creation allowed&quot;</span>
</code></pre></div>
<p><strong>Curator Workflow for Categories:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Review new category proposals</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>kg<span class="w"> </span>vocab<span class="w"> </span>categories<span class="w"> </span>review
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="c1"># Output:</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w"> </span>Pending<span class="w"> </span>Category<span class="w"> </span>Proposal<span class="w">                                   </span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w"> </span>Category:<span class="w"> </span><span class="s2">&quot;transformation&quot;</span><span class="w">                                  </span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w"> </span>Triggered<span class="w"> </span>by:<span class="w"> </span>TRANSFORMS<span class="w">                                    </span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">                                                             </span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w"> </span>Poor<span class="w"> </span>Fit<span class="w"> </span>Evidence:<span class="w">                                          </span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">   </span><span class="w"> </span>temporal:<span class="w"> </span><span class="m">0</span>.28<span class="w"> </span><span class="o">(</span>closest,<span class="w"> </span>but<span class="w"> </span>not<span class="w"> </span>temporal<span class="w"> </span>sequence<span class="o">)</span><span class="w">    </span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">   </span><span class="w"> </span>causal:<span class="w"> </span><span class="m">0</span>.22<span class="w"> </span><span class="o">(</span>not<span class="w"> </span>pure<span class="w"> </span>cause-effect<span class="o">)</span><span class="w">                   </span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">   </span><span class="w"> </span>structural:<span class="w"> </span><span class="m">0</span>.19<span class="w"> </span><span class="o">(</span>not<span class="w"> </span>composition<span class="o">)</span><span class="w">                      </span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">                                                             </span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w"> </span>AI<span class="w"> </span>Reasoning:<span class="w">                                               </span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w"> </span><span class="s2">&quot;TRANSFORMS implies state change without implying cause or </span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="s2"> temporal sequence. Distinct from EVOLVES_INTO (temporal)   </span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="s2"> and CAUSES (causal). Predicted members: CONVERTS,          </span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="s2"> TRANSMUTES, MORPHS_INTO.&quot;</span><span class="w">                                   </span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">                                                             </span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w"> </span><span class="o">[</span>A<span class="o">]</span>pprove<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">[</span>R<span class="o">]</span>eject<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">[</span>M<span class="o">]</span>erge<span class="w"> </span>into<span class="w"> </span>existing<span class="w"> </span>category<span class="w">     </span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="c1"># Approve new category</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>kg<span class="w"> </span>vocab<span class="w"> </span>categories<span class="w"> </span>approve<span class="w"> </span>transformation
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="c1"># Or merge into existing</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>kg<span class="w"> </span>vocab<span class="w"> </span>categories<span class="w"> </span>merge<span class="w"> </span>transformation<span class="w"> </span>--into<span class="w"> </span>temporal<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">  </span>--reason<span class="w"> </span><span class="s2">&quot;Transformation is a form of temporal evolution&quot;</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="c1"># View category stats</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>kg<span class="w"> </span>vocab<span class="w"> </span>categories<span class="w"> </span>list
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="c1"># Output:</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="w"> </span>Category<span class="w">       </span><span class="w"> </span>Edge<span class="w"> </span>Types<span class="w">    </span><span class="w"> </span>Total<span class="w"> </span>Edges<span class="w">     </span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="w"> </span>causal<span class="w">         </span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="nb">builtin</span><span class="w">     </span><span class="w"> </span><span class="m">1</span>,247<span class="w"> </span>edges<span class="w">     </span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="w">                </span><span class="w"> </span><span class="m">3</span><span class="w"> </span>custom<span class="w">      </span><span class="w">                 </span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="w"> </span>structural<span class="w">     </span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="nb">builtin</span><span class="w">     </span><span class="w"> </span><span class="m">892</span><span class="w"> </span>edges<span class="w">       </span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a><span class="w">                </span><span class="w"> </span><span class="m">1</span><span class="w"> </span>custom<span class="w">      </span><span class="w">                 </span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a><span class="w"> </span>transformation<span class="w"> </span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="nb">builtin</span><span class="w">     </span><span class="w"> </span><span class="m">34</span><span class="w"> </span>edges<span class="w"> </span><span class="o">(</span>NEW<span class="o">)</span><span class="w">  </span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a><span class="w">                </span><span class="w"> </span><span class="m">3</span><span class="w"> </span>custom<span class="w">      </span><span class="w">                 </span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>
</code></pre></div>
<p><strong>Aggressiveness Curve for Categories:</strong></p>
<p>Categories also have a sliding window, but with tighter limits:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">CATEGORY_WINDOW</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>    <span class="c1"># Original 8 categories (protected)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>   <span class="c1"># Maximum 15 categories</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    <span class="s1">&#39;merge_threshold&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>  <span class="c1"># Start flagging merge opportunities</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="p">}</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="c1"># When at 12+ categories, flag merge opportunities</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">RELATIONSHIP_CATEGORIES</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">12</span><span class="p">:</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    <span class="n">merge_suggestions</span> <span class="o">=</span> <span class="n">detect_category_merge_opportunities</span><span class="p">()</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    <span class="n">notify_curator_category_merge_suggestions</span><span class="p">(</span><span class="n">merge_suggestions</span><span class="p">)</span>
</code></pre></div>
<h4 id="2-sliding-window-parameters">2. Sliding Window Parameters</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">VOCABULARY_WINDOW</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>              <span class="c1"># Protected core (builtin types)</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>              <span class="c1"># Soft limit (trigger pruning)</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="s1">&#39;hard_limit&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>      <span class="c1"># Emergency stop (block new types)</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="s1">&#39;prune_batch_size&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># Prune N types per trigger</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="p">}</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="c1"># Tunable via API/config</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">set_vocabulary_limits</span><span class="p">(</span><span class="n">min_types</span><span class="p">,</span> <span class="n">max_types</span><span class="p">):</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust sliding window (requires curator/admin role)&quot;&quot;&quot;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    <span class="n">update_config</span><span class="p">(</span><span class="s1">&#39;vocab_min&#39;</span><span class="p">,</span> <span class="n">min_types</span><span class="p">)</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>    <span class="n">update_config</span><span class="p">(</span><span class="s1">&#39;vocab_max&#39;</span><span class="p">,</span> <span class="n">max_types</span><span class="p">)</span>
</code></pre></div>
<p><strong>Window Behavior:</strong>
- <strong>Below min (30):</strong> Never prune builtin types
- <strong>Between min-max (30-90):</strong> Stable operating range
- <strong>Above max (90+):</strong> Trigger pruning workflow
- <strong>Above hard limit (200):</strong> Block new types, force human intervention</p>
<h4 id="3-aggressiveness-curve-graduated-response-system">3. Aggressiveness Curve: Graduated Response System</h4>
<p><strong>Problem:</strong> Reactive pruning (wait until limit hit  prune) causes frequent optimization invocations and system instability.</p>
<p><strong>Solution:</strong> Graduated aggressiveness curve using <strong>Cubic Bezier interpolation</strong> (same as CSS animations), configurable via control points.</p>
<h5 id="cubic-bezier-aggressiveness-curve">Cubic Bezier Aggressiveness Curve</h5>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">CubicBezier</span><span class="p">:</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="sd">    Cubic Bezier curve for smooth, tunable aggressiveness.</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="sd">    Same math as CSS cubic-bezier(x1, y1, x2, y2).</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y2</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">bezier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate Bezier value at t (0.0 to 1.0)&quot;&quot;&quot;</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>        <span class="c1"># Cubic Bezier formula: B(t) = (1-t)P + 3(1-t)tP + 3(1-t)tP + tP</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>        <span class="c1"># Where P = (0, 0), P = (1, 1) are fixed endpoints</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>        <span class="n">cx</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>        <span class="n">bx</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cx</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>        <span class="n">ax</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cx</span> <span class="o">-</span> <span class="n">bx</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>        <span class="n">cy</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y1</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>        <span class="n">by</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cy</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>        <span class="n">ay</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">by</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>        <span class="k">return</span> <span class="p">((</span><span class="n">ay</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">by</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">cy</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">solve_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find t value for given x using Newton-Raphson&quot;&quot;&quot;</span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>        <span class="c1"># Binary search for t where bezier_x(t)  x</span>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>  <span class="c1"># Newton iterations</span>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>            <span class="n">x_guess</span> <span class="o">=</span> <span class="p">((((</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>                         <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">))</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>                        <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">))</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_guess</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>                <span class="k">break</span>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a>
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>            <span class="c1"># Derivative for Newton step</span>
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>            <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span>
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>                  <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span>
<a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>                  <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">))</span>
<a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a>
<a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
<a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a>                <span class="k">break</span>
<a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a>
<a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a>            <span class="n">t</span> <span class="o">-=</span> <span class="p">(</span><span class="n">x_guess</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">dx</span>
<a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a>
<a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a>        <span class="k">return</span> <span class="n">t</span>
<a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a>
<a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_y_for_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get aggressiveness (y) for vocabulary position (x)&quot;&quot;&quot;</span>
<a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a>        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-12-51" name="__codelineno-12-51" href="#__codelineno-12-51"></a>            <span class="k">return</span> <span class="mi">0</span>
<a id="__codelineno-12-52" name="__codelineno-12-52" href="#__codelineno-12-52"></a>        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-12-53" name="__codelineno-12-53" href="#__codelineno-12-53"></a>            <span class="k">return</span> <span class="mi">1</span>
<a id="__codelineno-12-54" name="__codelineno-12-54" href="#__codelineno-12-54"></a>        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_x</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-12-55" name="__codelineno-12-55" href="#__codelineno-12-55"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bezier</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-12-56" name="__codelineno-12-56" href="#__codelineno-12-56"></a>
<a id="__codelineno-12-57" name="__codelineno-12-57" href="#__codelineno-12-57"></a>
<a id="__codelineno-12-58" name="__codelineno-12-58" href="#__codelineno-12-58"></a><span class="c1"># Predefined curve profiles (like CSS ease functions)</span>
<a id="__codelineno-12-59" name="__codelineno-12-59" href="#__codelineno-12-59"></a><span class="n">AGGRESSIVENESS_CURVES</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-12-60" name="__codelineno-12-60" href="#__codelineno-12-60"></a>    <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="n">CubicBezier</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>           <span class="c1"># Constant rate</span>
<a id="__codelineno-12-61" name="__codelineno-12-61" href="#__codelineno-12-61"></a>    <span class="s2">&quot;ease&quot;</span><span class="p">:</span> <span class="n">CubicBezier</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>           <span class="c1"># CSS ease (default)</span>
<a id="__codelineno-12-62" name="__codelineno-12-62" href="#__codelineno-12-62"></a>    <span class="s2">&quot;ease-in&quot;</span><span class="p">:</span> <span class="n">CubicBezier</span><span class="p">(</span><span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>         <span class="c1"># Slow start, fast end</span>
<a id="__codelineno-12-63" name="__codelineno-12-63" href="#__codelineno-12-63"></a>    <span class="s2">&quot;ease-out&quot;</span><span class="p">:</span> <span class="n">CubicBezier</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>        <span class="c1"># Fast start, slow end</span>
<a id="__codelineno-12-64" name="__codelineno-12-64" href="#__codelineno-12-64"></a>    <span class="s2">&quot;ease-in-out&quot;</span><span class="p">:</span> <span class="n">CubicBezier</span><span class="p">(</span><span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>    <span class="c1"># Smooth S-curve</span>
<a id="__codelineno-12-65" name="__codelineno-12-65" href="#__codelineno-12-65"></a>    <span class="s2">&quot;aggressive&quot;</span><span class="p">:</span> <span class="n">CubicBezier</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>       <span class="c1"># Sharp acceleration near limit</span>
<a id="__codelineno-12-66" name="__codelineno-12-66" href="#__codelineno-12-66"></a>    <span class="s2">&quot;gentle&quot;</span><span class="p">:</span> <span class="n">CubicBezier</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>           <span class="c1"># Very gradual</span>
<a id="__codelineno-12-67" name="__codelineno-12-67" href="#__codelineno-12-67"></a>    <span class="s2">&quot;exponential&quot;</span><span class="p">:</span> <span class="n">CubicBezier</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>     <span class="c1"># Explosive near limit</span>
<a id="__codelineno-12-68" name="__codelineno-12-68" href="#__codelineno-12-68"></a><span class="p">}</span>
<a id="__codelineno-12-69" name="__codelineno-12-69" href="#__codelineno-12-69"></a>
<a id="__codelineno-12-70" name="__codelineno-12-70" href="#__codelineno-12-70"></a><span class="c1"># Configuration (tunable via API)</span>
<a id="__codelineno-12-71" name="__codelineno-12-71" href="#__codelineno-12-71"></a><span class="n">AGGRESSIVENESS_PROFILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;VOCAB_AGGRESSIVENESS&quot;</span><span class="p">,</span> <span class="s2">&quot;aggressive&quot;</span><span class="p">)</span>
<a id="__codelineno-12-72" name="__codelineno-12-72" href="#__codelineno-12-72"></a>
<a id="__codelineno-12-73" name="__codelineno-12-73" href="#__codelineno-12-73"></a>
<a id="__codelineno-12-74" name="__codelineno-12-74" href="#__codelineno-12-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_aggressiveness</span><span class="p">(</span><span class="n">current_size</span><span class="p">):</span>
<a id="__codelineno-12-75" name="__codelineno-12-75" href="#__codelineno-12-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-76" name="__codelineno-12-76" href="#__codelineno-12-76"></a><span class="sd">    Calculate aggressiveness (0.0-1.0) using Bezier curve.</span>
<a id="__codelineno-12-77" name="__codelineno-12-77" href="#__codelineno-12-77"></a>
<a id="__codelineno-12-78" name="__codelineno-12-78" href="#__codelineno-12-78"></a><span class="sd">    Args:</span>
<a id="__codelineno-12-79" name="__codelineno-12-79" href="#__codelineno-12-79"></a><span class="sd">        current_size: Current vocabulary size</span>
<a id="__codelineno-12-80" name="__codelineno-12-80" href="#__codelineno-12-80"></a>
<a id="__codelineno-12-81" name="__codelineno-12-81" href="#__codelineno-12-81"></a><span class="sd">    Returns:</span>
<a id="__codelineno-12-82" name="__codelineno-12-82" href="#__codelineno-12-82"></a><span class="sd">        float: Aggressiveness value (0.0 = passive, 1.0 = emergency)</span>
<a id="__codelineno-12-83" name="__codelineno-12-83" href="#__codelineno-12-83"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-12-84" name="__codelineno-12-84" href="#__codelineno-12-84"></a>    <span class="n">VOCAB_MIN</span> <span class="o">=</span> <span class="mi">30</span>
<a id="__codelineno-12-85" name="__codelineno-12-85" href="#__codelineno-12-85"></a>    <span class="n">VOCAB_MAX</span> <span class="o">=</span> <span class="mi">90</span>
<a id="__codelineno-12-86" name="__codelineno-12-86" href="#__codelineno-12-86"></a>    <span class="n">EMERGENCY</span> <span class="o">=</span> <span class="mi">200</span>
<a id="__codelineno-12-87" name="__codelineno-12-87" href="#__codelineno-12-87"></a>
<a id="__codelineno-12-88" name="__codelineno-12-88" href="#__codelineno-12-88"></a>    <span class="k">if</span> <span class="n">current_size</span> <span class="o">&lt;=</span> <span class="n">VOCAB_MIN</span><span class="p">:</span>
<a id="__codelineno-12-89" name="__codelineno-12-89" href="#__codelineno-12-89"></a>        <span class="k">return</span> <span class="mf">0.0</span>  <span class="c1"># Comfort zone</span>
<a id="__codelineno-12-90" name="__codelineno-12-90" href="#__codelineno-12-90"></a>
<a id="__codelineno-12-91" name="__codelineno-12-91" href="#__codelineno-12-91"></a>    <span class="k">if</span> <span class="n">current_size</span> <span class="o">&gt;=</span> <span class="n">EMERGENCY</span><span class="p">:</span>
<a id="__codelineno-12-92" name="__codelineno-12-92" href="#__codelineno-12-92"></a>        <span class="k">return</span> <span class="mf">1.0</span>  <span class="c1"># Hard limit</span>
<a id="__codelineno-12-93" name="__codelineno-12-93" href="#__codelineno-12-93"></a>
<a id="__codelineno-12-94" name="__codelineno-12-94" href="#__codelineno-12-94"></a>    <span class="c1"># Normalize position: 0.0 (at min)  1.0 (at max)</span>
<a id="__codelineno-12-95" name="__codelineno-12-95" href="#__codelineno-12-95"></a>    <span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_size</span> <span class="o">-</span> <span class="n">VOCAB_MIN</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">VOCAB_MAX</span> <span class="o">-</span> <span class="n">VOCAB_MIN</span><span class="p">)</span>
<a id="__codelineno-12-96" name="__codelineno-12-96" href="#__codelineno-12-96"></a>    <span class="n">position</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">position</span><span class="p">))</span>  <span class="c1"># Clamp to [0, 1]</span>
<a id="__codelineno-12-97" name="__codelineno-12-97" href="#__codelineno-12-97"></a>
<a id="__codelineno-12-98" name="__codelineno-12-98" href="#__codelineno-12-98"></a>    <span class="c1"># Apply Bezier curve</span>
<a id="__codelineno-12-99" name="__codelineno-12-99" href="#__codelineno-12-99"></a>    <span class="n">curve</span> <span class="o">=</span> <span class="n">AGGRESSIVENESS_CURVES</span><span class="p">[</span><span class="n">AGGRESSIVENESS_PROFILE</span><span class="p">]</span>
<a id="__codelineno-12-100" name="__codelineno-12-100" href="#__codelineno-12-100"></a>    <span class="n">aggressiveness</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">get_y_for_x</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
<a id="__codelineno-12-101" name="__codelineno-12-101" href="#__codelineno-12-101"></a>
<a id="__codelineno-12-102" name="__codelineno-12-102" href="#__codelineno-12-102"></a>    <span class="c1"># Boost aggressiveness if beyond soft limit</span>
<a id="__codelineno-12-103" name="__codelineno-12-103" href="#__codelineno-12-103"></a>    <span class="k">if</span> <span class="n">current_size</span> <span class="o">&gt;</span> <span class="n">VOCAB_MAX</span><span class="p">:</span>
<a id="__codelineno-12-104" name="__codelineno-12-104" href="#__codelineno-12-104"></a>        <span class="n">overage</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_size</span> <span class="o">-</span> <span class="n">VOCAB_MAX</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">EMERGENCY</span> <span class="o">-</span> <span class="n">VOCAB_MAX</span><span class="p">)</span>
<a id="__codelineno-12-105" name="__codelineno-12-105" href="#__codelineno-12-105"></a>        <span class="n">aggressiveness</span> <span class="o">=</span> <span class="n">aggressiveness</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">aggressiveness</span><span class="p">)</span> <span class="o">*</span> <span class="n">overage</span>
<a id="__codelineno-12-106" name="__codelineno-12-106" href="#__codelineno-12-106"></a>
<a id="__codelineno-12-107" name="__codelineno-12-107" href="#__codelineno-12-107"></a>    <span class="k">return</span> <span class="n">aggressiveness</span>
<a id="__codelineno-12-108" name="__codelineno-12-108" href="#__codelineno-12-108"></a>
<a id="__codelineno-12-109" name="__codelineno-12-109" href="#__codelineno-12-109"></a>
<a id="__codelineno-12-110" name="__codelineno-12-110" href="#__codelineno-12-110"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_optimization_strategy</span><span class="p">(</span><span class="n">current_size</span><span class="p">):</span>
<a id="__codelineno-12-111" name="__codelineno-12-111" href="#__codelineno-12-111"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-112" name="__codelineno-12-112" href="#__codelineno-12-112"></a><span class="sd">    Determine pruning strategy based on vocabulary size and aggressiveness curve.</span>
<a id="__codelineno-12-113" name="__codelineno-12-113" href="#__codelineno-12-113"></a><span class="sd">    Returns (action, aggressiveness, batch_size)</span>
<a id="__codelineno-12-114" name="__codelineno-12-114" href="#__codelineno-12-114"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-12-115" name="__codelineno-12-115" href="#__codelineno-12-115"></a>    <span class="n">VOCAB_MAX</span> <span class="o">=</span> <span class="mi">90</span>
<a id="__codelineno-12-116" name="__codelineno-12-116" href="#__codelineno-12-116"></a>    <span class="n">EMERGENCY</span> <span class="o">=</span> <span class="mi">200</span>
<a id="__codelineno-12-117" name="__codelineno-12-117" href="#__codelineno-12-117"></a>
<a id="__codelineno-12-118" name="__codelineno-12-118" href="#__codelineno-12-118"></a>    <span class="n">aggressiveness</span> <span class="o">=</span> <span class="n">calculate_aggressiveness</span><span class="p">(</span><span class="n">current_size</span><span class="p">)</span>
<a id="__codelineno-12-119" name="__codelineno-12-119" href="#__codelineno-12-119"></a>
<a id="__codelineno-12-120" name="__codelineno-12-120" href="#__codelineno-12-120"></a>    <span class="c1"># Map aggressiveness to action zones</span>
<a id="__codelineno-12-121" name="__codelineno-12-121" href="#__codelineno-12-121"></a>    <span class="k">if</span> <span class="n">aggressiveness</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
<a id="__codelineno-12-122" name="__codelineno-12-122" href="#__codelineno-12-122"></a>        <span class="c1"># 0-20%: Comfort zone, just monitor</span>
<a id="__codelineno-12-123" name="__codelineno-12-123" href="#__codelineno-12-123"></a>        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;monitor&quot;</span><span class="p">,</span> <span class="n">aggressiveness</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-12-124" name="__codelineno-12-124" href="#__codelineno-12-124"></a>
<a id="__codelineno-12-125" name="__codelineno-12-125" href="#__codelineno-12-125"></a>    <span class="k">elif</span> <span class="n">aggressiveness</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
<a id="__codelineno-12-126" name="__codelineno-12-126" href="#__codelineno-12-126"></a>        <span class="c1"># 20-50%: Watch zone, flag merge opportunities</span>
<a id="__codelineno-12-127" name="__codelineno-12-127" href="#__codelineno-12-127"></a>        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;watch&quot;</span><span class="p">,</span> <span class="n">aggressiveness</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-12-128" name="__codelineno-12-128" href="#__codelineno-12-128"></a>
<a id="__codelineno-12-129" name="__codelineno-12-129" href="#__codelineno-12-129"></a>    <span class="k">elif</span> <span class="n">aggressiveness</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">:</span>
<a id="__codelineno-12-130" name="__codelineno-12-130" href="#__codelineno-12-130"></a>        <span class="c1"># 50-70%: Merge zone, prefer synonym merging</span>
<a id="__codelineno-12-131" name="__codelineno-12-131" href="#__codelineno-12-131"></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ceil</span><span class="p">(</span><span class="n">aggressiveness</span> <span class="o">*</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-12-132" name="__codelineno-12-132" href="#__codelineno-12-132"></a>        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;merge&quot;</span><span class="p">,</span> <span class="n">aggressiveness</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
<a id="__codelineno-12-133" name="__codelineno-12-133" href="#__codelineno-12-133"></a>
<a id="__codelineno-12-134" name="__codelineno-12-134" href="#__codelineno-12-134"></a>    <span class="k">elif</span> <span class="n">aggressiveness</span> <span class="o">&lt;</span> <span class="mf">0.9</span><span class="p">:</span>
<a id="__codelineno-12-135" name="__codelineno-12-135" href="#__codelineno-12-135"></a>        <span class="c1"># 70-90%: Mixed zone, merge + prune</span>
<a id="__codelineno-12-136" name="__codelineno-12-136" href="#__codelineno-12-136"></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ceil</span><span class="p">(</span><span class="n">aggressiveness</span> <span class="o">*</span> <span class="mi">15</span><span class="p">))</span>
<a id="__codelineno-12-137" name="__codelineno-12-137" href="#__codelineno-12-137"></a>        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;mixed&quot;</span><span class="p">,</span> <span class="n">aggressiveness</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
<a id="__codelineno-12-138" name="__codelineno-12-138" href="#__codelineno-12-138"></a>
<a id="__codelineno-12-139" name="__codelineno-12-139" href="#__codelineno-12-139"></a>    <span class="k">elif</span> <span class="n">current_size</span> <span class="o">&lt;</span> <span class="n">EMERGENCY</span><span class="p">:</span>
<a id="__codelineno-12-140" name="__codelineno-12-140" href="#__codelineno-12-140"></a>        <span class="c1"># 90-100%: Emergency zone</span>
<a id="__codelineno-12-141" name="__codelineno-12-141" href="#__codelineno-12-141"></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">current_size</span> <span class="o">-</span> <span class="n">VOCAB_MAX</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-12-142" name="__codelineno-12-142" href="#__codelineno-12-142"></a>        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;emergency&quot;</span><span class="p">,</span> <span class="n">aggressiveness</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
<a id="__codelineno-12-143" name="__codelineno-12-143" href="#__codelineno-12-143"></a>
<a id="__codelineno-12-144" name="__codelineno-12-144" href="#__codelineno-12-144"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-145" name="__codelineno-12-145" href="#__codelineno-12-145"></a>        <span class="c1"># Hard limit reached</span>
<a id="__codelineno-12-146" name="__codelineno-12-146" href="#__codelineno-12-146"></a>        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;block&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<p><strong>Curve Profiles Visualization:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>Aggressiveness (y)
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>1.0                                          exponential
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>                                        
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>0.9                                 
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>                                
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>0.8                               aggressive
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>                              
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>0.7                       
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>                           ease-in-out
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>0.6                   
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>                  
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>0.5                  linear
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>                    
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>0.4              
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>              
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>0.3                    gentle
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>                   
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>0.2                
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>                
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>0.1          
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>            
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>0.0 
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>    30       45       60       75       90      (vocab size)
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>    min              comfort          max
</code></pre></div>
<p><strong>Configuration &amp; Tuning:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># List available profiles</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>kg<span class="w"> </span>vocab<span class="w"> </span>config<span class="w"> </span>profiles
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c1"># Output:</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="c1"># Available aggressiveness profiles:</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="c1">#   linear      - Constant rate increase</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="c1">#   ease        - Balanced (CSS default)</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="c1">#   ease-in     - Slow start, fast end</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="c1">#   ease-out    - Fast start, slow end</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="c1">#   ease-in-out - Smooth S-curve</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="c1">#   aggressive  - Sharp near limit (RECOMMENDED)</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="c1">#   gentle      - Very gradual</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="c1">#   exponential - Explosive near limit</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="c1"># Set profile</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>kg<span class="w"> </span>vocab<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>aggressiveness<span class="w"> </span>aggressive
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="c1"># View current curve</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>kg<span class="w"> </span>vocab<span class="w"> </span>config<span class="w"> </span>show<span class="w"> </span>aggressiveness
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="c1"># Output:</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="c1"># Current profile: aggressive</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="c1"># Bezier control points: (0.1, 0.0, 0.9, 1.0)</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="c1">#</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="c1"># Behavior:</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="c1">#   30-60: Very gradual (10-20% aggressive)</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="c1">#   60-75: Moderate (20-40% aggressive)</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="c1">#   75-85: Accelerating (40-70% aggressive)</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="c1">#   85-90: Sharp rise (70-95% aggressive)</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="c1">#   90+: Emergency (95-100% aggressive)</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="c1"># Custom curve (advanced)</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>kg<span class="w"> </span>vocab<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>aggressiveness-custom<span class="w"> </span><span class="m">0</span>.2,0.1,0.8,0.95
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="c1"># Test curve without applying</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a>kg<span class="w"> </span>vocab<span class="w"> </span>simulate<span class="w"> </span>--profile<span class="w"> </span>gentle<span class="w"> </span>--vocab-range<span class="w"> </span><span class="m">30</span>-95
</code></pre></div>
<p><strong>Curve Selection Guide:</strong></p>
<table>
<thead>
<tr>
<th>Profile</th>
<th>Use Case</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aggressive</code></td>
<td><strong>Production (default)</strong></td>
<td>Stay passive until 75, then accelerate sharply</td>
</tr>
<tr>
<td><code>ease-in-out</code></td>
<td>Balanced environments</td>
<td>Smooth S-curve, predictable</td>
</tr>
<tr>
<td><code>gentle</code></td>
<td>High-churn ontologies</td>
<td>Very gradual, minimizes disruption</td>
</tr>
<tr>
<td><code>exponential</code></td>
<td>Strict capacity limits</td>
<td>Explosive response near limit</td>
</tr>
<tr>
<td><code>linear</code></td>
<td>Testing/debugging</td>
<td>Constant rate, easy to predict</td>
</tr>
</tbody>
</table>
<p><strong>Strategy Zones:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>30        60        75        85  90                200
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a> COMFORT   WATCH    MERGE   M     EMERGENCY    
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>  (0%)    (10-30%) (30-60%)I X    (90-100%)    
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>                            E                  
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a> No       Detect   Prefer   D  Aggressive      
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a> Action   Only     Merging     Pruning         
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>                                
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>                            Soft Limit
</code></pre></div>
<p><strong>Decision Logic: Merge vs Prune</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">select_optimization_action</span><span class="p">(</span><span class="n">current_size</span><span class="p">,</span> <span class="n">candidates</span><span class="p">):</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="sd">    Determine whether to merge or prune based on zone and available options.</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="n">action_type</span><span class="p">,</span> <span class="n">aggressiveness</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="n">calculate_optimization_strategy</span><span class="p">(</span><span class="n">current_size</span><span class="p">)</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    <span class="k">if</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;monitor&quot;</span><span class="p">:</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>        <span class="c1"># Just flag opportunities for curator review</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>        <span class="n">synonym_pairs</span> <span class="o">=</span> <span class="n">detect_synonym_opportunities</span><span class="p">()</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>        <span class="k">if</span> <span class="n">synonym_pairs</span><span class="p">:</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>            <span class="n">log_merge_opportunities</span><span class="p">(</span><span class="n">synonym_pairs</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;flag_only&quot;</span><span class="p">)</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Don&#39;t act yet</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>    <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;merge&quot;</span><span class="p">:</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>        <span class="c1"># PREFER merging (preserves edges, reduces vocabulary)</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>        <span class="n">synonym_pairs</span> <span class="o">=</span> <span class="n">detect_synonym_opportunities</span><span class="p">()</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>        <span class="k">if</span> <span class="n">synonym_pairs</span><span class="p">:</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>            <span class="c1"># Select top N pairs by aggressiveness</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>            <span class="n">pairs_to_merge</span> <span class="o">=</span> <span class="n">synonym_pairs</span><span class="p">[:</span><span class="n">batch_size</span><span class="p">]</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>            <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;merge&quot;</span><span class="p">,</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>                <span class="s2">&quot;pairs&quot;</span><span class="p">:</span> <span class="n">pairs_to_merge</span><span class="p">,</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a>                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Proactive merging in merge zone (</span><span class="si">{</span><span class="n">current_size</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">VOCAB_MAX</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>            <span class="p">}</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>            <span class="c1"># No merge candidates, prune zero-edge types only</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>            <span class="n">zero_edge_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">edge_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>            <span class="k">if</span> <span class="n">zero_edge_types</span><span class="p">:</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>                <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>                    <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;prune&quot;</span><span class="p">,</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a>                    <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="n">zero_edge_types</span><span class="p">[:</span><span class="n">batch_size</span><span class="p">],</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a>                    <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;No merge candidates, safe zero-edge pruning&quot;</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a>                <span class="p">}</span>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a>                <span class="c1"># Can&#39;t merge or prune safely - escalate</span>
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;escalate&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;No safe optimization available&quot;</span><span class="p">}</span>
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a>
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a>    <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;mixed&quot;</span><span class="p">:</span>
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a>        <span class="c1"># Try both: merge high-similarity pairs AND prune zero-edge types</span>
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a>        <span class="n">synonym_pairs</span> <span class="o">=</span> <span class="n">detect_synonym_opportunities</span><span class="p">()</span>
<a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a>        <span class="n">zero_edge_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">edge_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a>
<a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a>        <span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a>        <span class="k">if</span> <span class="n">synonym_pairs</span><span class="p">:</span>
<a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a>            <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a>                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;merge&quot;</span><span class="p">,</span>
<a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a>                <span class="s2">&quot;pairs&quot;</span><span class="p">:</span> <span class="n">synonym_pairs</span><span class="p">[:</span><span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)]</span>
<a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a>            <span class="p">})</span>
<a id="__codelineno-16-50" name="__codelineno-16-50" href="#__codelineno-16-50"></a>        <span class="k">if</span> <span class="n">zero_edge_types</span><span class="p">:</span>
<a id="__codelineno-16-51" name="__codelineno-16-51" href="#__codelineno-16-51"></a>            <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-16-52" name="__codelineno-16-52" href="#__codelineno-16-52"></a>                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;prune&quot;</span><span class="p">,</span>
<a id="__codelineno-16-53" name="__codelineno-16-53" href="#__codelineno-16-53"></a>                <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="n">zero_edge_types</span><span class="p">[:</span><span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)]</span>
<a id="__codelineno-16-54" name="__codelineno-16-54" href="#__codelineno-16-54"></a>            <span class="p">})</span>
<a id="__codelineno-16-55" name="__codelineno-16-55" href="#__codelineno-16-55"></a>
<a id="__codelineno-16-56" name="__codelineno-16-56" href="#__codelineno-16-56"></a>        <span class="k">if</span> <span class="n">actions</span><span class="p">:</span>
<a id="__codelineno-16-57" name="__codelineno-16-57" href="#__codelineno-16-57"></a>            <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-16-58" name="__codelineno-16-58" href="#__codelineno-16-58"></a>                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;mixed&quot;</span><span class="p">,</span>
<a id="__codelineno-16-59" name="__codelineno-16-59" href="#__codelineno-16-59"></a>                <span class="s2">&quot;sub_actions&quot;</span><span class="p">:</span> <span class="n">actions</span><span class="p">,</span>
<a id="__codelineno-16-60" name="__codelineno-16-60" href="#__codelineno-16-60"></a>                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Mixed optimization in prune zone (</span><span class="si">{</span><span class="n">current_size</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">VOCAB_MAX</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-16-61" name="__codelineno-16-61" href="#__codelineno-16-61"></a>            <span class="p">}</span>
<a id="__codelineno-16-62" name="__codelineno-16-62" href="#__codelineno-16-62"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-16-63" name="__codelineno-16-63" href="#__codelineno-16-63"></a>            <span class="c1"># Last resort: prune low-value types with edges</span>
<a id="__codelineno-16-64" name="__codelineno-16-64" href="#__codelineno-16-64"></a>            <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-16-65" name="__codelineno-16-65" href="#__codelineno-16-65"></a>                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;prune&quot;</span><span class="p">,</span>
<a id="__codelineno-16-66" name="__codelineno-16-66" href="#__codelineno-16-66"></a>                <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="n">candidates</span><span class="p">[:</span><span class="n">batch_size</span><span class="p">],</span>
<a id="__codelineno-16-67" name="__codelineno-16-67" href="#__codelineno-16-67"></a>                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Emergency pruning: all safe options exhausted&quot;</span>
<a id="__codelineno-16-68" name="__codelineno-16-68" href="#__codelineno-16-68"></a>            <span class="p">}</span>
<a id="__codelineno-16-69" name="__codelineno-16-69" href="#__codelineno-16-69"></a>
<a id="__codelineno-16-70" name="__codelineno-16-70" href="#__codelineno-16-70"></a>    <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;emergency&quot;</span><span class="p">:</span>
<a id="__codelineno-16-71" name="__codelineno-16-71" href="#__codelineno-16-71"></a>        <span class="c1"># Aggressive: prune anything low-value, merge anything similar</span>
<a id="__codelineno-16-72" name="__codelineno-16-72" href="#__codelineno-16-72"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-16-73" name="__codelineno-16-73" href="#__codelineno-16-73"></a>            <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;emergency_prune&quot;</span><span class="p">,</span>
<a id="__codelineno-16-74" name="__codelineno-16-74" href="#__codelineno-16-74"></a>            <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="n">candidates</span><span class="p">[:</span><span class="n">batch_size</span><span class="p">],</span>
<a id="__codelineno-16-75" name="__codelineno-16-75" href="#__codelineno-16-75"></a>            <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Emergency: vocabulary at </span><span class="si">{</span><span class="n">current_size</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">VOCAB_MAX</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-16-76" name="__codelineno-16-76" href="#__codelineno-16-76"></a>        <span class="p">}</span>
<a id="__codelineno-16-77" name="__codelineno-16-77" href="#__codelineno-16-77"></a>
<a id="__codelineno-16-78" name="__codelineno-16-78" href="#__codelineno-16-78"></a>    <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
<a id="__codelineno-16-79" name="__codelineno-16-79" href="#__codelineno-16-79"></a>        <span class="c1"># Hard stop</span>
<a id="__codelineno-16-80" name="__codelineno-16-80" href="#__codelineno-16-80"></a>        <span class="k">raise</span> <span class="n">VocabularyLimitExceeded</span><span class="p">(</span>
<a id="__codelineno-16-81" name="__codelineno-16-81" href="#__codelineno-16-81"></a>            <span class="sa">f</span><span class="s2">&quot;Hard limit reached (</span><span class="si">{</span><span class="n">current_size</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">EMERGENCY</span><span class="si">}</span><span class="s2">). &quot;</span>
<a id="__codelineno-16-82" name="__codelineno-16-82" href="#__codelineno-16-82"></a>            <span class="sa">f</span><span class="s2">&quot;Manual curator intervention required.&quot;</span>
<a id="__codelineno-16-83" name="__codelineno-16-83" href="#__codelineno-16-83"></a>        <span class="p">)</span>
</code></pre></div>
<p><strong>Merge vs Prune Decision Tree:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a> Need to reduce vocabulary by N types       
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>                  
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>                  
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>         
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>          Check synonyms 
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>         
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>                  
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>         
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>                          
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>    [Synonyms Found]  [No Synonyms]
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>                          
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>                          
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>     
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>   MERGE pairs      Check zero-  
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>   (preserves       edge types   
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>    edges)         
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>            
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>                     
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>                                 
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>                [Found]      [None Found]
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>                                 
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>                                 
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>                
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>               PRUNE       PRUNE    
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>               zero-edge   low-value
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a>               (safe)      (lossy)  
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>                
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>                                
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a>         
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>                    
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a>                    
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a>            
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a>             Batch actions 
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a>             to reduce     
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a>             invocations   
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a>            
</code></pre></div>
<p><strong>Batching Strategy:</strong></p>
<p>Instead of: "Hit 91  prune 1  hit 91 again  prune 1  repeat"</p>
<p>Do this: "Hit 90  prune/merge 5  back to 85  comfortable for longer"</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute_batched_optimization</span><span class="p">(</span><span class="n">current_size</span><span class="p">):</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="sd">    Batch optimizations to reduce invocation frequency.</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    <span class="k">if</span> <span class="n">current_size</span> <span class="o">&lt;=</span> <span class="n">VOCAB_MAX</span><span class="p">:</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>        <span class="k">return</span>  <span class="c1"># No action needed</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>    <span class="c1"># Calculate how much to prune</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>    <span class="n">excess</span> <span class="o">=</span> <span class="n">current_size</span> <span class="o">-</span> <span class="n">VOCAB_MAX</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>    <span class="n">buffer</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Create buffer to avoid immediate re-trigger</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>    <span class="n">target_reduction</span> <span class="o">=</span> <span class="n">excess</span> <span class="o">+</span> <span class="n">buffer</span>  <span class="c1"># Remove more than minimum</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>    <span class="c1"># Get optimization strategy</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>    <span class="n">strategy</span> <span class="o">=</span> <span class="n">select_optimization_action</span><span class="p">(</span><span class="n">current_size</span><span class="p">,</span> <span class="n">get_candidates</span><span class="p">())</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>    <span class="k">if</span> <span class="n">strategy</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;merge&quot;</span><span class="p">:</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>        <span class="c1"># Merging: each pair removes 1 type from active vocabulary</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>        <span class="n">pairs_needed</span> <span class="o">=</span> <span class="n">target_reduction</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>        <span class="n">execute_merges</span><span class="p">(</span><span class="n">strategy</span><span class="p">[</span><span class="s2">&quot;pairs&quot;</span><span class="p">][:</span><span class="n">pairs_needed</span><span class="p">])</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>    <span class="k">elif</span> <span class="n">strategy</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;mixed&quot;</span><span class="p">:</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>        <span class="c1"># Do both (more efficient)</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>        <span class="n">merges_completed</span> <span class="o">=</span> <span class="n">execute_merges</span><span class="p">(</span><span class="n">strategy</span><span class="p">[</span><span class="s2">&quot;sub_actions&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;pairs&quot;</span><span class="p">])</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>        <span class="n">remaining</span> <span class="o">=</span> <span class="n">target_reduction</span> <span class="o">-</span> <span class="n">merges_completed</span>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>        <span class="n">execute_prunes</span><span class="p">(</span><span class="n">strategy</span><span class="p">[</span><span class="s2">&quot;sub_actions&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;types&quot;</span><span class="p">][:</span><span class="n">remaining</span><span class="p">])</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>    <span class="k">elif</span> <span class="n">strategy</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;prune&quot;</span><span class="p">:</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>        <span class="n">execute_prunes</span><span class="p">(</span><span class="n">strategy</span><span class="p">[</span><span class="s2">&quot;types&quot;</span><span class="p">][:</span><span class="n">target_reduction</span><span class="p">])</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a>    <span class="n">log_optimization</span><span class="p">(</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>        <span class="n">action</span><span class="o">=</span><span class="n">strategy</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">],</span>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>        <span class="n">types_removed</span><span class="o">=</span><span class="n">target_reduction</span><span class="p">,</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>        <span class="n">new_size</span><span class="o">=</span><span class="n">current_size</span> <span class="o">-</span> <span class="n">target_reduction</span><span class="p">,</span>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>        <span class="n">buffer_created</span><span class="o">=</span><span class="n">buffer</span>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>    <span class="p">)</span>
</code></pre></div>
<p><strong>Benefits of Graduated Approach:</strong></p>
<ol>
<li><strong>Reduced invocations:</strong> Proactive + batched = fewer optimization runs</li>
<li><strong>Preference for merging:</strong> Preserves graph data while reducing vocabulary</li>
<li><strong>Predictable behavior:</strong> Clear rules for when/how to optimize</li>
<li><strong>Buffer zones:</strong> Creating headroom prevents constant re-triggering</li>
<li><strong>Early warning:</strong> Monitor zone gives visibility before action required</li>
</ol>
<p><strong>Example Scenario:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>Vocabulary grows from 60  92 types over 1 week:
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>Without aggressiveness curve:
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>- Hit 91  prune 1 type  back to 90
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>- Hit 91  prune 1 type  back to 90
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>- Hit 91  prune 1 type  back to 90
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>- Hit 92  prune 2 types  back to 90
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>Total: 4 optimization invocations, 5 types pruned
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>With aggressiveness curve:
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>- 60-75: Monitor, no action (flagged 3 synonym pairs)
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>- 75: Merged 2 synonym pairs  back to 73
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>- 85: Mixed optimization (merge 2, prune 3)  back to 80
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>- 90: Emergency batch (prune 7)  back to 83
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>Total: 3 optimization invocations, 12 types removed
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>Result: More stable, fewer invocations, better buffer
</code></pre></div>
<h4 id="4-three-tier-pruning-modes">4. Three-Tier Pruning Modes</h4>
<p><strong>Mode Selection:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">VOCABULARY_PRUNING_MODE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;VOCAB_PRUNING_MODE&quot;</span><span class="p">,</span> <span class="s2">&quot;aitl&quot;</span><span class="p">)</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="c1"># Options: &quot;naive&quot; | &quot;hitl&quot; | &quot;aitl&quot;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">AITL_CONFIDENCE_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.7</span>  <span class="c1"># Fallback to HITL if AI confidence &lt; 0.7</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="n">AITL_REASONING_MODEL</span> <span class="o">=</span> <span class="s2">&quot;claude-3-5-sonnet-20241022&quot;</span>
</code></pre></div></p>
<h5 id="mode-1-naive-algorithmic">Mode 1: Naive (Algorithmic)</h5>
<p>Pure bottom-up pruning, no intelligence:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">naive_prune</span><span class="p">():</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="sd">    Automatic pruning based purely on value scores.</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="sd">    Use cases: Testing, CI/CD, low-stakes environments</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>    <span class="n">candidates</span> <span class="o">=</span> <span class="n">get_custom_types_ordered_by_value</span><span class="p">()</span>  <span class="c1"># ASC</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>    <span class="n">prune_count</span> <span class="o">=</span> <span class="n">get_active_vocabulary_size</span><span class="p">()</span> <span class="o">-</span> <span class="n">VOCAB_MAX</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>    <span class="n">to_prune</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[:</span><span class="n">prune_count</span><span class="p">]</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>    <span class="k">for</span> <span class="n">type_obj</span> <span class="ow">in</span> <span class="n">to_prune</span><span class="p">:</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>        <span class="k">if</span> <span class="n">type_obj</span><span class="o">.</span><span class="n">edge_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>            <span class="n">delete_type</span><span class="p">(</span><span class="n">type_obj</span><span class="o">.</span><span class="n">relationship_type</span><span class="p">)</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>            <span class="n">deprecate_type</span><span class="p">(</span><span class="n">type_obj</span><span class="o">.</span><span class="n">relationship_type</span><span class="p">,</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>                          <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Naive pruning: low value score&quot;</span><span class="p">)</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>    <span class="n">log_pruning</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;naive&quot;</span><span class="p">,</span> <span class="n">pruned</span><span class="o">=</span><span class="n">to_prune</span><span class="p">)</span>
</code></pre></div>
<h5 id="mode-2-hitl-human-in-the-loop-default">Mode 2: HITL (Human-in-the-Loop) - DEFAULT</h5>
<p>System recommends, human approves:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">hitl_prune</span><span class="p">():</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="sd">    Generate recommendation, await curator approval.</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="sd">    Use cases: Production, high-stakes decisions, learning preferences</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>    <span class="n">candidates</span> <span class="o">=</span> <span class="n">get_custom_types_ordered_by_value</span><span class="p">()</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>    <span class="n">prune_count</span> <span class="o">=</span> <span class="n">get_active_vocabulary_size</span><span class="p">()</span> <span class="o">-</span> <span class="n">VOCAB_MAX</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>    <span class="c1"># Generate recommendation</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>    <span class="n">recommendation</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">generate_recommendation_id</span><span class="p">(),</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">(),</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>        <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;vocabulary_limit_exceeded&quot;</span><span class="p">,</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>        <span class="s2">&quot;current_state&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>            <span class="s2">&quot;active_types&quot;</span><span class="p">:</span> <span class="n">get_active_vocabulary_size</span><span class="p">(),</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>            <span class="s2">&quot;max_limit&quot;</span><span class="p">:</span> <span class="n">VOCAB_MAX</span><span class="p">,</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>            <span class="s2">&quot;prune_needed&quot;</span><span class="p">:</span> <span class="n">prune_count</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>        <span class="p">},</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>        <span class="s2">&quot;suggested_actions&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>            <span class="p">{</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;prune&quot;</span><span class="p">,</span>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>                <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">relationship_type</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">[:</span><span class="n">prune_count</span><span class="p">]],</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>                <span class="s2">&quot;rationale&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">format_rationale</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">[:</span><span class="n">prune_count</span><span class="p">]]</span>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>            <span class="p">},</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>            <span class="p">{</span>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;merge&quot;</span><span class="p">,</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>                <span class="s2">&quot;opportunities&quot;</span><span class="p">:</span> <span class="n">detect_synonym_pairs</span><span class="p">(</span><span class="n">candidates</span><span class="p">),</span>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>                <span class="s2">&quot;impact_analysis&quot;</span><span class="p">:</span> <span class="n">calculate_merge_impact</span><span class="p">()</span>
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>            <span class="p">}</span>
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>        <span class="p">],</span>
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a>        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;awaiting_approval&quot;</span>
<a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a>    <span class="p">}</span>
<a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a>
<a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a>    <span class="n">store_recommendation</span><span class="p">(</span><span class="n">recommendation</span><span class="p">)</span>
<a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a>    <span class="n">notify_curator</span><span class="p">(</span><span class="n">recommendation</span><span class="p">)</span>
<a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a>
<a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a>    <span class="c1"># Block further auto-expansion until approved</span>
<a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a>    <span class="n">set_expansion_paused</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p><strong>Curator CLI Workflow:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>kg<span class="w"> </span>vocab<span class="w"> </span>review
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="c1"># Output:</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w"> </span>Vocabulary<span class="w"> </span>Status:<span class="w"> </span><span class="m">92</span>/90<span class="w"> </span>types<span class="w"> </span><span class="o">(</span>OVER<span class="w"> </span>LIMIT<span class="o">)</span><span class="w">                </span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w"> </span>RECOMMENDED<span class="w"> </span>ACTIONS:<span class="w">                                        </span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">                                                             </span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w"> </span><span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>PRUNE<span class="w"> </span><span class="m">2</span><span class="w"> </span>low-value<span class="w"> </span>types:<span class="w">                               </span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">     </span><span class="w"> </span>CREATES<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="w"> </span>edges,<span class="w"> </span>never<span class="w"> </span>used<span class="o">)</span><span class="w">                        </span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">     </span><span class="w"> </span>FEEDS_INTO<span class="w"> </span><span class="o">(</span><span class="m">3</span><span class="w"> </span>edges,<span class="w"> </span><span class="m">0</span><span class="w"> </span>traversals,<span class="w"> </span>score:<span class="w"> </span><span class="m">0</span>.02<span class="o">)</span><span class="w">     </span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">                                                             </span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w"> </span><span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span>MERGE<span class="w"> </span><span class="m">1</span><span class="w"> </span>synonym<span class="w"> </span>pair:<span class="w">                                  </span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">     </span><span class="w"> </span>AUTHORED_BY<span class="w"> </span><span class="w"> </span>CREATED_BY<span class="w"> </span><span class="o">(</span><span class="m">94</span>%<span class="w"> </span>similar<span class="o">)</span><span class="w">               </span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">                                                             </span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w"> </span>Approve<span class="w"> </span>all?<span class="w"> </span><span class="o">[</span>Y/n<span class="o">]</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>Review<span class="w"> </span>individually?<span class="w"> </span><span class="o">[</span>i<span class="o">]</span><span class="w">             </span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="c1"># One-click approval</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>kg<span class="w"> </span>vocab<span class="w"> </span>approve-all
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="c1"># Or selective</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>kg<span class="w"> </span>vocab<span class="w"> </span>approve<span class="w"> </span>recommendation<span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># Just prune</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>kg<span class="w"> </span>vocab<span class="w"> </span>reject<span class="w"> </span>recommendation<span class="w"> </span><span class="m">2</span><span class="w">   </span><span class="c1"># Keep synonyms separate</span>
</code></pre></div></p>
<h5 id="mode-3-aitl-ai-in-the-loop">Mode 3: AITL (AI-in-the-Loop)</h5>
<p><strong>Tactical decision layer with strategic human oversight:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AITLVocabularyCurator</span><span class="p">:</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="sd">    AI makes tactical decisions, human provides strategic oversight.</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reasoning_model</span> <span class="o">=</span> <span class="n">get_provider</span><span class="p">(</span><span class="n">AITL_REASONING_MODEL</span><span class="p">)</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">decision_history</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">curator_corrections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_learned_preferences</span><span class="p">()</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_pruning_decision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="sd">        AI analyzes context and makes decision with detailed reasoning.</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>        <span class="c1"># Build prompt with context</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>        <span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_reasoning_prompt</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>        <span class="c1"># Get AI decision</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reasoning_model</span><span class="o">.</span><span class="n">complete</span><span class="p">(</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>            <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>            <span class="n">response_format</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;json_object&quot;</span><span class="p">}</span>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>        <span class="p">)</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>        <span class="n">decision</span> <span class="o">=</span> <span class="n">parse_decision</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>        <span class="c1"># Log with full justification</span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_decision</span><span class="p">(</span><span class="n">decision</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>        <span class="c1"># Check confidence threshold</span>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>        <span class="k">if</span> <span class="n">decision</span><span class="p">[</span><span class="s2">&quot;confidence&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">AITL_CONFIDENCE_THRESHOLD</span><span class="p">:</span>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>            <span class="c1"># Fallback to HITL</span>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escalate_to_human</span><span class="p">(</span><span class="n">decision</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>
<a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a>        <span class="c1"># Execute decision</span>
<a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_decision</span><span class="p">(</span><span class="n">decision</span><span class="p">)</span>
<a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a>
<a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_build_reasoning_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Build prompt with learned preferences.&quot;&quot;&quot;</span>
<a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a><span class="s2">You are a knowledge graph vocabulary curator. Analyze this optimization scenario:</span>
<a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a>
<a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a><span class="s2">CURRENT STATE:</span>
<a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a><span class="s2">- Active types: </span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;active_types&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (limit: </span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;max_limit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span>
<a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a><span class="s2">- Recent ingestions: </span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;recent_ingestions&#39;</span><span class="p">]</span><span class="si">}</span>
<a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a><span class="s2">- Domain: </span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span><span class="si">}</span>
<a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a>
<a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a><span class="s2">PRUNING CANDIDATES (by value score):</span>
<a id="__codelineno-24-48" name="__codelineno-24-48" href="#__codelineno-24-48"></a><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;candidates&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span>
<a id="__codelineno-24-49" name="__codelineno-24-49" href="#__codelineno-24-49"></a>
<a id="__codelineno-24-50" name="__codelineno-24-50" href="#__codelineno-24-50"></a><span class="s2">MERGE OPPORTUNITIES:</span>
<a id="__codelineno-24-51" name="__codelineno-24-51" href="#__codelineno-24-51"></a><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;merge_opportunities&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span>
<a id="__codelineno-24-52" name="__codelineno-24-52" href="#__codelineno-24-52"></a>
<a id="__codelineno-24-53" name="__codelineno-24-53" href="#__codelineno-24-53"></a><span class="s2">LEARNED CURATOR PREFERENCES:</span>
<a id="__codelineno-24-54" name="__codelineno-24-54" href="#__codelineno-24-54"></a><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curator_corrections</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span>
<a id="__codelineno-24-55" name="__codelineno-24-55" href="#__codelineno-24-55"></a>
<a id="__codelineno-24-56" name="__codelineno-24-56" href="#__codelineno-24-56"></a><span class="s2">TASKS:</span>
<a id="__codelineno-24-57" name="__codelineno-24-57" href="#__codelineno-24-57"></a><span class="s2">1. Decide: prune, merge, or reject (raise limit)</span>
<a id="__codelineno-24-58" name="__codelineno-24-58" href="#__codelineno-24-58"></a><span class="s2">2. Select specific types/pairs</span>
<a id="__codelineno-24-59" name="__codelineno-24-59" href="#__codelineno-24-59"></a><span class="s2">3. Analyze impact on graph connectivity</span>
<a id="__codelineno-24-60" name="__codelineno-24-60" href="#__codelineno-24-60"></a><span class="s2">4. Assess future regret probability</span>
<a id="__codelineno-24-61" name="__codelineno-24-61" href="#__codelineno-24-61"></a><span class="s2">5. Provide detailed reasoning</span>
<a id="__codelineno-24-62" name="__codelineno-24-62" href="#__codelineno-24-62"></a>
<a id="__codelineno-24-63" name="__codelineno-24-63" href="#__codelineno-24-63"></a><span class="s2">Return JSON:</span>
<a id="__codelineno-24-64" name="__codelineno-24-64" href="#__codelineno-24-64"></a><span class="se">{{</span>
<a id="__codelineno-24-65" name="__codelineno-24-65" href="#__codelineno-24-65"></a><span class="s2">  &quot;decision&quot;: &quot;prune&quot; | &quot;merge&quot; | &quot;reject&quot;,</span>
<a id="__codelineno-24-66" name="__codelineno-24-66" href="#__codelineno-24-66"></a><span class="s2">  &quot;selected_actions&quot;: [</span>
<a id="__codelineno-24-67" name="__codelineno-24-67" href="#__codelineno-24-67"></a><span class="s2">    </span><span class="se">{{</span><span class="s2">&quot;action&quot;: &quot;prune&quot;, &quot;type&quot;: &quot;CREATES&quot;, &quot;reasoning&quot;: &quot;...&quot;</span><span class="se">}}</span>
<a id="__codelineno-24-68" name="__codelineno-24-68" href="#__codelineno-24-68"></a><span class="s2">  ],</span>
<a id="__codelineno-24-69" name="__codelineno-24-69" href="#__codelineno-24-69"></a><span class="s2">  &quot;confidence&quot;: 0.0-1.0,</span>
<a id="__codelineno-24-70" name="__codelineno-24-70" href="#__codelineno-24-70"></a><span class="s2">  &quot;reasoning&quot;: &quot;Comprehensive explanation&quot;,</span>
<a id="__codelineno-24-71" name="__codelineno-24-71" href="#__codelineno-24-71"></a><span class="s2">  &quot;alternatives_considered&quot;: [...],</span>
<a id="__codelineno-24-72" name="__codelineno-24-72" href="#__codelineno-24-72"></a><span class="s2">  &quot;risk_assessment&quot;: </span><span class="se">{{</span>
<a id="__codelineno-24-73" name="__codelineno-24-73" href="#__codelineno-24-73"></a><span class="s2">    &quot;connectivity_impact&quot;: &quot;zero|low|medium|high&quot;,</span>
<a id="__codelineno-24-74" name="__codelineno-24-74" href="#__codelineno-24-74"></a><span class="s2">    &quot;query_disruption&quot;: &quot;none|minimal|moderate|severe&quot;,</span>
<a id="__codelineno-24-75" name="__codelineno-24-75" href="#__codelineno-24-75"></a><span class="s2">    &quot;future_regret_probability&quot;: 0.0-1.0</span>
<a id="__codelineno-24-76" name="__codelineno-24-76" href="#__codelineno-24-76"></a><span class="s2">  </span><span class="se">}}</span><span class="s2">,</span>
<a id="__codelineno-24-77" name="__codelineno-24-77" href="#__codelineno-24-77"></a><span class="s2">  &quot;human_review_required&quot;: true|false</span>
<a id="__codelineno-24-78" name="__codelineno-24-78" href="#__codelineno-24-78"></a><span class="se">}}</span>
<a id="__codelineno-24-79" name="__codelineno-24-79" href="#__codelineno-24-79"></a>
<a id="__codelineno-24-80" name="__codelineno-24-80" href="#__codelineno-24-80"></a><span class="s2">IMPORTANT: Consider learned preferences. Never prune types that humans have previously protected.</span>
<a id="__codelineno-24-81" name="__codelineno-24-81" href="#__codelineno-24-81"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-24-82" name="__codelineno-24-82" href="#__codelineno-24-82"></a>
<a id="__codelineno-24-83" name="__codelineno-24-83" href="#__codelineno-24-83"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_log_decision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decision</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-24-84" name="__codelineno-24-84" href="#__codelineno-24-84"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Store decision with full justification trail.&quot;&quot;&quot;</span>
<a id="__codelineno-24-85" name="__codelineno-24-85" href="#__codelineno-24-85"></a>        <span class="n">audit_entry</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-24-86" name="__codelineno-24-86" href="#__codelineno-24-86"></a>            <span class="s2">&quot;decision_id&quot;</span><span class="p">:</span> <span class="n">generate_id</span><span class="p">(),</span>
<a id="__codelineno-24-87" name="__codelineno-24-87" href="#__codelineno-24-87"></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">(),</span>
<a id="__codelineno-24-88" name="__codelineno-24-88" href="#__codelineno-24-88"></a>            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;aitl&quot;</span><span class="p">,</span>
<a id="__codelineno-24-89" name="__codelineno-24-89" href="#__codelineno-24-89"></a>            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">AITL_REASONING_MODEL</span><span class="p">,</span>
<a id="__codelineno-24-90" name="__codelineno-24-90" href="#__codelineno-24-90"></a>            <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;trigger&quot;</span><span class="p">],</span>
<a id="__codelineno-24-91" name="__codelineno-24-91" href="#__codelineno-24-91"></a>            <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span>
<a id="__codelineno-24-92" name="__codelineno-24-92" href="#__codelineno-24-92"></a>            <span class="s2">&quot;decision&quot;</span><span class="p">:</span> <span class="n">decision</span><span class="p">,</span>
<a id="__codelineno-24-93" name="__codelineno-24-93" href="#__codelineno-24-93"></a>            <span class="s2">&quot;human_review_required&quot;</span><span class="p">:</span> <span class="n">decision</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;human_review_required&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-24-94" name="__codelineno-24-94" href="#__codelineno-24-94"></a>        <span class="p">}</span>
<a id="__codelineno-24-95" name="__codelineno-24-95" href="#__codelineno-24-95"></a>
<a id="__codelineno-24-96" name="__codelineno-24-96" href="#__codelineno-24-96"></a>        <span class="n">store_audit</span><span class="p">(</span><span class="n">audit_entry</span><span class="p">)</span>
<a id="__codelineno-24-97" name="__codelineno-24-97" href="#__codelineno-24-97"></a>
<a id="__codelineno-24-98" name="__codelineno-24-98" href="#__codelineno-24-98"></a>        <span class="c1"># Notify if flagged for review</span>
<a id="__codelineno-24-99" name="__codelineno-24-99" href="#__codelineno-24-99"></a>        <span class="k">if</span> <span class="n">decision</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;human_review_required&quot;</span><span class="p">):</span>
<a id="__codelineno-24-100" name="__codelineno-24-100" href="#__codelineno-24-100"></a>            <span class="n">notify_curator_review_required</span><span class="p">(</span><span class="n">audit_entry</span><span class="p">)</span>
<a id="__codelineno-24-101" name="__codelineno-24-101" href="#__codelineno-24-101"></a>
<a id="__codelineno-24-102" name="__codelineno-24-102" href="#__codelineno-24-102"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">learn_from_feedback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decision_id</span><span class="p">,</span> <span class="n">curator_feedback</span><span class="p">):</span>
<a id="__codelineno-24-103" name="__codelineno-24-103" href="#__codelineno-24-103"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-24-104" name="__codelineno-24-104" href="#__codelineno-24-104"></a><span class="sd">        Human corrected AI decision - extract preference and update.</span>
<a id="__codelineno-24-105" name="__codelineno-24-105" href="#__codelineno-24-105"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-24-106" name="__codelineno-24-106" href="#__codelineno-24-106"></a>        <span class="n">decision</span> <span class="o">=</span> <span class="n">get_decision</span><span class="p">(</span><span class="n">decision_id</span><span class="p">)</span>
<a id="__codelineno-24-107" name="__codelineno-24-107" href="#__codelineno-24-107"></a>
<a id="__codelineno-24-108" name="__codelineno-24-108" href="#__codelineno-24-108"></a>        <span class="c1"># Infer preference rule</span>
<a id="__codelineno-24-109" name="__codelineno-24-109" href="#__codelineno-24-109"></a>        <span class="n">preference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_preference</span><span class="p">(</span><span class="n">decision</span><span class="p">,</span> <span class="n">curator_feedback</span><span class="p">)</span>
<a id="__codelineno-24-110" name="__codelineno-24-110" href="#__codelineno-24-110"></a>
<a id="__codelineno-24-111" name="__codelineno-24-111" href="#__codelineno-24-111"></a>        <span class="c1"># Store for future decisions</span>
<a id="__codelineno-24-112" name="__codelineno-24-112" href="#__codelineno-24-112"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">curator_corrections</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-24-113" name="__codelineno-24-113" href="#__codelineno-24-113"></a>            <span class="s2">&quot;decision_id&quot;</span><span class="p">:</span> <span class="n">decision_id</span><span class="p">,</span>
<a id="__codelineno-24-114" name="__codelineno-24-114" href="#__codelineno-24-114"></a>            <span class="s2">&quot;original_decision&quot;</span><span class="p">:</span> <span class="n">decision</span><span class="p">[</span><span class="s2">&quot;decision&quot;</span><span class="p">],</span>
<a id="__codelineno-24-115" name="__codelineno-24-115" href="#__codelineno-24-115"></a>            <span class="s2">&quot;curator_action&quot;</span><span class="p">:</span> <span class="n">curator_feedback</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">],</span>
<a id="__codelineno-24-116" name="__codelineno-24-116" href="#__codelineno-24-116"></a>            <span class="s2">&quot;reasoning&quot;</span><span class="p">:</span> <span class="n">curator_feedback</span><span class="p">[</span><span class="s2">&quot;reason&quot;</span><span class="p">],</span>
<a id="__codelineno-24-117" name="__codelineno-24-117" href="#__codelineno-24-117"></a>            <span class="s2">&quot;extracted_rule&quot;</span><span class="p">:</span> <span class="n">preference</span><span class="p">,</span>
<a id="__codelineno-24-118" name="__codelineno-24-118" href="#__codelineno-24-118"></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">()</span>
<a id="__codelineno-24-119" name="__codelineno-24-119" href="#__codelineno-24-119"></a>        <span class="p">})</span>
<a id="__codelineno-24-120" name="__codelineno-24-120" href="#__codelineno-24-120"></a>
<a id="__codelineno-24-121" name="__codelineno-24-121" href="#__codelineno-24-121"></a>        <span class="c1"># Persist</span>
<a id="__codelineno-24-122" name="__codelineno-24-122" href="#__codelineno-24-122"></a>        <span class="n">save_learned_preferences</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curator_corrections</span><span class="p">)</span>
<a id="__codelineno-24-123" name="__codelineno-24-123" href="#__codelineno-24-123"></a>
<a id="__codelineno-24-124" name="__codelineno-24-124" href="#__codelineno-24-124"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_infer_preference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decision</span><span class="p">,</span> <span class="n">feedback</span><span class="p">):</span>
<a id="__codelineno-24-125" name="__codelineno-24-125" href="#__codelineno-24-125"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract reusable preference rule from correction.&quot;&quot;&quot;</span>
<a id="__codelineno-24-126" name="__codelineno-24-126" href="#__codelineno-24-126"></a>        <span class="k">if</span> <span class="n">feedback</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;reject_prune&quot;</span><span class="p">:</span>
<a id="__codelineno-24-127" name="__codelineno-24-127" href="#__codelineno-24-127"></a>            <span class="c1"># Human rejected pruning a type</span>
<a id="__codelineno-24-128" name="__codelineno-24-128" href="#__codelineno-24-128"></a>            <span class="n">type_name</span> <span class="o">=</span> <span class="n">feedback</span><span class="p">[</span><span class="s2">&quot;protected_type&quot;</span><span class="p">]</span>
<a id="__codelineno-24-129" name="__codelineno-24-129" href="#__codelineno-24-129"></a>            <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-24-130" name="__codelineno-24-130" href="#__codelineno-24-130"></a>                <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;never_prune_</span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-24-131" name="__codelineno-24-131" href="#__codelineno-24-131"></a>                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-24-132" name="__codelineno-24-132" href="#__codelineno-24-132"></a>                    <span class="s2">&quot;relationship_type&quot;</span><span class="p">:</span> <span class="n">type_name</span><span class="p">,</span>
<a id="__codelineno-24-133" name="__codelineno-24-133" href="#__codelineno-24-133"></a>                    <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">feedback</span><span class="p">[</span><span class="s2">&quot;reason&quot;</span><span class="p">]</span>
<a id="__codelineno-24-134" name="__codelineno-24-134" href="#__codelineno-24-134"></a>                <span class="p">}</span>
<a id="__codelineno-24-135" name="__codelineno-24-135" href="#__codelineno-24-135"></a>            <span class="p">}</span>
<a id="__codelineno-24-136" name="__codelineno-24-136" href="#__codelineno-24-136"></a>        <span class="k">elif</span> <span class="n">feedback</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;reject_merge&quot;</span><span class="p">:</span>
<a id="__codelineno-24-137" name="__codelineno-24-137" href="#__codelineno-24-137"></a>            <span class="c1"># Human wants to keep synonyms separate</span>
<a id="__codelineno-24-138" name="__codelineno-24-138" href="#__codelineno-24-138"></a>            <span class="n">pair</span> <span class="o">=</span> <span class="n">feedback</span><span class="p">[</span><span class="s2">&quot;synonym_pair&quot;</span><span class="p">]</span>
<a id="__codelineno-24-139" name="__codelineno-24-139" href="#__codelineno-24-139"></a>            <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-24-140" name="__codelineno-24-140" href="#__codelineno-24-140"></a>                <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;keep_distinct_</span><span class="si">{</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-24-141" name="__codelineno-24-141" href="#__codelineno-24-141"></a>                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-24-142" name="__codelineno-24-142" href="#__codelineno-24-142"></a>                    <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="n">pair</span><span class="p">,</span>
<a id="__codelineno-24-143" name="__codelineno-24-143" href="#__codelineno-24-143"></a>                    <span class="s2">&quot;semantic_distinction&quot;</span><span class="p">:</span> <span class="n">feedback</span><span class="p">[</span><span class="s2">&quot;reason&quot;</span><span class="p">]</span>
<a id="__codelineno-24-144" name="__codelineno-24-144" href="#__codelineno-24-144"></a>                <span class="p">}</span>
<a id="__codelineno-24-145" name="__codelineno-24-145" href="#__codelineno-24-145"></a>            <span class="p">}</span>
<a id="__codelineno-24-146" name="__codelineno-24-146" href="#__codelineno-24-146"></a>        <span class="c1"># ... more inference patterns</span>
</code></pre></div>
<p><strong>Human Oversight Interface:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># Review AI decisions</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>kg<span class="w"> </span>vocab<span class="w"> </span>decisions<span class="w"> </span>--since<span class="w"> </span>7d
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="c1"># Output:</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w"> </span>AI<span class="w"> </span>Vocabulary<span class="w"> </span>Decisions<span class="w"> </span><span class="o">(</span>Last<span class="w"> </span><span class="m">7</span><span class="w"> </span>Days<span class="o">)</span><span class="w">                       </span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w"> </span><span class="m">2025</span>-10-15<span class="w"> </span><span class="m">14</span>:32<span class="w"> </span><span class="o">[</span>EXECUTED<span class="o">]</span><span class="w"> </span>PRUNED:<span class="w"> </span>CREATES,<span class="w"> </span>FEEDS_INTO<span class="w">    </span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">   </span>Confidence:<span class="w"> </span><span class="m">87</span>%<span class="w"> </span><span class="p">|</span><span class="w"> </span>Impact:<span class="w"> </span><span class="m">3</span><span class="w"> </span>edges<span class="w">                         </span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">   </span>AI<span class="w"> </span>Reasoning:<span class="w"> </span><span class="s2">&quot;Zero usage, no traversals, no future...&quot;</span><span class="w">  </span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">   </span><span class="w"> </span><span class="o">[</span>A<span class="o">]</span>pprove<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">[</span>R<span class="o">]</span>eject<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>Teach<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">[</span>D<span class="o">]</span>etailed<span class="w"> </span>View<span class="w">         </span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">                                                              </span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w"> </span><span class="m">2025</span>-10-14<span class="w"> </span><span class="m">03</span>:15<span class="w"> </span><span class="o">[</span>EXECUTED<span class="o">]</span><span class="w"> </span>MERGED:<span class="w"> </span>AUTHORED_BY<span class="w"> </span><span class="w"> </span>CREATED<span class="w">  </span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">   </span>Confidence:<span class="w"> </span><span class="m">91</span>%<span class="w"> </span><span class="p">|</span><span class="w"> </span>Impact:<span class="w"> </span><span class="m">27</span><span class="w"> </span>edges<span class="w">                        </span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">   </span>AI<span class="w"> </span>Reasoning:<span class="w"> </span><span class="s2">&quot;94% semantic similarity, stem match...&quot;</span><span class="w">    </span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">   </span><span class="w"> </span><span class="o">[</span>A<span class="o">]</span>pprove<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">[</span>R<span class="o">]</span>eject<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>Teach<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">[</span>D<span class="o">]</span>etailed<span class="w"> </span>View<span class="w">         </span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w">                                                              </span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="w"> </span><span class="m">2025</span>-10-13<span class="w"> </span><span class="m">19</span>:45<span class="w"> </span><span class="o">[</span>FLAGGED<span class="o">]</span><span class="w"> </span>AWAITING<span class="w"> </span>HUMAN<span class="w"> </span>REVIEW<span class="w">           </span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="w">   </span>Action:<span class="w"> </span>Prune<span class="w"> </span>OPTIMIZES<span class="w">                                   </span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="w">   </span>Confidence:<span class="w"> </span><span class="m">62</span>%<span class="w"> </span><span class="o">(</span>below<span class="w"> </span>threshold<span class="o">)</span><span class="w">                         </span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w">   </span><span class="w"> </span>Human<span class="w"> </span>decision<span class="w"> </span>REQUIRED<span class="w">                                 </span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="c1"># View detailed reasoning</span>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>kg<span class="w"> </span>vocab<span class="w"> </span>decision<span class="w"> </span>vocab_prune_20251015_1432<span class="w"> </span>--explain
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="c1"># Output:</span>
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>Decision:<span class="w"> </span>vocab_prune_20251015_1432
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>Model:<span class="w"> </span>claude-3-5-sonnet-20241022
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>Confidence:<span class="w"> </span><span class="m">87</span>%
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a>
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a>DECISION:<span class="w"> </span>Prune<span class="w"> </span>CREATES<span class="w"> </span>and<span class="w"> </span>FEEDS_INTO
<a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a>
<a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a>REASONING:
<a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a>Pruned<span class="w"> </span>CREATES<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="w"> </span>edges,<span class="w"> </span>never<span class="w"> </span>matched<span class="w"> </span>during<span class="w"> </span><span class="m">15</span><span class="w"> </span>recent<span class="w"> </span>ingestions<span class="o">)</span>
<a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a>and<span class="w"> </span>FEEDS_INTO<span class="w"> </span><span class="o">(</span><span class="m">3</span><span class="w"> </span>edges<span class="w"> </span>but<span class="w"> </span><span class="m">0</span><span class="w"> </span>traversals<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">30</span><span class="w"> </span>days,<span class="w"> </span>effectively
<a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a>orphaned<span class="o">)</span>.<span class="w"> </span>Rejected<span class="w"> </span>pruning<span class="w"> </span>OPTIMIZES<span class="w"> </span>despite<span class="w"> </span>borderline<span class="w"> </span>score<span class="w"> </span>because
<a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a>it<span class="w"> </span>appears<span class="w"> </span><span class="k">in</span><span class="w"> </span>ML-specific<span class="w"> </span>contexts<span class="w"> </span>and<span class="w"> </span>recent<span class="w"> </span>ingestions<span class="w"> </span>show<span class="w"> </span>increasing
<a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a>usage<span class="w"> </span><span class="o">(</span>trend:<span class="w"> </span>+40%<span class="w"> </span>over<span class="w"> </span><span class="m">14</span><span class="w"> </span>days<span class="o">)</span>.
<a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a>
<a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a>GRAPH<span class="w"> </span>IMPACT<span class="w"> </span>ANALYSIS:
<a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a>-<span class="w"> </span>Removing<span class="w"> </span>these<span class="w"> </span><span class="m">2</span><span class="w"> </span>types<span class="w"> </span>affects<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>of<span class="w"> </span>active<span class="w"> </span>queries
<a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a>-<span class="w"> </span>No<span class="w"> </span>orphaned<span class="w"> </span>concepts<span class="w"> </span>created
<a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a>-<span class="w"> </span>Connectivity<span class="w"> </span>preserved
<a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a>
<a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a>ALTERNATIVES<span class="w"> </span>CONSIDERED:
<a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a><span class="m">1</span>.<span class="w"> </span>Merge<span class="w"> </span>AUTHORED_BY<span class="w"> </span><span class="w"> </span>CREATED_BY
<a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a><span class="w">   </span>Rejected:<span class="w"> </span>Semantic<span class="w"> </span>analysis<span class="w"> </span>shows<span class="w"> </span>AUTHORED_BY<span class="w"> </span>used<span class="w"> </span>specifically
<a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a><span class="w">   </span><span class="k">for</span><span class="w"> </span>documentation<span class="w"> </span><span class="o">(</span><span class="m">86</span>%<span class="w"> </span>of<span class="w"> </span>instances<span class="o">)</span><span class="w"> </span>vs<span class="w"> </span>general<span class="w"> </span>object<span class="w"> </span>creation.
<a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a><span class="w">   </span>Merger<span class="w"> </span>would<span class="w"> </span>lose<span class="w"> </span>domain<span class="w"> </span>specificity.
<a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a>
<a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a><span class="m">2</span>.<span class="w"> </span>Raise<span class="w"> </span>max<span class="w"> </span>limit<span class="w"> </span>to<span class="w"> </span><span class="m">100</span>
<a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a><span class="w">   </span>Rejected:<span class="w"> </span>Trend<span class="w"> </span>analysis<span class="w"> </span>projects<span class="w"> </span><span class="m">105</span><span class="w"> </span>types<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">60</span><span class="w"> </span>days,<span class="w"> </span>requiring
<a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a><span class="w">   </span>another<span class="w"> </span>adjustment.<span class="w"> </span>Better<span class="w"> </span>to<span class="w"> </span>prune<span class="w"> </span>now.
<a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a>
<a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a>RISK<span class="w"> </span>ASSESSMENT:
<a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a>-<span class="w"> </span>Future<span class="w"> </span>regret<span class="w"> </span>probability:<span class="w"> </span><span class="m">15</span>%
<a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a>-<span class="w"> </span>Fallback<span class="w"> </span>available:<span class="w"> </span>Yes<span class="w"> </span><span class="o">(</span>types<span class="w"> </span>archived,<span class="w"> </span>can<span class="w"> </span>restore<span class="o">)</span>
<a id="__codelineno-25-59" name="__codelineno-25-59" href="#__codelineno-25-59"></a>
<a id="__codelineno-25-60" name="__codelineno-25-60" href="#__codelineno-25-60"></a><span class="c1"># Provide corrective feedback (teaches AI)</span>
<a id="__codelineno-25-61" name="__codelineno-25-61" href="#__codelineno-25-61"></a>kg<span class="w"> </span>vocab<span class="w"> </span>decision<span class="w"> </span>vocab_prune_20251015_1432<span class="w"> </span>--reject<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-25-62" name="__codelineno-25-62" href="#__codelineno-25-62"></a><span class="w">  </span>--reason<span class="w"> </span><span class="s2">&quot;FEEDS_INTO is critical for data pipeline ontology despite low current usage&quot;</span>
<a id="__codelineno-25-63" name="__codelineno-25-63" href="#__codelineno-25-63"></a>
<a id="__codelineno-25-64" name="__codelineno-25-64" href="#__codelineno-25-64"></a><span class="c1"># AI learns and adds to preferences:</span>
<a id="__codelineno-25-65" name="__codelineno-25-65" href="#__codelineno-25-65"></a><span class="c1"># - never_prune_FEEDS_INTO (when domain=data_pipeline)</span>
</code></pre></div>
<h4 id="4-value-scoring-algorithm">4. Value Scoring Algorithm</h4>
<p><strong>Multi-factor scoring prevents catastrophic forgetting:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_value_score</span><span class="p">(</span><span class="n">rel_type</span><span class="p">):</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="sd">    Value = structural utility, not temporal recency.</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="sd">    Factors:</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="sd">    - Edge count: How many edges use this type</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="sd">    - Traversal frequency: How often edges are queried</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="sd">    - Bridge bonus: Connects low-activation to high-activation concepts</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="sd">    - Trend: Recent usage growth</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">get_relationship_stats</span><span class="p">(</span><span class="n">rel_type</span><span class="p">)</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>    <span class="n">edge_count</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">usage_count</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>    <span class="n">avg_traversal</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">avg_traversal_count</span> <span class="ow">or</span> <span class="mi">0</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>    <span class="n">bridge_count</span> <span class="o">=</span> <span class="n">calculate_bridge_importance</span><span class="p">(</span><span class="n">rel_type</span><span class="p">)</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>    <span class="n">trend</span> <span class="o">=</span> <span class="n">calculate_usage_trend</span><span class="p">(</span><span class="n">rel_type</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>    <span class="c1"># Weighted formula</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>    <span class="n">value_score</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>        <span class="n">edge_count</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">+</span>                          <span class="c1"># Base: edge existence</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>        <span class="p">(</span><span class="n">avg_traversal</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span>             <span class="c1"># Usage weight</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>        <span class="p">(</span><span class="n">bridge_count</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.3</span> <span class="o">+</span>               <span class="c1"># Bridge preservation</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>        <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">trend</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.2</span>                         <span class="c1"># Growth momentum</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>    <span class="p">)</span>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>    <span class="k">return</span> <span class="n">value_score</span>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bridge_importance</span><span class="p">(</span><span class="n">rel_type</span><span class="p">):</span>
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a><span class="sd">    Bridge bonus: low-activation nodes connecting to high-activation nodes.</span>
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a><span class="sd">    Prevents pruning critical pathways.</span>
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a><span class="s2">    SELECT COUNT(*) as bridge_count</span>
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a><span class="s2">    FROM kg_api.edge_usage_stats e</span>
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a><span class="s2">    JOIN kg_api.concept_access_stats c_from</span>
<a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a><span class="s2">        ON e.from_concept_id = c_from.concept_id</span>
<a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a><span class="s2">    JOIN kg_api.concept_access_stats c_to</span>
<a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a><span class="s2">        ON e.to_concept_id = c_to.concept_id</span>
<a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a><span class="s2">    WHERE e.relationship_type = </span><span class="si">%s</span>
<a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a><span class="s2">      AND c_from.access_count &lt; 10      -- Low activation source</span>
<a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a><span class="s2">      AND c_to.access_count &gt; 100       -- High activation destination</span>
<a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a>
<a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">[</span><span class="n">rel_type</span><span class="p">])</span>
<a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a>    <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;bridge_count&#39;</span><span class="p">]</span>
</code></pre></div>
<p><strong>Key Insight:</strong> A rarely-used type with high bridge count (e.g., <code>PRECEDES</code> connecting timeline concepts) scores higher than a frequently-used type with no bridge value.</p>
<h4 id="5-protected-core-set">5. Protected Core Set</h4>
<p><strong>30 builtin types are immune to automatic pruning:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_protected_type</span><span class="p">(</span><span class="n">rel_type</span><span class="p">):</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if type is in protected core set.&quot;&quot;&quot;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>    <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="s2">        SELECT is_builtin</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="s2">        FROM kg_api.relationship_vocabulary</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="s2">        WHERE relationship_type = </span><span class="si">%s</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">rel_type</span><span class="p">])[</span><span class="s1">&#39;is_builtin&#39;</span><span class="p">]</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">prune_vocabulary</span><span class="p">(</span><span class="n">candidates</span><span class="p">):</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Prune low-value types, respecting protections.&quot;&quot;&quot;</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>    <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>        <span class="k">if</span> <span class="n">is_protected_type</span><span class="p">(</span><span class="n">candidate</span><span class="o">.</span><span class="n">relationship_type</span><span class="p">):</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>            <span class="n">log_warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipped pruning protected type: </span><span class="si">{</span><span class="n">candidate</span><span class="o">.</span><span class="n">relationship_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>            <span class="k">continue</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>        <span class="k">if</span> <span class="n">candidate</span><span class="o">.</span><span class="n">edge_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>            <span class="n">delete_type</span><span class="p">(</span><span class="n">candidate</span><span class="o">.</span><span class="n">relationship_type</span><span class="p">)</span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>            <span class="n">deprecate_type</span><span class="p">(</span><span class="n">candidate</span><span class="o">.</span><span class="n">relationship_type</span><span class="p">)</span>
</code></pre></div>
<p><strong>Protected types can be merged</strong> (e.g., merge novel <code>OPTIMIZES</code> into builtin <code>IMPROVES</code>), but never deleted.</p>
<h4 id="6-edge-compaction-synonym-merging">6. Edge Compaction (Synonym Merging)</h4>
<p><strong>When approaching max limit, merge synonyms instead of pruning:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect_synonym_opportunities</span><span class="p">():</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="sd">    Find high-similarity type pairs for merging.</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>    <span class="n">active_types</span> <span class="o">=</span> <span class="n">get_active_custom_types</span><span class="p">()</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>    <span class="n">synonym_pairs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>    <span class="k">for</span> <span class="n">type_a</span> <span class="ow">in</span> <span class="n">active_types</span><span class="p">:</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>        <span class="k">for</span> <span class="n">type_b</span> <span class="ow">in</span> <span class="n">active_types</span><span class="p">:</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>            <span class="k">if</span> <span class="n">type_a</span> <span class="o">&gt;=</span> <span class="n">type_b</span><span class="p">:</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>                <span class="k">continue</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>            <span class="c1"># Semantic similarity via embeddings</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>            <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>                <span class="n">get_embedding</span><span class="p">(</span><span class="n">type_a</span><span class="p">),</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>                <span class="n">get_embedding</span><span class="p">(</span><span class="n">type_b</span><span class="p">)</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>            <span class="p">)</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>            <span class="k">if</span> <span class="n">similarity</span> <span class="o">&gt;</span> <span class="mf">0.90</span><span class="p">:</span>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>                <span class="n">synonym_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>                    <span class="s2">&quot;pair&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">type_a</span><span class="p">,</span> <span class="n">type_b</span><span class="p">],</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>                    <span class="s2">&quot;similarity&quot;</span><span class="p">:</span> <span class="n">similarity</span><span class="p">,</span>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>                    <span class="s2">&quot;merge_suggestion&quot;</span><span class="p">:</span> <span class="n">suggest_canonical_form</span><span class="p">(</span><span class="n">type_a</span><span class="p">,</span> <span class="n">type_b</span><span class="p">),</span>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>                    <span class="s2">&quot;edge_impact&quot;</span><span class="p">:</span> <span class="n">count_edges</span><span class="p">(</span><span class="n">type_a</span><span class="p">)</span> <span class="o">+</span> <span class="n">count_edges</span><span class="p">(</span><span class="n">type_b</span><span class="p">)</span>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>                <span class="p">})</span>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">synonym_pairs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;edge_impact&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a>
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a>
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a><span class="k">def</span><span class="w"> </span><span class="nf">merge_relationship_types</span><span class="p">(</span><span class="n">source_type</span><span class="p">,</span> <span class="n">target_type</span><span class="p">):</span>
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a><span class="sd">    Merge source_type into target_type.</span>
<a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a><span class="sd">    Updates all edges in graph + vocabulary tables.</span>
<a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a>    <span class="c1"># 1. Update graph edges (Cypher)</span>
<a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a>    <span class="n">cypher_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a><span class="s2">    MATCH ()-[r:</span><span class="si">{</span><span class="n">source_type</span><span class="si">}</span><span class="s2">]-&gt;()</span>
<a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a><span class="s2">    SET r:</span><span class="si">{</span><span class="n">target_type</span><span class="si">}</span>
<a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a><span class="s2">    REMOVE r:</span><span class="si">{</span><span class="n">source_type</span><span class="si">}</span>
<a id="__codelineno-28-40" name="__codelineno-28-40" href="#__codelineno-28-40"></a><span class="s2">    RETURN count(r) as updated_count</span>
<a id="__codelineno-28-41" name="__codelineno-28-41" href="#__codelineno-28-41"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-28-42" name="__codelineno-28-42" href="#__codelineno-28-42"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">execute_graph_query</span><span class="p">(</span><span class="n">cypher_query</span><span class="p">)</span>
<a id="__codelineno-28-43" name="__codelineno-28-43" href="#__codelineno-28-43"></a>
<a id="__codelineno-28-44" name="__codelineno-28-44" href="#__codelineno-28-44"></a>    <span class="c1"># 2. Update vocabulary table</span>
<a id="__codelineno-28-45" name="__codelineno-28-45" href="#__codelineno-28-45"></a>    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-28-46" name="__codelineno-28-46" href="#__codelineno-28-46"></a><span class="s2">        UPDATE kg_api.relationship_vocabulary</span>
<a id="__codelineno-28-47" name="__codelineno-28-47" href="#__codelineno-28-47"></a><span class="s2">        SET synonyms = array_append(synonyms, </span><span class="si">%s</span><span class="s2">),</span>
<a id="__codelineno-28-48" name="__codelineno-28-48" href="#__codelineno-28-48"></a><span class="s2">            usage_count = usage_count + (</span>
<a id="__codelineno-28-49" name="__codelineno-28-49" href="#__codelineno-28-49"></a><span class="s2">                SELECT usage_count</span>
<a id="__codelineno-28-50" name="__codelineno-28-50" href="#__codelineno-28-50"></a><span class="s2">                FROM kg_api.relationship_vocabulary</span>
<a id="__codelineno-28-51" name="__codelineno-28-51" href="#__codelineno-28-51"></a><span class="s2">                WHERE relationship_type = </span><span class="si">%s</span>
<a id="__codelineno-28-52" name="__codelineno-28-52" href="#__codelineno-28-52"></a><span class="s2">            )</span>
<a id="__codelineno-28-53" name="__codelineno-28-53" href="#__codelineno-28-53"></a><span class="s2">        WHERE relationship_type = </span><span class="si">%s</span>
<a id="__codelineno-28-54" name="__codelineno-28-54" href="#__codelineno-28-54"></a><span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">source_type</span><span class="p">,</span> <span class="n">source_type</span><span class="p">,</span> <span class="n">target_type</span><span class="p">])</span>
<a id="__codelineno-28-55" name="__codelineno-28-55" href="#__codelineno-28-55"></a>
<a id="__codelineno-28-56" name="__codelineno-28-56" href="#__codelineno-28-56"></a>    <span class="c1"># 3. Deprecate source type</span>
<a id="__codelineno-28-57" name="__codelineno-28-57" href="#__codelineno-28-57"></a>    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-28-58" name="__codelineno-28-58" href="#__codelineno-28-58"></a><span class="s2">        UPDATE kg_api.relationship_vocabulary</span>
<a id="__codelineno-28-59" name="__codelineno-28-59" href="#__codelineno-28-59"></a><span class="s2">        SET is_active = FALSE,</span>
<a id="__codelineno-28-60" name="__codelineno-28-60" href="#__codelineno-28-60"></a><span class="s2">            deprecation_reason = </span><span class="si">%s</span>
<a id="__codelineno-28-61" name="__codelineno-28-61" href="#__codelineno-28-61"></a><span class="s2">        WHERE relationship_type = </span><span class="si">%s</span>
<a id="__codelineno-28-62" name="__codelineno-28-62" href="#__codelineno-28-62"></a><span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Merged into </span><span class="si">{</span><span class="n">target_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source_type</span><span class="p">])</span>
<a id="__codelineno-28-63" name="__codelineno-28-63" href="#__codelineno-28-63"></a>
<a id="__codelineno-28-64" name="__codelineno-28-64" href="#__codelineno-28-64"></a>    <span class="c1"># 4. Audit trail</span>
<a id="__codelineno-28-65" name="__codelineno-28-65" href="#__codelineno-28-65"></a>    <span class="n">log_vocabulary_merge</span><span class="p">(</span><span class="n">source_type</span><span class="p">,</span> <span class="n">target_type</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;updated_count&#39;</span><span class="p">])</span>
</code></pre></div>
<h4 id="7-deletion-history-rollback">7. Deletion History &amp; Rollback</h4>
<p><strong>All pruning/merging operations are logged and reversible:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1">-- Vocabulary history (track all changes)</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">kg_api</span><span class="p">.</span><span class="n">vocabulary_history</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">    </span><span class="n">relationship_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">    </span><span class="n">action</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">  </span><span class="c1">-- &#39;added&#39;, &#39;deprecated&#39;, &#39;deleted&#39;, &#39;merged&#39;</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">    </span><span class="n">performed_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span><span class="n">performed_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">    </span><span class="n">snapshot</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span><span class="w">  </span><span class="c1">-- Full type metadata at time of change</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">    </span><span class="n">merge_target</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w">  </span><span class="c1">-- If merged, what was target</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">    </span><span class="n">affected_edges</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">    </span><span class="n">details</span><span class="w"> </span><span class="n">JSONB</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="p">);</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_vocab_history_type</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">kg_api</span><span class="p">.</span><span class="n">vocabulary_history</span><span class="p">(</span><span class="n">relationship_type</span><span class="p">);</span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_vocab_history_action</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">kg_api</span><span class="p">.</span><span class="n">vocabulary_history</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
</code></pre></div>
<p><strong>Rollback support:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># View deletion history</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>kg<span class="w"> </span>vocab<span class="w"> </span><span class="nb">history</span><span class="w"> </span>--deleted
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="c1"># Output:</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w"> </span>Deleted/Merged<span class="w"> </span>Relationship<span class="w"> </span>Types<span class="w">                         </span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="w"> </span><span class="m">2025</span>-10-15<span class="w"> </span><span class="m">14</span>:32<span class="w"> </span>CREATES<span class="w">                                  </span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="w">   </span>Action:<span class="w"> </span>Pruned<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="w"> </span>edges<span class="o">)</span><span class="w">                                </span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="w">   </span>Reason:<span class="w"> </span>Never<span class="w"> </span>used<span class="w">                                      </span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="w">   </span><span class="w"> </span><span class="o">[</span>R<span class="o">]</span>estore<span class="w">                                             </span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="w">                                                            </span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="w"> </span><span class="m">2025</span>-10-14<span class="w"> </span><span class="m">03</span>:15<span class="w"> </span>AUTHORED_BY<span class="w"> </span><span class="w"> </span>CREATED_BY<span class="w">                </span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="w">   </span>Action:<span class="w"> </span>Merged<span class="w"> </span><span class="o">(</span><span class="m">27</span><span class="w"> </span>edges<span class="w"> </span>updated<span class="o">)</span><span class="w">                       </span>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="w">   </span>Reason:<span class="w"> </span><span class="m">94</span>%<span class="w"> </span>semantic<span class="w"> </span>similarity<span class="w">                         </span>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="w">   </span><span class="w"> </span><span class="o">[</span>U<span class="o">]</span>nmerge<span class="w"> </span><span class="o">(</span>revert<span class="o">)</span><span class="w">                                    </span>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="c1"># Restore pruned type</span>
<a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>kg<span class="w"> </span>vocab<span class="w"> </span>restore<span class="w"> </span>CREATES<span class="w"> </span>--reason<span class="w"> </span><span class="s2">&quot;Needed for new documentation ontology&quot;</span>
<a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>
<a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a><span class="c1"># Unmerge (split edges back)</span>
<a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>kg<span class="w"> </span>vocab<span class="w"> </span>unmerge<span class="w"> </span>AUTHORED_BY<span class="w"> </span>--from<span class="w"> </span>CREATED_BY
</code></pre></div>
<h4 id="8-vocabulary-state-portability-backuprestore-integration">8. Vocabulary State Portability (Backup/Restore Integration)</h4>
<p><strong>Implementation Insight:</strong> During implementation, we discovered that vocabulary table state is essential for backup portability (Issue discovered: 2025-10-15).</p>
<p><strong>Problem:</strong> Initial backup system (ADR-015) only exported graph data:
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="p">{</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">    </span><span class="nt">&quot;concepts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">    </span><span class="nt">&quot;sources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">    </span><span class="nt">&quot;instances&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">    </span><span class="nt">&quot;relationships&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">]</span><span class="w">  </span><span class="c1">// Contains edge types as strings</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="p">}</span>
</code></pre></div></p>
<p>Relationships contain edge type strings (e.g., <code>AUTHORED_BY</code>, <code>OPTIMIZES</code>), but the vocabulary table metadata was not preserved. On restore to a fresh database:
- Graph structure restored 
- Edge types present in relationships 
- <strong>Vocabulary table empty</strong>  (only 30 builtin types, missing 60+ custom types)
- <strong>Category assignments lost</strong> 
- <strong>Usage statistics lost</strong> 
- <strong>Embeddings lost</strong> 
- <strong>Synonym mappings lost</strong> </p>
<p><strong>Core Insight:</strong></p>
<p>Because ADR-032 structures vocabulary as <strong>managed state</strong> (not just emergent properties), backups become snapshots of TWO things:
1. <strong>Graph data</strong> (what was ingested)
2. <strong>Vocabulary state</strong> (what was learned/curated)</p>
<p>This is analogous to backing up both database tables AND schema definitions - you need both for complete restoration.</p>
<p><strong>Solution: Include Vocabulary Table in Backups</strong></p>
<p>Modified backup format to export complete vocabulary state:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="p">{</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;full_backup&quot;</span><span class="p">,</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-15T12:26:31Z&quot;</span><span class="p">,</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">  </span><span class="nt">&quot;statistics&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">    </span><span class="nt">&quot;concepts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">807</span><span class="p">,</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">    </span><span class="nt">&quot;sources&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">661</span><span class="p">,</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">    </span><span class="nt">&quot;instances&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3546</span><span class="p">,</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">    </span><span class="nt">&quot;relationships&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1699</span><span class="p">,</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w">    </span><span class="nt">&quot;vocabulary&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="w">  </span><span class="c1">// New: vocabulary count</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="w">    </span><span class="nt">&quot;concepts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">    </span><span class="nt">&quot;sources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="w">    </span><span class="nt">&quot;instances&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="w">    </span><span class="nt">&quot;relationships&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="w">    </span><span class="nt">&quot;vocabulary&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span><span class="c1">// New: complete vocabulary table</span>
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a><span class="w">      </span><span class="p">{</span>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="w">        </span><span class="nt">&quot;relationship_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AUTHORED_BY&quot;</span><span class="p">,</span>
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="w">        </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LLM-generated relationship type&quot;</span><span class="p">,</span>
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="w">        </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;attribution&quot;</span><span class="p">,</span>
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a><span class="w">        </span><span class="nt">&quot;added_by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;llm_extractor&quot;</span><span class="p">,</span>
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a><span class="w">        </span><span class="nt">&quot;added_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-15T16:41:26Z&quot;</span><span class="p">,</span>
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a><span class="w">        </span><span class="nt">&quot;usage_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">27</span><span class="p">,</span>
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a><span class="w">        </span><span class="nt">&quot;is_active&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a><span class="w">        </span><span class="nt">&quot;is_builtin&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a><span class="w">        </span><span class="nt">&quot;synonyms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;CREATED_BY&quot;</span><span class="p">],</span>
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a><span class="w">        </span><span class="nt">&quot;embedding&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.123</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.456</span><span class="p">,</span><span class="w"> </span><span class="err">...</span><span class="p">],</span><span class="w">  </span><span class="c1">// 1536-dim vector</span>
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a><span class="w">        </span><span class="nt">&quot;embedding_model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text-embedding-ada-002&quot;</span><span class="p">,</span>
<a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a><span class="w">        </span><span class="nt">&quot;embedding_generated_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-15T16:42:00Z&quot;</span><span class="p">,</span>
<a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a><span class="w">        </span><span class="nt">&quot;deprecation_reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a><span class="w">      </span><span class="p">},</span>
<a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a><span class="w">      </span><span class="c1">// ... 89 more types</span>
<a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a><span class="w">    </span><span class="p">]</span>
<a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-32-36" name="__codelineno-32-36" href="#__codelineno-32-36"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Vocabulary Import During Restore:</strong></p>
<p>Vocabulary must be imported <strong>BEFORE</strong> relationships to ensure edge types exist:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">import_backup</span><span class="p">(</span><span class="n">backup_data</span><span class="p">):</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Restore backup with vocabulary-first ordering.&quot;&quot;&quot;</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>    <span class="c1"># 1. Import vocabulary FIRST (ADR-032)</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>    <span class="k">if</span> <span class="s2">&quot;vocabulary&quot;</span> <span class="ow">in</span> <span class="n">backup_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">backup_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;vocabulary&quot;</span><span class="p">]:</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>            <span class="c1"># INSERT...ON CONFLICT to handle existing types</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>            <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="s2">                INSERT INTO kg_api.relationship_vocabulary</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="s2">                    (relationship_type, category, description, ...)</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="s2">                VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, ...)</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="s2">                ON CONFLICT (relationship_type) DO UPDATE SET</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="s2">                    category = EXCLUDED.category,</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="s2">                    usage_count = EXCLUDED.usage_count,</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="s2">                    ...</span>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">entry_values</span><span class="p">)</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>    <span class="c1"># 2. Import concepts (needs vocabulary for validation)</span>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>    <span class="n">import_concepts</span><span class="p">(</span><span class="n">backup_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;concepts&quot;</span><span class="p">])</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>    <span class="c1"># 3. Import sources</span>
<a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a>    <span class="n">import_sources</span><span class="p">(</span><span class="n">backup_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;sources&quot;</span><span class="p">])</span>
<a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a>
<a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a>    <span class="c1"># 4. Import instances</span>
<a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a>    <span class="n">import_instances</span><span class="p">(</span><span class="n">backup_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">])</span>
<a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a>
<a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a>    <span class="c1"># 5. Import relationships (edge types now exist in vocabulary)</span>
<a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a>    <span class="n">import_relationships</span><span class="p">(</span><span class="n">backup_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;relationships&quot;</span><span class="p">])</span>
</code></pre></div>
<p><strong>Backward Compatibility:</strong></p>
<p>Old backups without vocabulary section still restore correctly:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># Backup integrity checker (backup_integrity.py)</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="k">if</span> <span class="s2">&quot;vocabulary&quot;</span> <span class="ow">in</span> <span class="n">data_section</span><span class="p">:</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>    <span class="c1"># New backup: validate against vocabulary table</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>    <span class="n">vocabulary_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;relationship_type&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_section</span><span class="p">[</span><span class="s2">&quot;vocabulary&quot;</span><span class="p">]}</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>    <span class="c1"># Validate relationships use known types</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>    <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">relationships</span><span class="p">:</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>        <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vocabulary_types</span><span class="p">:</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>            <span class="c1"># Warn about unknown types</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>            <span class="n">result</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown type: </span><span class="si">{</span><span class="n">rel</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>    <span class="c1"># Old backup: validate against builtin types only</span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>    <span class="n">vocabulary_types</span> <span class="o">=</span> <span class="n">BUILTIN_RELATIONSHIP_TYPES</span>
</code></pre></div>
<p><strong>Why This Matters:</strong></p>
<ol>
<li><strong>Ontology Portability:</strong> Export ontology from dev  import to prod with full vocabulary context</li>
<li><strong>Disaster Recovery:</strong> Complete system state restoration (not just graph data)</li>
<li><strong>A/B Testing:</strong> Clone production vocabulary state to test environment</li>
<li><strong>Temporal Snapshots:</strong> Backup captures "what the system knew" at that moment</li>
<li><strong>Migration Safety:</strong> Vocabulary state travels with graph data during migrations</li>
</ol>
<p><strong>Example Scenario:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># Export ontology with learned vocabulary</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>kg<span class="w"> </span>admin<span class="w"> </span>backup<span class="w"> </span>--type<span class="w"> </span>ontology<span class="w"> </span>--ontology<span class="w"> </span><span class="s2">&quot;ML Research Papers&quot;</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="c1"># Backup contains:</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="c1"># - 250 concepts from ML domain</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="c1"># - 45 relationship types (30 builtin + 15 custom)</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="c1"># - Custom types: TRAINS_ON, OPTIMIZES, OUTPERFORMS, PRETRAINED_ON, ...</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="c1"># - Category assignments: all 15 custom types  &quot;ml_specific&quot; category</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="c1"># - Embeddings for synonym detection</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="c1"># - Usage statistics for value scoring</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="c1"># Import to fresh database</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>kg<span class="w"> </span>admin<span class="w"> </span>restore<span class="w"> </span>--file<span class="w"> </span>ml_research_papers.json
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="c1"># Result:</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="c1">#  All 250 concepts restored</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="c1">#  All 45 relationship types available</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="c1">#  Custom ML types immediately usable</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="c1">#  Category structure preserved</span>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="c1">#  Ready for new ingestion without vocabulary re-learning</span>
</code></pre></div>
<p><strong>Implementation Changes:</strong></p>
<p>Modified files:
- <code>src/lib/serialization.py</code>: Added <code>export_vocabulary()</code> method
- <code>src/lib/serialization.py</code>: Modified <code>import_backup()</code> to import vocabulary first
- <code>src/api/lib/backup_integrity.py</code>: Added vocabulary section validation
- Backup format version remains <code>1.0</code> (backward compatible)</p>
<p><strong>Statistics Tracking:</strong></p>
<p>Backup integrity checker now reports vocabulary statistics:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a> Backup validated successfully
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>  Full database backup
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>  - Concepts: 807
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>  - Sources: 661
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>  - Instances: 3546
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>  - Relationships: 1699
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>  - Vocabulary: 90 types (30 builtin, 60 extended)
</code></pre></div>
<p><strong>Data Integrity Note:</strong></p>
<p>During testing, we discovered 851 relationships using edge types not in the vocabulary table (USED_FOR, CONTAINS, DEFINED_AS, etc.). These are pre-ADR-032 data - relationships created before vocabulary tracking was implemented. The backup integrity checker correctly flags these as warnings but still allows restore (they remain as string properties on edges).</p>
<h2 id="implementation-plan">Implementation Plan</h2>
<h3 id="phase-1-auto-expansion-infrastructure">Phase 1: Auto-Expansion Infrastructure</h3>
<ol>
<li><strong>Modify <code>upsert_relationship()</code> in <code>age_client.py</code>:</strong></li>
<li>Add auto-expansion logic</li>
<li>Basic validation (format, blacklist)</li>
<li>
<p>Trigger pruning check</p>
</li>
<li>
<p><strong>Create <code>vocabulary_manager.py</code> service:</strong></p>
</li>
<li><code>add_to_vocabulary()</code></li>
<li><code>get_active_vocabulary_size()</code></li>
<li>
<p><code>trigger_pruning_workflow()</code></p>
</li>
<li>
<p><strong>Add configuration:</strong></p>
</li>
<li><code>VOCAB_MIN</code>, <code>VOCAB_MAX</code>, <code>VOCAB_HARD_LIMIT</code></li>
<li>
<p><code>VOCAB_PRUNING_MODE</code> (naive|hitl|aitl)</p>
</li>
<li>
<p><strong>Update schema:</strong></p>
</li>
<li>Add <code>vocabulary_history</code> table</li>
<li>Add <code>pruning_recommendations</code> table</li>
</ol>
<h3 id="phase-2-aggressiveness-curve-naive-mode">Phase 2: Aggressiveness Curve + Naive Mode</h3>
<ol>
<li><strong>Implement aggressiveness curve:</strong></li>
<li>Zone calculations (comfort/watch/merge/prune/emergency)</li>
<li>Batching strategy</li>
<li>
<p>Merge vs prune decision logic</p>
</li>
<li>
<p><strong>Implement naive pruning:</strong></p>
</li>
<li>Value score calculation</li>
<li>
<p>Automatic prune on limit exceeded</p>
</li>
<li>
<p><strong>Add synonym detection:</strong></p>
</li>
<li>Embedding-based similarity</li>
<li>Merge suggestions in recommendations</li>
</ol>
<h3 id="phase-3-hitl-mode">Phase 3: HITL Mode</h3>
<ol>
<li><strong>Implement HITL workflow:</strong></li>
<li>Recommendation generation with aggressiveness curve</li>
<li>Curator approval API endpoints</li>
<li>
<p>CLI commands (<code>kg vocab review</code>, <code>kg vocab approve-all</code>)</p>
</li>
<li>
<p><strong>Add monitoring:</strong></p>
</li>
<li>Zone transition alerts</li>
<li>Optimization invocation tracking</li>
<li>Buffer effectiveness metrics</li>
</ol>
<h3 id="phase-4-aitl-mode">Phase 4: AITL Mode</h3>
<ol>
<li><strong>Build AITL curator:</strong></li>
<li>Reasoning prompt template</li>
<li>Decision logging</li>
<li>
<p>Confidence thresholds</p>
</li>
<li>
<p><strong>Implement learning loop:</strong></p>
</li>
<li>Curator feedback capture</li>
<li>Preference extraction</li>
<li>
<p>Preference persistence</p>
</li>
<li>
<p><strong>Add oversight interface:</strong></p>
</li>
<li><code>kg vocab decisions</code> (view AI decisions)</li>
<li><code>kg vocab decision {id} --explain</code> (detailed reasoning)</li>
<li><code>kg vocab decision {id} --reject --reason</code> (teach AI)</li>
</ol>
<h3 id="phase-5-rollback-analytics">Phase 5: Rollback &amp; Analytics</h3>
<ol>
<li><strong>Implement rollback:</strong></li>
<li><code>kg vocab restore {type}</code></li>
<li>
<p><code>kg vocab unmerge {type}</code></p>
</li>
<li>
<p><strong>Add analytics:</strong></p>
</li>
<li><code>kg vocab analytics</code> (trends, value scores, zone history)</li>
<li><code>kg vocab candidates</code> (pruning candidates)</li>
<li>Aggressiveness curve visualization</li>
</ol>
<h2 id="api-endpoints">API Endpoints</h2>
<h3 id="vocabulary-management">Vocabulary Management</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>GET    /api/vocabulary/types              # List all types with stats
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>POST   /api/vocabulary/types              # Manually add type (curator)
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>PUT    /api/vocabulary/types/{type}       # Update metadata
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>DELETE /api/vocabulary/types/{type}       # Deprecate type
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>POST   /api/vocabulary/types/{type}/restore  # Restore pruned type
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>POST   /api/vocabulary/merge              # Merge two types
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>POST   /api/vocabulary/unmerge            # Revert merge
</code></pre></div>
<h3 id="configuration">Configuration</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>GET    /api/vocabulary/config             # Get tuning parameters
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>PUT    /api/vocabulary/config             # Update parameters (admin)
</code></pre></div>
<h3 id="hitl-workflow">HITL Workflow</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>GET    /api/vocabulary/recommendations    # Get pending recommendations
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>POST   /api/vocabulary/recommendations/{id}/approve
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>POST   /api/vocabulary/recommendations/{id}/reject
</code></pre></div>
<h3 id="aitl-workflow">AITL Workflow</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>GET    /api/vocabulary/decisions          # List AI decisions
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>GET    /api/vocabulary/decisions/{id}     # Detailed decision view
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>POST   /api/vocabulary/decisions/{id}/feedback  # Provide correction
</code></pre></div>
<h3 id="analytics">Analytics</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>GET    /api/vocabulary/history            # Change history
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>GET    /api/vocabulary/analytics          # Value scores, trends
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>GET    /api/vocabulary/candidates         # Pruning candidates
</code></pre></div>
<h2 id="benefits">Benefits</h2>
<h3 id="1-self-regulating-system">1. Self-Regulating System</h3>
<ul>
<li><strong>No manual deployment</strong> for new types</li>
<li><strong>Automatic capacity management</strong> (sliding window)</li>
<li><strong>Data-driven decisions</strong> (value scores, not guesswork)</li>
</ul>
<h3 id="2-domain-adaptability">2. Domain Adaptability</h3>
<ul>
<li><strong>ML ontologies</strong> get <code>TRAINS_ON</code>, <code>PREDICTS</code>, <code>OPTIMIZES</code></li>
<li><strong>Pipeline ontologies</strong> get <code>FEEDS_INTO</code>, <code>TRANSFORMS</code>, <code>VALIDATES</code></li>
<li><strong>Semantic ontologies</strong> get <code>SYMBOLIZES</code>, <code>REPRESENTS</code>, <code>EMBODIES</code></li>
</ul>
<p>Each domain naturally grows its vocabulary through ingestion.</p>
<h3 id="3-intelligent-oversight">3. Intelligent Oversight</h3>
<ul>
<li><strong>Naive mode:</strong> Fast, deterministic (CI/CD)</li>
<li><strong>HITL mode:</strong> Human control (production)</li>
<li><strong>AITL mode:</strong> Scalable + justifiable (high-volume)</li>
</ul>
<h3 id="4-learning-system">4. Learning System</h3>
<ul>
<li><strong>AI learns curator preferences</strong> over time</li>
<li><strong>Reduces false positives</strong> (e.g., never prune temporal types)</li>
<li><strong>Improves with usage</strong> (self-optimizing)</li>
</ul>
<h3 id="5-auditability">5. Auditability</h3>
<ul>
<li><strong>Full justification logs</strong> for every decision</li>
<li><strong>Rollback capability</strong> for mistakes</li>
<li><strong>Compliance-friendly</strong> (who, what, when, why)</li>
</ul>
<h2 id="trade-offs">Trade-offs</h2>
<h3 id="complexity">Complexity</h3>
<p><strong>Cost:</strong> More complex than static vocabulary
<strong>Mitigation:</strong> Start with naive mode, graduate to HITL, enable AITL only when needed</p>
<h3 id="ai-decision-risk">AI Decision Risk</h3>
<p><strong>Cost:</strong> AITL might make wrong pruning decisions
<strong>Mitigation:</strong>
- Confidence threshold (fallback to HITL if &lt; 0.7)
- Protected core set (30 builtin types immune)
- Full audit trail + rollback
- Human oversight weekly</p>
<h3 id="token-cost">Token Cost</h3>
<p><strong>Cost:</strong> AITL reasoning uses ~500-1000 tokens per decision
<strong>Mitigation:</strong>
- Only runs when limit exceeded (infrequent)
- Cost: ~$0.01 per decision with Claude Sonnet
- Can disable in cost-sensitive environments</p>
<h3 id="synonym-detection-accuracy">Synonym Detection Accuracy</h3>
<p><strong>Cost:</strong> Might merge non-synonyms (false positives)
<strong>Mitigation:</strong>
- High similarity threshold (0.90+)
- HITL/AITL approval required
- Easy unmerge via rollback</p>
<h2 id="monitoring-metrics">Monitoring &amp; Metrics</h2>
<h3 id="key-metrics">Key Metrics</h3>
<ol>
<li><strong>Vocabulary Size Over Time</strong></li>
<li>Track active types (should stay 30-90)</li>
<li>
<p>Alert if exceeds hard limit</p>
</li>
<li>
<p><strong>Auto-Expansion Rate</strong></p>
</li>
<li>New types added per ingestion</li>
<li>
<p>Alert if &gt; 5 types/job (possible LLM issue)</p>
</li>
<li>
<p><strong>Pruning Frequency</strong></p>
</li>
<li>How often pruning triggered</li>
<li>
<p>Target: &lt; 1x per week</p>
</li>
<li>
<p><strong>AITL Decision Accuracy</strong></p>
</li>
<li>% of AI decisions approved by humans</li>
<li>
<p>Target: &gt; 85%</p>
</li>
<li>
<p><strong>Value Score Distribution</strong></p>
</li>
<li>Histogram of type value scores</li>
<li>Identify low-value types proactively</li>
</ol>
<h3 id="alerts">Alerts</h3>
<ul>
<li><code>vocab_size &gt; hard_limit</code>  Block ingestion, require curator intervention</li>
<li><code>aitl_approval_rate &lt; 70%</code>  AI making poor decisions, review preferences</li>
<li><code>auto_expansion_rate &gt; 10/day</code>  Possible LLM extraction issue</li>
</ul>
<h2 id="security-governance">Security &amp; Governance</h2>
<h3 id="access-control-rbac">Access Control (RBAC)</h3>
<ul>
<li><strong>Contributor:</strong> Can ingest (triggers auto-expansion)</li>
<li><strong>Curator:</strong> Can approve pruning recommendations</li>
<li><strong>Admin:</strong> Can modify config, force operations</li>
</ul>
<h3 id="validation">Validation</h3>
<ul>
<li><strong>Format validation:</strong> Prevent malformed types</li>
<li><strong>Blacklist:</strong> Block profanity, reserved terms</li>
<li><strong>Rate limiting:</strong> Max 10 auto-expansions per ingestion job</li>
</ul>
<h3 id="audit-trail">Audit Trail</h3>
<p>Every operation logged to <code>vocabulary_audit</code> and <code>vocabulary_history</code> with:
- Who (user/system/ai)
- What (action + details)
- When (timestamp)
- Why (reasoning/context)</p>
<h2 id="alternatives-considered">Alternatives Considered</h2>
<h3 id="1-manual-approval-for-every-type-adr-025">1. Manual Approval for Every Type (ADR-025)</h3>
<p><strong>Rejected:</strong> Doesn't scale for high-volume ingestion or domain-specific ontologies</p>
<h3 id="2-unlimited-vocabulary-growth">2. Unlimited Vocabulary Growth</h3>
<p><strong>Rejected:</strong> Leads to vocabulary explosion, degraded LLM extraction quality</p>
<h3 id="3-time-based-pruning">3. Time-Based Pruning</h3>
<p><strong>Rejected:</strong> Graph value is structural, not temporal. Old types can have high bridge importance.</p>
<h3 id="4-no-pruning-only-expansion">4. No Pruning (Only Expansion)</h3>
<p><strong>Rejected:</strong> Eventually hits performance limits, confuses LLM with 200+ type options</p>
<h3 id="5-hardcoded-ifelse-threshold-logic">5. Hardcoded If/Else Threshold Logic</h3>
<p><strong>Rejected:</strong> Multiple issues with maintainability and tuning</p>
<p><strong>Original Approach:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># Example of hardcoded threshold logic</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_aggressiveness</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">):</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>    <span class="k">if</span> <span class="n">vocab_size</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>    <span class="k">elif</span> <span class="n">vocab_size</span> <span class="o">&lt;</span> <span class="mi">70</span><span class="p">:</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>        <span class="k">return</span> <span class="mf">0.2</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>    <span class="k">elif</span> <span class="n">vocab_size</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>        <span class="k">return</span> <span class="mf">0.5</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>    <span class="k">elif</span> <span class="n">vocab_size</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">:</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>        <span class="k">return</span> <span class="mf">0.8</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>        <span class="k">return</span> <span class="mf">1.0</span>
</code></pre></div></p>
<p><strong>Problems:</strong></p>
<ol>
<li><strong>Hard to Debug:</strong></li>
<li>Which threshold is causing behavior X?</li>
<li>What happens at boundary conditions (vocab_size = 79 vs 80)?</li>
<li>
<p>Discontinuous jumps create unpredictable behavior</p>
</li>
<li>
<p><strong>Difficult to Tune:</strong></p>
</li>
<li>Want gentler curve? Rewrite all thresholds</li>
<li>Want sharper curve? Add more if/elif branches</li>
<li>
<p>Every tuning attempt requires code changes and deployment</p>
</li>
<li>
<p><strong>Not Visualizable:</strong></p>
</li>
<li>Can't graph the behavior easily</li>
<li>Hard to communicate to non-technical stakeholders</li>
<li>
<p>No way to preview changes before deploying</p>
</li>
<li>
<p><strong>Maintenance Burden:</strong></p>
</li>
<li>Each environment might need different thresholds</li>
<li>Testing requires multiple code paths</li>
<li>
<p>Adding new zones means rewriting logic</p>
</li>
<li>
<p><strong>Example Debugging Scenario:</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1"># Bug report: &quot;System pruned aggressively at 78 types&quot;</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="c1"># Developer has to trace through:</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="k">if</span> <span class="n">vocab_size</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>  <span class="c1"># Not here</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>    <span class="o">...</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="k">elif</span> <span class="n">vocab_size</span> <span class="o">&lt;</span> <span class="mi">70</span><span class="p">:</span>  <span class="c1"># Not here</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>    <span class="o">...</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="k">elif</span> <span class="n">vocab_size</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>  <span class="c1"># AH! Here&#39;s the culprit</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>    <span class="k">return</span> <span class="mf">0.5</span>  <span class="c1"># But why 0.5? Is that right for 78?</span>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>    <span class="c1"># And what about 79? 77? Where&#39;s the sweet spot?</span>
</code></pre></div></p>
</li>
</ol>
<p><strong>Why Bezier is Better:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1"># Single line configuration</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">curve</span> <span class="o">=</span> <span class="n">AGGRESSIVENESS_CURVES</span><span class="p">[</span><span class="s2">&quot;aggressive&quot;</span><span class="p">]</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="n">aggressiveness</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">get_y_for_x</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="c1"># Debugging: &quot;What&#39;s aggressiveness at 78 types?&quot;</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="c1"># Answer: Plot curve, see exact value (e.g., 0.67)</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="c1"># Visual, continuous, predictable</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="c1"># Tuning: &quot;Too aggressive at 78?&quot;</span>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="c1"># Change: VOCAB_AGGRESSIVENESS = &quot;gentle&quot;</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="c1"># No code changes, no deployment</span>
</code></pre></div>
<p><strong>Bezier Benefits:</strong>
-  Continuous function (smooth behavior, no jumps)
-  Visually tunable (drag control points, see result)
-  Configuration-based (no code changes)
-  Familiar to developers (CSS animations use same math)
-  Easy to debug (plot curve, see exact behavior)
-  Environment-specific (dev vs prod can use different profiles)</p>
<p><strong>Trade-off:</strong>
- More complex implementation (CubicBezier class)
- But: Implementation is one-time, benefits are ongoing
- And: Standard algorithm, well-tested, no surprises</p>
<h2 id="success-criteria">Success Criteria</h2>
<h3 id="phase-1-auto-expansion">Phase 1 (Auto-Expansion)</h3>
<ul>
<li>[ ] New types auto-added during ingestion</li>
<li>[ ] No code deployment required for new types</li>
<li>[ ] Vocabulary size tracked and alerts functional</li>
</ul>
<h3 id="phase-2-hitl">Phase 2 (HITL)</h3>
<ul>
<li>[ ] Curator can approve/reject recommendations in &lt; 2 minutes</li>
<li>[ ] Pruning maintains vocabulary at 30-90 types</li>
<li>[ ] Zero false positives (protected types never pruned)</li>
</ul>
<h3 id="phase-3-aitl">Phase 3 (AITL)</h3>
<ul>
<li>[ ] AI decision approval rate &gt; 85%</li>
<li>[ ] AI learns from corrections (preferences applied)</li>
<li>[ ] Detailed justification logs for compliance</li>
</ul>
<h3 id="phase-4-rollback">Phase 4 (Rollback)</h3>
<ul>
<li>[ ] Can restore any pruned type</li>
<li>[ ] Can unmerge any synonym pair</li>
<li>[ ] Full change history queryable</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><strong>ADR-022:</strong> 30-Type Semantically Sparse Taxonomy (current static system)</li>
<li><strong>ADR-025:</strong> Dynamic Relationship Vocabulary (skip-and-approve workflow)</li>
<li><strong>ADR-026:</strong> Autonomous Vocabulary Curation (LLM-assisted suggestions)</li>
<li><strong>ADR-047:</strong> Probabilistic Vocabulary Categorization (embedding-based category assignment)</li>
<li><strong>ADR-046:</strong> Grounding-Aware Vocabulary Management (synonym detection, compaction workflow)</li>
<li><strong>ADR-014:</strong> Job Approval Workflow (HITL pattern)</li>
<li><strong>ADR-021:</strong> Live Man Switch (human oversight principles)</li>
</ul>
<h2 id="future-enhancements">Future Enhancements</h2>
<h3 id="phase-5-advanced-learning">Phase 5: Advanced Learning</h3>
<ul>
<li>Cross-ontology type analysis (find domain patterns)</li>
<li>Predictive type suggestions (recommend types before ingestion)</li>
<li>Automatic category inference via clustering</li>
</ul>
<h3 id="phase-6-distributed-vocabulary">Phase 6: Distributed Vocabulary</h3>
<ul>
<li>Multi-tenant vocabulary namespaces</li>
<li>Vocabulary inheritance (base + domain-specific)</li>
<li>Federated type sharing across organizations</li>
</ul>
<hr />
<p><strong>Status:</strong> Proposed
<strong>Next Steps:</strong>
1. Review with development team
2. Prototype auto-expansion in feature branch
3. Test naive mode with sample ingestions
4. Pilot HITL workflow with curator
5. Evaluate AITL with safety checks</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>