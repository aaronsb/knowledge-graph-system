
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Multi-dimensional knowledge extraction system using Apache AGE">
      
      
        <meta name="author" content="Knowledge Graph System Contributors">
      
      
      
        <link rel="prev" href="../ADR-051.2-api-changes/">
      
      
        <link rel="next" href="../ADR-057.2-appendix-single-vs-two-stage/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>ADR-057: Multimodal Image Ingestion with Visual Context Injection - Knowledge Graph System</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#adr-057-multimodal-image-ingestion-with-visual-context-injection" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Knowledge Graph System" class="md-header__button md-logo" aria-label="Knowledge Graph System" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Knowledge Graph System
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ADR-057: Multimodal Image Ingestion with Visual Context Injection
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/aaronsb/knowledge-graph-system" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    aaronsb/knowledge-graph-system
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Knowledge Graph System" class="md-nav__button md-logo" aria-label="Knowledge Graph System" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Knowledge Graph System
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aaronsb/knowledge-graph-system" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    aaronsb/knowledge-graph-system
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation Index
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What Is This?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/how-it-works/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How It Works
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/web-workstation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Web Workstation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Tool
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/mcp-server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/fuse-driver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FUSE Driver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/rest-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    REST API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/CLI_DEVELOPMENT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Development Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/CONTAINER_IMAGES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Container Images
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/CROSS_ONTOLOGY_LINKING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cross-Ontology Knowledge Linking: A Practical Example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/DEPLOYMENT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/EPISTEMIC-STATUS-FILTERING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Epistemic Status Query Filtering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/FUSE_FILESYSTEM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FUSE Filesystem Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/POLARITY_AXIS_ANALYSIS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Polarity Axis Analysis - User Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/QUERY_SAFETY_BASELINE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Query Safety Baseline - Technical Debt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/SCHEDULED-JOBS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scheduled Jobs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/SEMANTIC_PATH_GRADIENTS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Semantic Path Gradients: Analyzing Reasoning Chains in Embedding Space
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/VOCABULARY_CATEGORIES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vocabulary Category Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/adr-045-046-migration-plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migration Plan: ADR-045/046 Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/adr-068-implementation-plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-068 Source Text Embeddings - Implementation Plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/adr-074-implementation-checklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-074 Implementation Checklist
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/exploring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exploring Knowledge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/querying/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Querying the Knowledge Graph
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/understanding-grounding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Understanding Grounding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Manual
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Manual
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Graph System Manual
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    00 introduction
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    00 introduction
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/00-introduction/01-WHAT_AND_WHY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What is the Knowledge Graph System?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    01 getting started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    01 getting started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/01-getting-started/02-CLI_USAGE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg CLI Usage Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/01-getting-started/03-INGESTION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ingesting Documents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    02 configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    02 configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/02-configuration/01-AI_PROVIDERS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Provider Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/02-configuration/02-EXTRACTION_CONFIGURATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Extraction Configuration Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/02-configuration/03-EMBEDDING_CONFIGURATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Embedding Configuration Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/02-configuration/04-SWITCHING_EXTRACTION_PROVIDERS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Switching Extraction Providers - Quick Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/02-configuration/05-LOCAL_INFERENCE_IMPLEMENTATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local LLM Inference Implementation Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/02-configuration/06-EXTRACTION_QUALITY_COMPARISON/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Extraction Quality Comparison
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    03 integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    03 integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/03-integration/01-MCP_SETUP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Server Setup Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/03-integration/02-VOCABULARY_CONSOLIDATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Edge Vocabulary Consolidation Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    04 security and access
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    04 security and access
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/04-security-and-access/01-AUTHENTICATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/04-security-and-access/02-RBAC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RBAC Operations Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/04-security-and-access/03-SECURITY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/04-security-and-access/04-PASSWORD_RECOVERY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Password Recovery and Account Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    05 maintenance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    05 maintenance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/05-maintenance/01-BACKUP_RESTORE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup and Restore Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/05-maintenance/02-DATABASE_MIGRATIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Migrations Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    06 reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    06 reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/01-SCHEMA_REFERENCE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PostgreSQL Schema Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/02-USE_CASES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use Cases: Practical Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/03-EXAMPLES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Examples: Real Queries, Real Results
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/04-github_project_history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub Project History Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/05-CONCEPTS_AND_TERMINOLOGY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concepts and Terminology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/06-CONCEPT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concept: Why Knowledge Graphs, Not Just RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/07-ENRICHMENT_JOURNEY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Enrichment Journey: From Empty Graph to Multi-Perspective Understanding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/08-DISTRIBUTED_SHARDING_RESEARCH/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distributed Graph Database Sharding: Research and Architectural Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/09-CYPHER_PATTERNS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced Cypher Query Patterns for Apache AGE
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/10-OPENCYPHER_QUERIES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    openCypher Query Examples
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/11-LLM_EDGE_DISCOVERY_FLOW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Edge Discovery Flow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/macvlan-dedicated-ip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Macvlan Deployment Pattern: Dedicated LAN IP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Operating
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Operating
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operating/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operating the Knowledge Graph System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operating/backup-restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup &amp; Restore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operating/client-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operating/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operating/macvlan-headless-install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Headless Installation with Macvlan Networking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operating/production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Production Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operating/quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operating/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operating/upgrading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Upgrading
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tool &amp; API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/ARCHITECTURE_OVERVIEW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Graph System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/OPERATOR_ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operator Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/RECURSIVE_UPSERT_ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Recursive Upsert Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/STORAGE-ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Storage Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_6" >
        
          
          <label class="md-nav__link" for="__nav_8_6" id="__nav_8_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Api
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Api
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    REST API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/api/ADMIN-ENDPOINTS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Endpoints Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_7" >
        
          
          <label class="md-nav__link" for="__nav_8_7" id="__nav_8_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cli
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cli
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Command Reference (Auto-Generated)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_7_2" >
        
          
          <label class="md-nav__link" for="__nav_8_7_2" id="__nav_8_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/admin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg admin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/health/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg health
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/ingest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg ingest
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/job/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg job
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/login/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg login
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/logout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg logout
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/oauth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg oauth
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/ontology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg ontology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/vocabulary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg vocabulary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_7_3" >
        
          
          <label class="md-nav__link" for="__nav_8_7_3" id="__nav_8_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Media
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Media
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/media/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Media Assets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_8" >
        
          
          <label class="md-nav__link" for="__nav_8_8" id="__nav_8_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Mcp
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Mcp
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Server Tool Reference (Auto-Generated)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_8_2" id="__nav_8_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Media
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_8_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Media
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/media/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Media Assets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_8_3" id="__nav_8_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_8_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/analyze_polarity_axis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    analyze_polarity_axis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/artifact/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    artifact
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    concept
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/document/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    document
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/epistemic_status/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    epistemic_status
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/graph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    graph
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/ingest-directory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ingest-directory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/ingest-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ingest-file
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/ingest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ingest
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/inspect-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    inspect-file
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/job/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    job
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/ontology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ontology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/source/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    source
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INDEX/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture Decision Records
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2" >
        
          
          <label class="md-nav__link" for="__nav_9_2" id="__nav_9_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Access workflow
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Access workflow
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-001-multi-tier-agent-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-001: Multi-Tier Agent Access Model
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-002-node-fitness-scoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-002: Node Fitness Scoring System
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-003-semantic-tool-hints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-003: Semantic Tool Hint Networks
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-004-pure-graph-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-004: Pure Graph Design (Library Metaphor)
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-005-source-text-tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-005: Source Text Tracking and Retrieval
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-006-staging-migration-workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-006: Staging and Migration Workflows
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-038-official-project-apparel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-038: Official Project Apparel Design Specifications
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-087-documentation-strategy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-087: Documentation Strategy and Audience Framework
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-900-adr-numbering-domain-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-900: ADR Numbering Domain System
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_3" >
        
          
          <label class="md-nav__link" for="__nav_9_3" id="__nav_9_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Ai embeddings
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ai embeddings
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-039-local-embedding-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-039: Local Embedding Service with Hybrid Client/Server Architecture
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-041-ai-extraction-config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-041: AI Extraction Provider Configuration
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-042-local-extraction-inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-042: Local LLM Inference for Concept Extraction
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-043-single-node-resource-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-043: Single-Node Resource Management for Local Inference
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-044-probabilistic-truth-convergence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-044: Probabilistic Truth Convergence Through Contradiction Resolution
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-045-unified-embedding-generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-045: Unified Embedding Generation System
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-049-rate-limiting-and-concurrency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-049: Rate Limiting and Per-Provider Concurrency Management
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-058-polarity-axis-triangulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-058: Polarity Axis Triangulation for Grounding Calculation
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-068-source-text-embeddings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-068: Source Text Embeddings for Grounding Truth Retrieval
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-070-polarity-axis-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-070: Polarity Axis Analysis for Bidirectional Semantic Dimensions
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_3_11" >
        
          
          <label class="md-nav__link" for="__nav_9_3_11" id="__nav_9_3_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    media ADR 058
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_9_3_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    media ADR 058
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/media-ADR-058/README_VISUALIZATIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Polarity Axis Triangulation Visualizations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4" >
        
          
          <label class="md-nav__link" for="__nav_9_4" id="__nav_9_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Authentication security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Authentication security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-017-sensitive-auth-verification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-017: Client-Initiated Token Revocation for Elevated Operations
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-027-user-management-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-027: User Management API with Lightweight JWT Authentication
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Superseded"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-028-dynamic-rbac-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-028: Dynamic Role-Based Access Control (RBAC) System
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-031-encrypted-api-key-storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-031: Encrypted API Key Storage with Container Secrets
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-054-oauth-client-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-054: OAuth 2.0 Client Management for Multi-Client Authentication
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-060-endpoint-security-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-060: API Endpoint Security Architecture
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-062-mcp-file-ingestion-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-062: MCP File Ingestion Security Model
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-074-platform-admin-role/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-074: Platform Admin Role
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-082-user-scoping-artifact-ownership/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-082: User Scoping and Artifact Ownership Model
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_5" >
        
          
          <label class="md-nav__link" for="__nav_9_5" id="__nav_9_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Database schema
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Database schema
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database-schema/ADR-016-apache-age-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-016: Apache AGE Migration (Neo4j Replacement)
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database-schema/ADR-024-multi-schema-postgresql-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-024: Multi-Schema PostgreSQL Architecture
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database-schema/ADR-040-database-schema-migrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-040: Database Schema Migration Management
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database-schema/ADR-061-operator-pattern-lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-061: Operator Pattern for Platform Lifecycle Management
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database-schema/ADR-200-breathing-ontologies-self-organizing-knowledge-graph-structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-200: Breathing Ontologies  Self-Organizing Knowledge Graph Structure
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_6" >
        
          
          <label class="md-nav__link" for="__nav_9_6" id="__nav_9_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-012-api-server-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-012: API Server Architecture for Scalable Neo4j Access
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-015-backup-restore-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-015: Backup/Restore Streaming Architecture
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-018-server-sent-events-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-018: Server-Sent Events for Real-Time Progress Streaming
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-020-admin-module-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-020: Admin Module Architecture Pattern
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-021-live-man-switch-ai-safety/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-021: Live Man Switch - AI Safety for Critical Operations
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Superseded"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-050-scheduled-jobs-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-050: Scheduled Jobs System
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-055-cdn-serverless-deployment-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-055: CDN and Serverless Deployment Model
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-056-timezone-aware-datetime-utilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-056: Timezone-Aware Datetime Utilities
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-079-projection-artifact-storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-079: Projection Artifact Storage in Garage
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-080-garage-service-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-080: Garage Service Architecture
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-083-artifact-persistence-pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-083: Artifact Persistence Pattern
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-086-deployment-topology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-086: Deployment Topology (Dev/Stable Split)
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-088-semantic-election-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-088: Semantic Election Protocol for Distributed Concept Placement
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_7" checked>
        
          
          <label class="md-nav__link" for="__nav_9_7" id="__nav_9_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Ingestion content
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ingestion content
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-014-job-approval-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-014: Job Approval Workflow with Pre-Ingestion Analysis
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-023-markdown-structured-content-preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-023: Markdown Structured Content Preprocessing
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-033-multimodal-ingestion-configurable-prompts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-033: Multimodal Image Ingestion with Configurable Prompt System
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-037-human-guided-graph-editing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-037: Human-Guided Graph Editing
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-051.1-graph-document-deduplication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-051: Graph-Based Provenance Tracking
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-051.2-api-changes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-051: API Changes for Graph-Based Document Deduplication
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    ADR-057: Multimodal Image Ingestion with Visual Context Injection
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-057: Multimodal Image Ingestion with Visual Context Injection
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-note-minio-garage-2025-11-04" class="md-nav__link">
    <span class="md-ellipsis">
      
        Migration Note: MinIO  Garage (2025-11-04)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-text-to-speech-test-problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        The "Text-to-Speech Test" Problem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prior-art-and-rejected-approaches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prior Art and Rejected Approaches
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decision" class="md-nav__link">
    <span class="md-ellipsis">
      
        Decision
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Decision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-overview-hairpin-pattern-with-visual-context-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Overview: Hairpin Pattern with Visual Context Injection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-model-adr-031" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Model (ADR-031)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-vision-backend-abstraction" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Vision Backend Abstraction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-storage-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Storage Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-graph-schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Graph Schema
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-technology-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Technology Stack
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedding-architecture-critical-design-principle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Embedding Architecture - Critical Design Principle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Embedding Architecture - Critical Design Principle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#three-types-of-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Three Types of Embeddings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-this-matters-automatic-cross-source-concept-matching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Matters: Automatic Cross-Source Concept Matching
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-principles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Principles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-paths-enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        Search Paths Enabled
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-unified-ingestion-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation: Unified Ingestion Pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation: Unified Ingestion Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ingestion-flow-hairpin-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ingestion Flow (Hairpin Pattern)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visual-context-in-llm-prompt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visual Context in LLM Prompt
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multimodal-search-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multimodal Search Capabilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multimodal Search Capabilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-text-concepts-existing-unchanged" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Text  Concepts (Existing, Unchanged)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-image-images-new-visual-similarity" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Image  Images (NEW: Visual Similarity)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-text-images-new-cross-modal" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Text  Images (NEW: Cross-Modal)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-image-concepts-new-visual-to-semantic" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Image  Concepts (NEW: Visual to Semantic)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example Scenarios
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scenario-1-same-document-text-images" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 1: Same Document, Text + Images
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-2-cross-domain-visual-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 2: Cross-Domain Visual Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-3-visual-pattern-clustering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 3: Visual Pattern Clustering
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-routes" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Routes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#image-ingestion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Ingestion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Retrieval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-similarity-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Similarity Search
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-modal-search-text-images" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cross-Modal Search (Text  Images)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visual-to-semantic-search-image-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visual to Semantic Search (Image  Concepts)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Environment Variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration File
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-schema-updates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Schema Updates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Schema Updates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-table-image_assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        New Table: image_assets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updated-table-sources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Updated Table: sources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relationship-table-source_images" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relationship Table: source_images
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-compose-updates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Docker Compose Updates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#management-scripts-postgresql-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Management Scripts (PostgreSQL Pattern)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Management Scripts (PostgreSQL Pattern)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scriptsgaragestart-garagesh" class="md-nav__link">
    <span class="md-ellipsis">
      
        scripts/garage/start-garage.sh
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scriptsgaragestop-garagesh" class="md-nav__link">
    <span class="md-ellipsis">
      
        scripts/garage/stop-garage.sh
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scriptsgarageinit-garagesh" class="md-nav__link">
    <span class="md-ellipsis">
      
        scripts/garage/init-garage.sh
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scriptsservicesstart-storagesh-combined" class="md-nav__link">
    <span class="md-ellipsis">
      
        scripts/services/start-storage.sh (Combined)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scriptsservicesstop-storagesh-combined" class="md-nav__link">
    <span class="md-ellipsis">
      
        scripts/services/stop-storage.sh (Combined)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-mode-quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Development Mode Quick Start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daily-development-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Daily Development Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ollama-model-management-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ollama Model Management (Optional)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Benefits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benefits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-unified-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Unified Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-intelligent-relationship-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Intelligent Relationship Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-ground-truth-preservation" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Ground Truth Preservation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-multimodal-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Multimodal Search
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-ontology-aware" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Ontology-Aware
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-quality-first-with-local-fallback" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Quality-First with Local Fallback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-licensing-clean" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Licensing Clean
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-scalable-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Scalable Storage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trade-offs-and-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trade-offs and Limitations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trade-offs and Limitations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trade-offs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#current-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Current Limitations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#known-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Known Issues
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Enhancements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Enhancements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#near-term" class="md-nav__link">
    <span class="md-ellipsis">
      
        Near-Term
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medium-term" class="md-nav__link">
    <span class="md-ellipsis">
      
        Medium-Term
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#long-term" class="md-nav__link">
    <span class="md-ellipsis">
      
        Long-Term
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#garage-credential-management-postgresql-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Garage Credential Management (PostgreSQL Pattern)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Garage Credential Management (PostgreSQL Pattern)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#development-env-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Development (.env file)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-compose-no-hardcoded-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      
        Docker Compose (No Hardcoded Credentials)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialize-credentials-first-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initialize Credentials (First Run)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#garage-api-server-trust" class="md-nav__link">
    <span class="md-ellipsis">
      
        Garage API Server Trust
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Production Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-secrets-production" class="md-nav__link">
    <span class="md-ellipsis">
      
        Docker Secrets (Production)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#garage-bucket-policies-advanced" class="md-nav__link">
    <span class="md-ellipsis">
      
        Garage Bucket Policies (Advanced)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-trust-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Trust Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Input Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#garage-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Garage Access Control
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rate Limiting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-privacy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Privacy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unit Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Load Tests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-and-observability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring and Observability
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring and Observability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logging
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Checklist
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Infrastructure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Schema
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision-backend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vision Backend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-routes_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Routes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        CLI Commands
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Documentation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#success-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      
        Success Criteria
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#considered-alternatives" class="md-nav__link">
    <span class="md-ellipsis">
      
        Considered Alternatives
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Considered Alternatives">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minio-initially-implemented-then-rejected" class="md-nav__link">
    <span class="md-ellipsis">
      
        MinIO (Initially Implemented, Then Rejected)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusion
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-057.2-appendix-single-vs-two-stage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-057.2: Appendix: Single-Stage vs Two-Stage Image Processing
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-072-concept-matching-strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-072: Concept Matching Strategies and Configuration
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-081-source-document-lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-081: Source Document Lifecycle
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADR-089-deterministic-node-edge-creation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-089: Deterministic Node and Edge Creation
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_8" >
        
          
          <label class="md-nav__link" for="__nav_9_8" id="__nav_9_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Query search
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Query search
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-search/ADR-030-concept-deduplication-validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-030: Concept Deduplication Quality Validation
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-search/ADR-063-semantic-diversity-authenticity-signal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-063: Semantic Diversity as Authenticity Signal
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-search/ADR-066-published-query-endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-066: Published Query Endpoints
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-search/ADR-071-parallel-graph-queries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-071: Parallel Graph Query Optimization
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-search/ADR-071.1-parallel-implementation-findings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-071.1: Parallel Graph Query Implementation Findings
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-search/ADR-076-pathfinding-optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-076: Pathfinding Optimization for Apache AGE
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-search/ADR-076.1-pathfinding-baseline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-076.1: Pathfinding Performance Baseline
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-search/ADR-084-document-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-084: Document-Level Search
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_9" >
        
          
          <label class="md-nav__link" for="__nav_9_9" id="__nav_9_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User interfaces
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    User interfaces
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-011-cli-admin-separation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-011: CLI and Admin Tooling Separation
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-013-unified-typescript-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-013: Unified TypeScript Client (CLI + MCP Server)
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-019-type-based-table-formatting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-019: Type-Based Table Formatting System
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-029-cli-theory-of-operation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-029: CLI Theory of Operation - Hybrid Unix/Domain-Specific Design
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-034-graph-visualization-query-workbench/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-034: Graph Visualization &amp; Interactive Query Explorers
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-035-explorer-methods-uses-capabilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-035: Explorer Methods, Uses, and Capabilities
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-036-universal-visual-query-builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-036: Universal Visual Query Builder
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-064-specialized-truth-convergence-visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-064: Specialized Truth Convergence Visualizations
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-067-web-app-workstation-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-067: Web Application Workstation Architecture
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-069-semantic-fuse-filesystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-069: Semantic FUSE Filesystem
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-069.1-fuse-implementation-specifics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-069.1: FUSE Driver Implementation Specifics
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-075-postmodern-theme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-075: Postmodern Theme System
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-700-ontology-explorer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-700: Ontology Explorer
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-701-vocabulary-administration-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-701: Vocabulary Administration Interface
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_10" >
        
          
          <label class="md-nav__link" for="__nav_9_10" id="__nav_9_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Visualization
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Visualization
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualization/ADR-078-embedding-landscape-explorer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-078: Embedding Landscape Explorer
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualization/ADR-085-document-explorer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-085: Document Explorer with Radial Concept Visualization
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_11" >
        
          
          <label class="md-nav__link" for="__nav_9_11" id="__nav_9_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Vocabulary relationships
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vocabulary relationships
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-022-semantic-relationship-taxonomy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-022: Semantically Sparse 30-Type Relationship Taxonomy
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-025-dynamic-relationship-vocabulary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-025: Dynamic Relationship Vocabulary Management
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-026-autonomous-vocabulary-curation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-026: Autonomous Vocabulary Curation and Ontology Management
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-032.1-automatic-edge-vocabulary-expansion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-032: Automatic Edge Vocabulary Expansion with Intelligent Pruning
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-032.2-implementation-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-032.2: Implementation Quick Reference
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-046-grounding-aware-vocabulary-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-046: Grounding-Aware Vocabulary Management
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-047-probabilistic-vocabulary-categorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-047: Probabilistic Vocabulary Categorization
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-048-vocabulary-metadata-as-graph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-048: Vocabulary Metadata as First-Class Graph
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-052-vocabulary-expansion-consolidation-cycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-052: Vocabulary Expansion-Consolidation Cycle (The "Dreaming" Pattern)
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-053-eager-vocabulary-categorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-053: Eager Vocabulary Categorization
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-059-llm-determined-relationship-direction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-059: LLM-Determined Relationship Direction Semantics
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Proposed"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-065-vocabulary-based-provenance-relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-065: Vocabulary-Based Provenance Relationships
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Accepted"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-077-vocabulary-explorers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-077: Vocabulary Explorers
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--Draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Research
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Research
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/code-intelligence-platforms-comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How Our System Fits Into the Code Intelligence Ecosystem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/emergent-visual-relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development Journal: MinIO Integration &amp; Emergent Visual Relationships
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/epistemic-confidence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Epistemic Confidence: Philosophy and Mathematics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/headless-install-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Headless Install Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/llm-knowledge-extraction-research-2024-2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM-Powered Knowledge Extraction and Concept Modeling: Research Report (2024-2025)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/polarity-axis-findings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Semantic Path Gradient Analysis - Experimental Findings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/polarity-axis-visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Polarity Axis Analysis Visualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/t-sne-viz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scaling t-SNE and Embedding Visualization for Knowledge Graphs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_9" >
        
          
          <label class="md-nav__link" for="__nav_10_9" id="__nav_10_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Vision testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vision testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/vision-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PDF to Image Ingestion &amp; Vision Model Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/vision-testing/EMBEDDING_COMPARISON_REPORT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Visual Embedding Model Comparison Report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/vision-testing/FINDINGS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vision Model Testing Findings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research/vision-testing/RESEARCH_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vision Model Research Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/API_AUTH_AUDIT_RESULTS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Endpoint Authentication Audit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/API_AUTH_AUDIT_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Authentication Audit Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/API_AUTH_TESTING_RESEARCH/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Authentication Testing Research
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/INTEGRATION_TEST_NOTES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integration Test Notes - Working Commands &amp; Observations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/INTEGRATION_TEST_PLAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Graph System - Integration Test Plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/SCHEMA_MIGRATION_TEST_REPORT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PostgreSQL Schema Migration - Functional Test Report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/TEST_COVERAGE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Coverage Areas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-note-minio-garage-2025-11-04" class="md-nav__link">
    <span class="md-ellipsis">
      
        Migration Note: MinIO  Garage (2025-11-04)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-text-to-speech-test-problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        The "Text-to-Speech Test" Problem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prior-art-and-rejected-approaches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prior Art and Rejected Approaches
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decision" class="md-nav__link">
    <span class="md-ellipsis">
      
        Decision
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Decision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-overview-hairpin-pattern-with-visual-context-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Overview: Hairpin Pattern with Visual Context Injection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-model-adr-031" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Model (ADR-031)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-vision-backend-abstraction" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Vision Backend Abstraction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-storage-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Storage Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-graph-schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Graph Schema
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-technology-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Technology Stack
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedding-architecture-critical-design-principle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Embedding Architecture - Critical Design Principle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Embedding Architecture - Critical Design Principle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#three-types-of-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Three Types of Embeddings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-this-matters-automatic-cross-source-concept-matching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Matters: Automatic Cross-Source Concept Matching
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-principles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Principles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-paths-enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        Search Paths Enabled
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-unified-ingestion-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation: Unified Ingestion Pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation: Unified Ingestion Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ingestion-flow-hairpin-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ingestion Flow (Hairpin Pattern)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visual-context-in-llm-prompt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visual Context in LLM Prompt
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multimodal-search-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multimodal Search Capabilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multimodal Search Capabilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-text-concepts-existing-unchanged" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Text  Concepts (Existing, Unchanged)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-image-images-new-visual-similarity" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Image  Images (NEW: Visual Similarity)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-text-images-new-cross-modal" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Text  Images (NEW: Cross-Modal)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-image-concepts-new-visual-to-semantic" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Image  Concepts (NEW: Visual to Semantic)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example Scenarios
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scenario-1-same-document-text-images" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 1: Same Document, Text + Images
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-2-cross-domain-visual-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 2: Cross-Domain Visual Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-3-visual-pattern-clustering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 3: Visual Pattern Clustering
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-routes" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Routes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#image-ingestion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Ingestion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-retrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Retrieval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-similarity-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Similarity Search
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-modal-search-text-images" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cross-Modal Search (Text  Images)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visual-to-semantic-search-image-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visual to Semantic Search (Image  Concepts)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Environment Variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration File
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-schema-updates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Schema Updates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Schema Updates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-table-image_assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        New Table: image_assets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updated-table-sources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Updated Table: sources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relationship-table-source_images" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relationship Table: source_images
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-compose-updates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Docker Compose Updates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#management-scripts-postgresql-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Management Scripts (PostgreSQL Pattern)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Management Scripts (PostgreSQL Pattern)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scriptsgaragestart-garagesh" class="md-nav__link">
    <span class="md-ellipsis">
      
        scripts/garage/start-garage.sh
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scriptsgaragestop-garagesh" class="md-nav__link">
    <span class="md-ellipsis">
      
        scripts/garage/stop-garage.sh
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scriptsgarageinit-garagesh" class="md-nav__link">
    <span class="md-ellipsis">
      
        scripts/garage/init-garage.sh
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scriptsservicesstart-storagesh-combined" class="md-nav__link">
    <span class="md-ellipsis">
      
        scripts/services/start-storage.sh (Combined)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scriptsservicesstop-storagesh-combined" class="md-nav__link">
    <span class="md-ellipsis">
      
        scripts/services/stop-storage.sh (Combined)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#development-mode-quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Development Mode Quick Start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daily-development-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Daily Development Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ollama-model-management-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ollama Model Management (Optional)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Benefits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benefits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-unified-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Unified Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-intelligent-relationship-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Intelligent Relationship Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-ground-truth-preservation" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Ground Truth Preservation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-multimodal-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Multimodal Search
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-ontology-aware" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Ontology-Aware
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-quality-first-with-local-fallback" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Quality-First with Local Fallback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-licensing-clean" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Licensing Clean
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-scalable-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Scalable Storage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trade-offs-and-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trade-offs and Limitations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trade-offs and Limitations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trade-offs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#current-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Current Limitations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#known-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Known Issues
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Enhancements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Enhancements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#near-term" class="md-nav__link">
    <span class="md-ellipsis">
      
        Near-Term
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medium-term" class="md-nav__link">
    <span class="md-ellipsis">
      
        Medium-Term
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#long-term" class="md-nav__link">
    <span class="md-ellipsis">
      
        Long-Term
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#garage-credential-management-postgresql-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Garage Credential Management (PostgreSQL Pattern)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Garage Credential Management (PostgreSQL Pattern)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#development-env-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Development (.env file)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-compose-no-hardcoded-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      
        Docker Compose (No Hardcoded Credentials)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialize-credentials-first-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initialize Credentials (First Run)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#garage-api-server-trust" class="md-nav__link">
    <span class="md-ellipsis">
      
        Garage API Server Trust
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Production Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Production Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-secrets-production" class="md-nav__link">
    <span class="md-ellipsis">
      
        Docker Secrets (Production)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#garage-bucket-policies-advanced" class="md-nav__link">
    <span class="md-ellipsis">
      
        Garage Bucket Policies (Advanced)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-trust-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Trust Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Input Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#garage-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Garage Access Control
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rate Limiting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-privacy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Privacy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unit Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Load Tests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-and-observability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring and Observability
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring and Observability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logging
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Checklist
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Infrastructure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Schema
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vision-backend" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vision Backend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-routes_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Routes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        CLI Commands
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Documentation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#success-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      
        Success Criteria
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#considered-alternatives" class="md-nav__link">
    <span class="md-ellipsis">
      
        Considered Alternatives
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Considered Alternatives">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minio-initially-implemented-then-rejected" class="md-nav__link">
    <span class="md-ellipsis">
      
        MinIO (Initially Implemented, Then Rejected)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusion
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="adr-057-multimodal-image-ingestion-with-visual-context-injection">ADR-057: Multimodal Image Ingestion with Visual Context Injection</h1>
<h2 id="overview">Overview</h2>
<p>The knowledge graph excels at extracting concepts from prose text, but what about all the valuable knowledge locked in images? Think about PDF lecture slides with diagrams, architecture flowcharts, screenshots of code, or whiteboard photos from brainstorming sessions. These visual documents contain concepts and relationships, but the text-only system can't see them.</p>
<p>Modern vision AI models like GPT-4o can look at an image and describe what they see in exhaustive detail. This ADR proposes a "hairpin" architecture where images get converted to detailed prose descriptions via vision AI, then flow through the exact same concept extraction pipeline we already use for text documents. A diagram of a recursive loop becomes a prose description of that diagram, and the LLM extracts concepts from the description just like it would from written text. The original images get stored in object storage (Garage) for future reference, but the graph works with the semantic concepts extracted from their descriptions.</p>
<p>The clever part is visual context injection. When you ingest an image, the system first searches for visually similar images already in the graph using image embeddings. If it finds a diagram that looks similarespecially from the same ontologyit includes those similar images' descriptions as context when extracting concepts. This helps the LLM understand "this flowchart is part of the same lecture series as that other flowchart," creating stronger relationships between related visual content.</p>
<p>Everything reuses the existing architecture: one unified upsert pipeline, one concept extraction system, one graph schema. Images just take a detour through vision AI to become text first, then follow the same path as documents. The system gains multimodal capabilities while maintaining architectural simplicity and avoiding code duplication.</p>
<hr />
<h2 id="migration-note-minio-garage-2025-11-04">Migration Note: MinIO  Garage (2025-11-04)</h2>
<p><strong>Initial implementation</strong> used MinIO for S3-compatible object storage. However, in March 2025, MinIO gutted the admin UI from their Community Edition, relegating it to their Enterprise edition at $96,000/year. This follows the exact same bait-and-switch pattern we encountered with Neo4j (which charges $180,000/year for RBAC and security features we considered table-stakes).</p>
<p><strong>Why we switched to Garage:</strong>
- <strong>Governance</strong>: Deuxfleurs cooperative (can't pull license tricks like MinIO/Neo4j)
- <strong>License</strong>: AGPLv3 with no Enterprise edition trap
- <strong>EU-funded</strong>: Government-backed stability
- <strong>S3 API</strong>: Drop-in replacement requiring zero code changes to our abstraction layer
- <strong>Philosophy alignment</strong>: Same principles that led us to escape Neo4j via Apache AGE (ADR-016)</p>
<p><strong>Migration impact</strong>: Since we only use the S3 API (never integrated MinIO client libraries), this is purely an infrastructure change. All references to "MinIO" in this document now refer to "Garage" instead. The architectural patterns, security model, and API interactions remain identical - only the underlying object storage implementation changed.</p>
<hr />
<h2 id="context">Context</h2>
<p>The knowledge graph system currently excels at ingesting prose text and extracting semantic concepts. However, a significant portion of valuable knowledge exists in visual formats:</p>
<ul>
<li><strong>PDF documents</strong> (lecture notes, research papers, presentations)</li>
<li><strong>Diagrams and flowcharts</strong> (architecture diagrams, process flows)</li>
<li><strong>Whiteboards and photos</strong> (brainstorming sessions, sketches)</li>
<li><strong>Screenshots</strong> (code samples, UI mockups, error messages)</li>
<li><strong>Charts and graphs</strong> (data visualizations, metrics)</li>
</ul>
<h3 id="the-text-to-speech-test-problem">The "Text-to-Speech Test" Problem</h3>
<p>Our current system assumes all input can be read aloud as prose (the "text-to-speech test"). This works perfectly for natural language but fails for:
- Visual diagrams where spatial relationships convey meaning
- Tables where structure is semantic
- Code samples where indentation and symbols matter
- Mathematical formulas and equations
- Annotated screenshots with arrows and highlights</p>
<h3 id="key-requirements">Key Requirements</h3>
<ol>
<li><strong>Ingest visual content</strong> into the knowledge graph</li>
<li><strong>Preserve ground truth</strong> - keep original images, not just derived text</li>
<li><strong>Multimodal search</strong> - find content by text query, image similarity, or cross-modal</li>
<li><strong>Unified pipeline</strong> - reuse existing concept extraction and recursive upsert</li>
<li><strong>Ontology-aware</strong> - respect knowledge domain boundaries</li>
<li><strong>Local-first</strong> - support offline processing without cloud APIs</li>
<li><strong>Licensing clean</strong> - avoid AGPL contamination</li>
</ol>
<h3 id="prior-art-and-rejected-approaches">Prior Art and Rejected Approaches</h3>
<p><strong>MinerU (rejected)</strong>: Sophisticated PDFmarkdown tool with state-of-the-art accuracy, but AGPL v3 licensed. The network copyleft clause would contaminate our entire API codebase.</p>
<p><strong>PyMuPDF (rejected)</strong>: Excellent PDF rendering library, but also AGPL v3 licensed.</p>
<p><strong>Separate image pipeline (rejected)</strong>: Maintaining two upsert systems (one for text, one for images) creates code duplication, inconsistent behavior, and complexity.</p>
<p><strong>Vision-only approach (rejected)</strong>: Direct imageconcepts without text intermediate loses the ability to leverage existing extraction pipeline and text-based search.</p>
<hr />
<h2 id="decision">Decision</h2>
<h3 id="architecture-overview-hairpin-pattern-with-visual-context-injection">Architecture Overview: Hairpin Pattern with Visual Context Injection</h3>
<p>We adopt a <strong>single unified upsert system</strong> where images follow a "hairpin" route:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Image  Visual Analysis  Text Description + Visual Context  Existing Text Upsert
</code></pre></div>
<p><strong>Key architectural decisions</strong>:</p>
<ol>
<li><strong>Storage separation</strong>: Garage for heavy image blobs, PostgreSQL for lightweight embeddings and metadata</li>
<li><strong>Vision backend</strong>: GPT-4o (primary, cloud) or Claude 3.5 Sonnet, with Ollama/Granite as optional local fallback</li>
<li><strong>Dual embeddings</strong>: Nomic Vision v1.5 for image embeddings (768-dim), Nomic Text for description embeddings</li>
<li><strong>Visual context injection</strong>: Similar images provide context during concept extraction</li>
<li><strong>Ontology-aware search</strong>: Boost same-ontology results, enable cross-domain discovery</li>
<li><strong>LLM-driven relationships</strong>: Model chooses appropriate relationship types (IMPLIES, CONTRADICTS, SUPPORTS, etc.)</li>
</ol>
<p><strong>Research validation</strong> (Nov 2025): Comprehensive testing validated GPT-4o Vision as primary backend over Granite Vision 3.3 2B due to reliability (100% vs random refusals). Nomic Vision v1.5 embeddings achieved 0.847 average top-3 similarity (27% higher than CLIP). See <code>docs/research/vision-testing/</code> for complete findings.</p>
<h3 id="security-model-adr-031">Security Model (ADR-031)</h3>
<p>Garage credentials follow the same encrypted storage pattern as OpenAI/Anthropic API keys:</p>
<ul>
<li><strong>Encrypted at rest</strong>: Credentials stored in <code>kg_api.system_api_keys</code> table using Fernet encryption (AES-128-CBC + HMAC-SHA256)</li>
<li><strong>Master key</strong>: <code>ENCRYPTION_KEY</code> environment variable or Docker secrets (never in database)</li>
<li><strong>Configuration</strong>: Interactive setup via <code>./scripts/setup/initialize-platform.sh</code> (option 7)</li>
<li><strong>Runtime access</strong>: API server retrieves credentials on-demand from encrypted store</li>
<li><strong>Endpoint config only in .env</strong>: <code>GARAGE_RPC_HOST</code>, <code>GARAGE_RPC_SECRET</code>, <code>GARAGE_S3_ENDPOINT</code>, <code>GARAGE_REGION</code></li>
</ul>
<p>This ensures consistent security across all service credentials. PostgreSQL credentials remain in .env (infrastructure requirement), while external/independent service credentials (OpenAI, Anthropic, Garage) are encrypted in the database.</p>
<p><strong>Migration note</strong>: Existing deployments with plain-text Garage credentials in .env will automatically fall back to environment variables until credentials are configured via <code>initialize-platform.sh</code>.</p>
<hr />
<h2 id="architecture-components">Architecture Components</h2>
<h3 id="1-vision-backend-abstraction">1. Vision Backend Abstraction</h3>
<p>Like our existing AI provider system (OpenAI, Anthropic, Ollama), vision models are abstracted:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">VisionBackend</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">describe_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert image to prose description&quot;&quot;&quot;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>        <span class="k">pass</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">OpenAIVisionBackend</span><span class="p">(</span><span class="n">VisionBackend</span><span class="p">):</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;GPT-4o via OpenAI API (PRIMARY - validated in research)&quot;&quot;&quot;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;gpt-4o&quot;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="c1"># Research shows: 100% reliable, excellent literal descriptions</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="c1"># Cost: ~$0.01/image, Speed: ~5s/image</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">AnthropicVisionBackend</span><span class="p">(</span><span class="n">VisionBackend</span><span class="p">):</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Claude 3.5 Sonnet via Anthropic API (ALTERNATE)&quot;&quot;&quot;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;claude-3-5-sonnet-20241022&quot;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    <span class="c1"># Similar quality to GPT-4o, slightly higher cost</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    <span class="c1"># Cost: ~$0.015/image, Speed: ~5s/image</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="k">class</span><span class="w"> </span><span class="nc">OllamaVisionBackend</span><span class="p">(</span><span class="n">VisionBackend</span><span class="p">):</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Local inference via Ollama (OPTIONAL - pattern in place)&quot;&quot;&quot;</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>    <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;granite-vision-3.3:2b&quot;</span>  <span class="c1"># or llava, etc.</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>    <span class="c1"># Research shows: Inconsistent quality, random refusals</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>    <span class="c1"># Use only when cloud APIs unavailable</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>    <span class="c1"># Cost: $0, Speed: ~15s/image</span>
</code></pre></div>
<p><strong>Simple usage example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Standard OpenAI vision pattern (primary backend)</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">vision_backend</span> <span class="o">=</span> <span class="n">get_vision_backend</span><span class="p">()</span>  <span class="c1"># Returns OpenAIVisionBackend by default</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">description</span> <span class="o">=</span> <span class="k">await</span> <span class="n">vision_backend</span><span class="o">.</span><span class="n">describe_image</span><span class="p">(</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">image_bytes</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">prompt</span><span class="o">=</span><span class="n">LITERAL_DESCRIPTION_PROMPT</span>  <span class="c1"># See below for literal prompt</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="p">)</span>
</code></pre></div></p>
<p><strong>Literal Description Prompt</strong> (validated in research):
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">LITERAL_DESCRIPTION_PROMPT</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="s2">Describe everything visible in this image literally and exhaustively.</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="s2">Do NOT summarize or interpret. Do NOT provide analysis or conclusions.</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="s2">Instead, describe:</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="s2">- Every piece of text you see, word for word</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="s2">- Every visual element (boxes, arrows, shapes, colors)</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="s2">- The exact layout and positioning of elements</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="s2">- Any diagrams, charts, or graphics in detail</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="s2">- Relationships between elements (what connects to what, what&#39;s above/below)</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="s2">- Any logos, branding, or page numbers</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="s2">Be thorough and literal. If you see text, transcribe it exactly. If you see a box with an arrow pointing to another box, describe that precisely.</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="s2">&quot;&quot;&quot;</span>
</code></pre></div></p>
<p><strong>Why literal prompts?</strong> Two-stage pipeline requires raw descriptions. Stage 1 (vision) provides literal facts. Stage 2 (LLM extraction) interprets concepts. Interpretive summaries in Stage 1 reduce Stage 2 quality.</p>
<h3 id="2-storage-architecture">2. Storage Architecture</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a> PostgreSQL + Apache AGE (Lightweight, Frequently Accessed)  
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a> (:ImageAsset {                                              
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>   asset_id: &quot;uuid&quot;,                                         
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>   object_key: &quot;images/Watts Lectures/2024-11-03/uuid.jpg&quot;, 
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>   image_embedding: [768 floats],   ~3KB                   
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>   ontology: &quot;Watts Lectures&quot;,                               
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>   mime_type: &quot;image/jpeg&quot;,                                  
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>   width: 1920,                                              
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>   height: 1080,                                             
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>   vision_model: &quot;gpt-4o&quot;,   Tracks which model was used   
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>   embedding_model: &quot;nomic-embed-vision:latest&quot;              
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a> })                                                           
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a> Garage (Heavy Binary Storage, Rarely Accessed)              
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a> Bucket: knowledge-graph-images/                             
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>    images/                                               
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>        Watts Lectures/                                   
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>            2024-11-03/                                   
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>                uuid.jpg (200KB)                          
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>
</code></pre></div>
<p><strong>Why this split?</strong>
- Embeddings need fast vector similarity search (graph database)
- Images are rarely accessed (only when user clicks "show source")
- Graph stays fast (~5KB per image node)
- Garage handles cheap blob storage (~200KB per compressed image)</p>
<h3 id="2-graph-schema">2. Graph Schema</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1">// ImageAsset with visual embedding</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="p">(:</span><span class="n">ImageAsset</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="n">asset_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;uuid&quot;</span><span class="p">,</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="n">object_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;images/{ontology}/{date}/{uuid}.jpg&quot;</span><span class="p">,</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="n">image_embedding</span><span class="p">:</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="m">768</span><span class="p">),</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">  </span><span class="n">ontology</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Watts Lectures&quot;</span><span class="p">,</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">  </span><span class="n">mime_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;image/jpeg&quot;</span><span class="p">,</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">  </span><span class="n">width</span><span class="p">:</span><span class="w"> </span><span class="m">1920</span><span class="p">,</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">  </span><span class="n">height</span><span class="p">:</span><span class="w"> </span><span class="m">1080</span><span class="p">,</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">  </span><span class="n">file_size</span><span class="p">:</span><span class="w"> </span><span class="m">245678</span><span class="p">,</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">  </span><span class="n">vision_model</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;granite-vision-3.3:2b&quot;</span><span class="p">,</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">  </span><span class="n">embedding_model</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nomic-embed-vision:latest&quot;</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">  </span><span class="n">created_at</span><span class="p">:</span><span class="w"> </span><span class="n">timestamp</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="p">})</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="c1">// Source with prose description (existing schema)</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="p">(:</span><span class="n">Source</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">  </span><span class="n">source_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;uuid&quot;</span><span class="p">,</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">  </span><span class="n">document</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;watts_lecture_1_page_2.jpg&quot;</span><span class="p">,</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">  </span><span class="n">paragraph</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Page 2&quot;</span><span class="p">,</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">  </span><span class="n">full_text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;This flowchart shows a recursive awareness loop...&quot;</span><span class="p">,</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">  </span><span class="n">text_embedding</span><span class="p">:</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="m">768</span><span class="p">),</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">  </span><span class="n">ontology</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Watts Lectures&quot;</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="p">})</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="c1">// Link Source to ImageAsset</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="p">(:</span><span class="n">Source</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">HAS_IMAGE</span><span class="o">]-&gt;</span><span class="p">(:</span><span class="n">ImageAsset</span><span class="p">)</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="c1">// Concepts and relationships (existing schema, unchanged)</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="p">(:</span><span class="n">Concept</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="w">  </span><span class="n">concept_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;uuid&quot;</span><span class="p">,</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="w">  </span><span class="n">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;recursive self-reference&quot;</span><span class="p">,</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a><span class="w">  </span><span class="n">embedding</span><span class="p">:</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="m">768</span><span class="p">),</span>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="w">  </span><span class="n">ontology</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Watts Lectures&quot;</span>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="p">})</span>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a><span class="p">(:</span><span class="n">Concept</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">EVIDENCED_BY</span><span class="o">]-&gt;</span><span class="p">(:</span><span class="n">Instance</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">FROM_SOURCE</span><span class="o">]-&gt;</span><span class="p">(:</span><span class="n">Source</span><span class="p">)</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a><span class="p">(:</span><span class="n">Concept</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">IMPLIES</span><span class="p">|</span><span class="n">SUPPORTS</span><span class="p">|</span><span class="n">CONTRADICTS</span><span class="p">|</span><span class="n">ENABLES</span><span class="p">|</span><span class="n">RELATES_TO</span><span class="o">]-&gt;</span><span class="p">(:</span><span class="n">Concept</span><span class="p">)</span>
</code></pre></div>
<p><strong>Key points</strong>:
- ImageAsset is separate from Source (separation of concerns)
- Both have embeddings in same vector space (Nomic's 768-dimensional space)
- Ontology stored on all nodes for filtering
- Relationships use full vocabulary (not limited to RELATES_TO)</p>
<h3 id="3-technology-stack">3. Technology Stack</h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Technology</th>
<th>License</th>
<th>Why</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Vision Model (Primary)</strong></td>
<td>GPT-4o Vision</td>
<td>Proprietary</td>
<td><strong>Research validated</strong>: 100% reliable, excellent literal descriptions, ~$0.01/image</td>
</tr>
<tr>
<td><strong>Vision Model (Alternate)</strong></td>
<td>Claude 3.5 Sonnet Vision</td>
<td>Proprietary</td>
<td>Similar quality to GPT-4o, provider diversity</td>
</tr>
<tr>
<td><strong>Vision Model (Local)</strong></td>
<td>Ollama (Granite, LLaVA)</td>
<td>Apache 2.0</td>
<td><strong>Optional</strong>: Pattern in place, but inconsistent quality per research</td>
</tr>
<tr>
<td><strong>Image Embeddings</strong></td>
<td>Nomic Embed Vision v1.5</td>
<td>Apache 2.0</td>
<td><strong>Research validated</strong>: 0.847 clustering quality (27% better than CLIP), 768-dim</td>
</tr>
<tr>
<td><strong>Text Embeddings</strong></td>
<td>Nomic Embed Text v1.5</td>
<td>Apache 2.0</td>
<td>Already using, consistent with vision embeddings (same 768-dim space)</td>
</tr>
<tr>
<td><strong>Object Storage</strong></td>
<td>Garage</td>
<td>AGPL v3</td>
<td>Network-isolated (S3 API only), no code integration, cooperative governance</td>
</tr>
<tr>
<td><strong>PDF Conversion</strong></td>
<td>External (user's choice)</td>
<td>N/A</td>
<td>pdftoppm, ImageMagick, etc. - out of our scope</td>
</tr>
</tbody>
</table>
<p><strong>Research findings</strong> (Nov 2025, <code>docs/research/vision-testing/</code>):
- <strong>Vision quality</strong>: GPT-4o:  (100% reliable), Granite:  (random refusals)
- <strong>Embedding quality</strong>: Nomic Vision: 0.847 avg similarity, CLIP: 0.666, OpenAI API: 0.542
- <strong>Decision</strong>: GPT-4o primary, abstraction supports Anthropic/Ollama for flexibility
- <strong>Cost</strong>: ~$10 per 1000 images (GPT-4o) vs $0 (local, but unreliable)</p>
<p><strong>Note on Garage licensing</strong>: While Garage is AGPL v3, we interact with it purely through the S3-compatible API (network boundary). We never link against Garage code, import Garage libraries, or modify Garage source. This is similar to using PostgreSQL (also network service) - AGPL network copyleft does not apply across API boundaries. Unlike MinIO (which moved to Enterprise licensing), Garage is maintained by a cooperative and will remain open-source.</p>
<hr />
<h2 id="embedding-architecture-critical-design-principle">Embedding Architecture - Critical Design Principle</h2>
<p><strong> IMPORTANT</strong>: The system uses a <strong>unified concept space</strong> with <strong>system-wide embedding consistency</strong>. Understanding this is critical to understanding how image and document concepts relate.</p>
<h3 id="three-types-of-embeddings">Three Types of Embeddings</h3>
<p><strong>1. Visual Embeddings (Image Sources Only)</strong>
- <strong>Model</strong>: Nomic Vision v1.5 (768-dim) - <strong>ONE model system-wide</strong>
- <strong>Stored on</strong>: <code>sources.visual_embedding</code> (only when <code>content_type='image'</code>)
- <strong>Generated from</strong>: Raw image pixels
- <strong>Used for</strong>: Visual-to-visual similarity search (find similar-looking images)
- <strong>NOT used for</strong>: Concept matching</p>
<p><strong>2. Text Embeddings on Source Prose</strong>
- <strong>Model</strong>: System-wide text embedding model (Nomic Text v1.5 OR OpenAI) - <strong>ONE model system-wide</strong>
- <strong>Stored on</strong>: <code>sources.embedding</code>
- <strong>Generated from</strong>:
  - Document sources: Original document text
  - Image sources: Vision model prose description
- <strong>Used for</strong>: Direct text query  search source descriptions (cross-modal bridge)</p>
<p><strong>3. Text Embeddings on Concepts</strong>
- <strong>Model</strong>: <strong>SAME</strong> system-wide text embedding model as #2
- <strong>Stored on</strong>: <code>concept</code> nodes
- <strong>Generated from</strong>: Concept labels extracted by LLM
- <strong>Used for</strong>: Concept matching, merging, and semantic search</p>
<h3 id="why-this-matters-automatic-cross-source-concept-matching">Why This Matters: Automatic Cross-Source Concept Matching</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>Document: &quot;The fog comes on little cat feet&quot; (Carl Sandburg poem)
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    LLM extraction
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>Concept: &quot;little cat feet&quot;  Text embedding vector A (from system-wide text model)
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>Image: Photo of cat paws
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    Vision model (GPT-4o)
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>Prose: &quot;Close-up of little cat feet with soft paw pads&quot;
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    LLM extraction (SAME extraction pipeline)
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>Concept: &quot;little cat feet&quot;  Text embedding vector B (from SAME text model)
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>   
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>Cosine similarity(A, B) = 0.92 (high similarity)
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>   
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>Concepts MERGE or get SUPPORTS edge (automatic via existing matching logic)
</code></pre></div>
<p><strong>Query "little cat feet":</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1">-- Search concept embeddings (ONE unified concept space)</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">concepts</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">cosine_similarity</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">embedding</span><span class="p">,</span><span class="w"> </span><span class="n">query_embedding</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="c1">-- Returns ONE concept &quot;little cat feet&quot; with TWO sources:</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="c1">--   1. Source: Sandburg poem (content_type=&#39;document&#39;)</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="c1">--   2. Source: Cat paws photo (content_type=&#39;image&#39;)</span>
</code></pre></div></p>
<h3 id="key-principles">Key Principles</h3>
<ol>
<li><strong>No "image concepts" vs "document concepts"</strong> - All concepts live in the same namespace, use the same text embeddings</li>
<li><strong>System-wide embedding consistency</strong> - ONE text model, ONE visual model</li>
<li><strong>Changing embedding models = rebuild entire graph</strong> - No mixing 768-dim and 1536-dim embeddings</li>
<li><strong>Prose is the semantic bridge</strong> - Image descriptions use text embeddings, enabling automatic concept matching</li>
<li><strong>Visual embeddings are orthogonal</strong> - Used only for visual similarity, not concept matching</li>
</ol>
<h3 id="search-paths-enabled">Search Paths Enabled</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>Path 1 (Concept-based):
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>  Text query  Concept embeddings  Find concepts  Get all sources (images + documents)
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>Path 2 (Source-based):
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>  Text query  Source prose embeddings  Find images with matching descriptions
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>Path 3 (Visual):
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>  Upload image  Visual embeddings  Find visually similar images
</code></pre></div>
<p>All three paths work together because:
- Path 1 &amp; 2 use the SAME text embedding model
- Path 3 uses visual embeddings (separate space, separate use case)
- The hairpin pattern (image  prose  concepts) collapses multimodal into text-based matching</p>
<hr />
<h2 id="implementation-unified-ingestion-pipeline">Implementation: Unified Ingestion Pipeline</h2>
<h3 id="ingestion-flow-hairpin-pattern">Ingestion Flow (Hairpin Pattern)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">ingest_image</span><span class="p">(</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="n">image_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="n">ontology</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="sd">    Single unified ingestion pipeline with visual context injection.</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="sd">    Images follow a &quot;hairpin&quot; route through text upsert.</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="c1"># </span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="c1"># PHASE 1: Visual Analysis (Image-Specific)</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>    <span class="c1"># </span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>    <span class="c1"># 1. Generate image embedding for similarity search</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>    <span class="n">image_embedding</span> <span class="o">=</span> <span class="k">await</span> <span class="n">nomic_vision</span><span class="o">.</span><span class="n">embed_image</span><span class="p">(</span><span class="n">image_bytes</span><span class="p">)</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>    <span class="c1"># 2. Search for visually similar images WITH ONTOLOGY AWARENESS</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>    <span class="n">similar_images</span> <span class="o">=</span> <span class="k">await</span> <span class="n">search_similar_images_with_ontology</span><span class="p">(</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>        <span class="n">embedding</span><span class="o">=</span><span class="n">image_embedding</span><span class="p">,</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>        <span class="n">target_ontology</span><span class="o">=</span><span class="n">ontology</span><span class="p">,</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>        <span class="n">min_similarity</span><span class="o">=</span><span class="mf">0.60</span><span class="p">,</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>        <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>        <span class="n">ontology_boost</span><span class="o">=</span><span class="mf">0.1</span>  <span class="c1"># Boost same-ontology results</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>    <span class="p">)</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>    <span class="c1"># 3. Build visual context from similar images</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>    <span class="n">visual_context</span> <span class="o">=</span> <span class="k">await</span> <span class="n">build_visual_context</span><span class="p">(</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>        <span class="n">similar_images</span><span class="o">=</span><span class="n">similar_images</span><span class="p">,</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>        <span class="n">target_ontology</span><span class="o">=</span><span class="n">ontology</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>    <span class="p">)</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>    <span class="c1"># Returns: {</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>    <span class="c1">#   &quot;target_ontology&quot;: &quot;Watts Lectures&quot;,</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>    <span class="c1">#   &quot;similar_images&quot;: [</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>    <span class="c1">#     {</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>    <span class="c1">#       &quot;similarity&quot;: 0.87,</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>    <span class="c1">#       &quot;ontology&quot;: &quot;Watts Lectures&quot;,</span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>    <span class="c1">#       &quot;same_ontology&quot;: True,</span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>    <span class="c1">#       &quot;description&quot;: &quot;Diagram showing layers of ego consciousness...&quot;,</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>    <span class="c1">#       &quot;concepts&quot;: [&quot;ego transcendence&quot;, &quot;self-awareness layers&quot;],</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>    <span class="c1">#       &quot;document&quot;: &quot;watts_lecture_1_page_1.jpg&quot;</span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>    <span class="c1">#     }</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>    <span class="c1">#   ]</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>    <span class="c1"># }</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>    <span class="c1"># 4. Generate prose description using vision model (GPT-4o by default)</span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>    <span class="n">vision_backend</span> <span class="o">=</span> <span class="n">get_vision_backend</span><span class="p">()</span>  <span class="c1"># Returns OpenAIVisionBackend</span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>    <span class="n">prose_description</span> <span class="o">=</span> <span class="k">await</span> <span class="n">vision_backend</span><span class="o">.</span><span class="n">describe_image</span><span class="p">(</span>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>        <span class="n">image_bytes</span><span class="p">,</span>
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>        <span class="n">prompt</span><span class="o">=</span><span class="n">LITERAL_DESCRIPTION_PROMPT</span>  <span class="c1"># Literal, non-interpretive</span>
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>    <span class="p">)</span>
<a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a>
<a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>    <span class="c1"># 5. Store original image in Garage (organized by ontology)</span>
<a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a>    <span class="n">asset_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a>    <span class="n">object_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;images/</span><span class="si">{</span><span class="n">ontology</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_id</span><span class="si">}</span><span class="s2">.jpg&quot;</span>
<a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a>    <span class="k">await</span> <span class="n">garage_client</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span>
<a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>        <span class="n">bucket</span><span class="o">=</span><span class="s2">&quot;knowledge-graph-images&quot;</span><span class="p">,</span>
<a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a>        <span class="n">key</span><span class="o">=</span><span class="n">object_key</span><span class="p">,</span>
<a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a>        <span class="n">data</span><span class="o">=</span><span class="n">image_bytes</span><span class="p">,</span>
<a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a>        <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;image/jpeg&quot;</span>
<a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a>    <span class="p">)</span>
<a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a>
<a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a>    <span class="c1"># 6. Create ImageAsset node in graph</span>
<a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a>    <span class="n">image_asset</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_image_asset</span><span class="p">(</span>
<a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a>        <span class="n">asset_id</span><span class="o">=</span><span class="n">asset_id</span><span class="p">,</span>
<a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a>        <span class="n">object_key</span><span class="o">=</span><span class="n">object_key</span><span class="p">,</span>
<a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a>        <span class="n">image_embedding</span><span class="o">=</span><span class="n">image_embedding</span><span class="p">,</span>
<a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a>        <span class="n">ontology</span><span class="o">=</span><span class="n">ontology</span><span class="p">,</span>
<a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a>        <span class="n">vision_model</span><span class="o">=</span><span class="s2">&quot;granite-vision-3.3:2b&quot;</span><span class="p">,</span>
<a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>        <span class="n">embedding_model</span><span class="o">=</span><span class="s2">&quot;nomic-embed-vision:latest&quot;</span>
<a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a>    <span class="p">)</span>
<a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>
<a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a>    <span class="c1"># 7. Create Source node with prose description</span>
<a id="__codelineno-9-74" name="__codelineno-9-74" href="#__codelineno-9-74"></a>    <span class="n">source</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_source</span><span class="p">(</span>
<a id="__codelineno-9-75" name="__codelineno-9-75" href="#__codelineno-9-75"></a>        <span class="n">document</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
<a id="__codelineno-9-76" name="__codelineno-9-76" href="#__codelineno-9-76"></a>        <span class="n">full_text</span><span class="o">=</span><span class="n">prose_description</span><span class="p">,</span>
<a id="__codelineno-9-77" name="__codelineno-9-77" href="#__codelineno-9-77"></a>        <span class="n">ontology</span><span class="o">=</span><span class="n">ontology</span>
<a id="__codelineno-9-78" name="__codelineno-9-78" href="#__codelineno-9-78"></a>    <span class="p">)</span>
<a id="__codelineno-9-79" name="__codelineno-9-79" href="#__codelineno-9-79"></a>
<a id="__codelineno-9-80" name="__codelineno-9-80" href="#__codelineno-9-80"></a>    <span class="c1"># 8. Link Source to ImageAsset</span>
<a id="__codelineno-9-81" name="__codelineno-9-81" href="#__codelineno-9-81"></a>    <span class="k">await</span> <span class="n">create_relationship</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;HAS_IMAGE&quot;</span><span class="p">,</span> <span class="n">image_asset</span><span class="p">)</span>
<a id="__codelineno-9-82" name="__codelineno-9-82" href="#__codelineno-9-82"></a>
<a id="__codelineno-9-83" name="__codelineno-9-83" href="#__codelineno-9-83"></a>    <span class="c1"># </span>
<a id="__codelineno-9-84" name="__codelineno-9-84" href="#__codelineno-9-84"></a>    <span class="c1"># PHASE 2: HAIRPIN - Feed into Existing Text Upsert Pipeline</span>
<a id="__codelineno-9-85" name="__codelineno-9-85" href="#__codelineno-9-85"></a>    <span class="c1"># </span>
<a id="__codelineno-9-86" name="__codelineno-9-86" href="#__codelineno-9-86"></a>
<a id="__codelineno-9-87" name="__codelineno-9-87" href="#__codelineno-9-87"></a>    <span class="c1"># 9. Extract concepts with VISUAL CONTEXT INJECTED</span>
<a id="__codelineno-9-88" name="__codelineno-9-88" href="#__codelineno-9-88"></a>    <span class="n">concepts</span> <span class="o">=</span> <span class="k">await</span> <span class="n">extract_and_upsert_concepts</span><span class="p">(</span>
<a id="__codelineno-9-89" name="__codelineno-9-89" href="#__codelineno-9-89"></a>        <span class="n">text</span><span class="o">=</span><span class="n">prose_description</span><span class="p">,</span>
<a id="__codelineno-9-90" name="__codelineno-9-90" href="#__codelineno-9-90"></a>        <span class="n">source_id</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">source_id</span><span class="p">,</span>
<a id="__codelineno-9-91" name="__codelineno-9-91" href="#__codelineno-9-91"></a>        <span class="n">ontology</span><span class="o">=</span><span class="n">ontology</span><span class="p">,</span>
<a id="__codelineno-9-92" name="__codelineno-9-92" href="#__codelineno-9-92"></a>        <span class="n">additional_context</span><span class="o">=</span><span class="n">visual_context</span>  <span class="c1">#  Visual context injection!</span>
<a id="__codelineno-9-93" name="__codelineno-9-93" href="#__codelineno-9-93"></a>    <span class="p">)</span>
<a id="__codelineno-9-94" name="__codelineno-9-94" href="#__codelineno-9-94"></a>
<a id="__codelineno-9-95" name="__codelineno-9-95" href="#__codelineno-9-95"></a>    <span class="c1"># From here, everything is identical to text ingestion:</span>
<a id="__codelineno-9-96" name="__codelineno-9-96" href="#__codelineno-9-96"></a>    <span class="c1"># - LLM extracts concepts with visual context</span>
<a id="__codelineno-9-97" name="__codelineno-9-97" href="#__codelineno-9-97"></a>    <span class="c1"># - Searches for existing concepts by embedding similarity</span>
<a id="__codelineno-9-98" name="__codelineno-9-98" href="#__codelineno-9-98"></a>    <span class="c1"># - Recursive upsert (merge or create)</span>
<a id="__codelineno-9-99" name="__codelineno-9-99" href="#__codelineno-9-99"></a>    <span class="c1"># - Creates relationships (IMPLIES, SUPPORTS, etc.)</span>
<a id="__codelineno-9-100" name="__codelineno-9-100" href="#__codelineno-9-100"></a>    <span class="c1"># - All existing logic just works!</span>
<a id="__codelineno-9-101" name="__codelineno-9-101" href="#__codelineno-9-101"></a>
<a id="__codelineno-9-102" name="__codelineno-9-102" href="#__codelineno-9-102"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-9-103" name="__codelineno-9-103" href="#__codelineno-9-103"></a>        <span class="s2">&quot;source_id&quot;</span><span class="p">:</span> <span class="n">source</span><span class="o">.</span><span class="n">source_id</span><span class="p">,</span>
<a id="__codelineno-9-104" name="__codelineno-9-104" href="#__codelineno-9-104"></a>        <span class="s2">&quot;asset_id&quot;</span><span class="p">:</span> <span class="n">asset_id</span><span class="p">,</span>
<a id="__codelineno-9-105" name="__codelineno-9-105" href="#__codelineno-9-105"></a>        <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;/api/sources/</span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">source_id</span><span class="si">}</span><span class="s2">/image&quot;</span><span class="p">,</span>
<a id="__codelineno-9-106" name="__codelineno-9-106" href="#__codelineno-9-106"></a>        <span class="s2">&quot;concept_ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">concept_id</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">concepts</span><span class="p">],</span>
<a id="__codelineno-9-107" name="__codelineno-9-107" href="#__codelineno-9-107"></a>        <span class="s2">&quot;prose_description&quot;</span><span class="p">:</span> <span class="n">prose_description</span><span class="p">,</span>
<a id="__codelineno-9-108" name="__codelineno-9-108" href="#__codelineno-9-108"></a>        <span class="s2">&quot;visual_context_used&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">visual_context</span><span class="p">[</span><span class="s2">&quot;similar_images&quot;</span><span class="p">])</span>
<a id="__codelineno-9-109" name="__codelineno-9-109" href="#__codelineno-9-109"></a>    <span class="p">}</span>
</code></pre></div>
<h3 id="visual-context-in-llm-prompt">Visual Context in LLM Prompt</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">extract_and_upsert_concepts</span><span class="p">(</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    <span class="n">ontology</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    <span class="n">additional_context</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Concept</span><span class="p">]:</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="sd">    Unified concept extraction with optional visual context.</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="sd">    Works for both pure text and image-derived text.</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>    <span class="c1"># Base extraction prompt</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    <span class="n">base_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="s2">Extract semantic concepts from the following text for the &quot;</span><span class="si">{</span><span class="n">ontology</span><span class="si">}</span><span class="s2">&quot; ontology.</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="s2">For each concept, identify:</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="s2">1. The concept label (clear, concise phrase)</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="s2">2. Relationships to other concepts with type, target, and strength (0.0-1.0)</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="s2">Valid relationship types:</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="s2">- IMPLIES: Logical consequence, prerequisite, sequential dependency</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="s2">- SUPPORTS: Corroborating evidence, reinforcement</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="s2">- CONTRADICTS: Opposing viewpoint, alternative approach</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="s2">- ENABLES: Provides foundation for, makes possible</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="s2">- RELATES_TO: General connection, shared context or visualization</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="s2">- SPECIALIZES: More specific version of a concept</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="s2">- GENERALIZES: Broader category that encompasses concept</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="s2">Text to analyze:</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="si">{</span><span class="n">text</span><span class="si">}</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>    <span class="c1"># INJECT visual context if present</span>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>    <span class="k">if</span> <span class="n">additional_context</span> <span class="ow">and</span> <span class="s2">&quot;similar_images&quot;</span> <span class="ow">in</span> <span class="n">additional_context</span><span class="p">:</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>        <span class="n">visual_section</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a><span class="s2">## Visual Context</span>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a><span class="s2">This text was extracted from an image in the &quot;</span><span class="si">{</span><span class="n">additional_context</span><span class="p">[</span><span class="s1">&#39;target_ontology&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot; ontology.</span>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a><span class="s2">It is visually similar to the following images:</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">similar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">additional_context</span><span class="p">[</span><span class="s2">&quot;similar_images&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a>            <span class="n">ontology_marker</span> <span class="o">=</span> <span class="s2">&quot; SAME ONTOLOGY&quot;</span> <span class="k">if</span> <span class="n">similar</span><span class="p">[</span><span class="s2">&quot;same_ontology&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;(from &#39;</span><span class="si">{</span><span class="n">similar</span><span class="p">[</span><span class="s1">&#39;ontology&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; ontology)&quot;</span>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a>            <span class="n">visual_section</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a><span class="s2">### Similar Image </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> (similarity: </span><span class="si">{</span><span class="n">similar</span><span class="p">[</span><span class="s1">&#39;similarity&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">ontology_marker</span><span class="si">}</span>
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a><span class="s2">Source document: </span><span class="si">{</span><span class="n">similar</span><span class="p">[</span><span class="s1">&#39;document&#39;</span><span class="p">]</span><span class="si">}</span>
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a><span class="s2">Description: </span><span class="si">{</span><span class="n">similar</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span>
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a><span class="s2">Concepts: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">similar</span><span class="p">[</span><span class="s1">&#39;concepts&#39;</span><span class="p">])</span><span class="si">}</span>
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a>
<a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a>        <span class="n">visual_section</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a><span class="s2">When creating relationships, consider:</span>
<a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a><span class="s2">- Sequential diagrams  IMPLIES (temporal/logical dependency)</span>
<a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a><span class="s2">- Corroborating evidence  SUPPORTS (reinforcement)</span>
<a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a><span class="s2">- Alternative approaches  CONTRADICTS (opposing methods)</span>
<a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a><span class="s2">- Foundational concepts  ENABLES (prerequisite)</span>
<a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a><span class="s2">- Shared visualization style  RELATES_TO (similar representation)</span>
<a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a>
<a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a><span class="s2">Same-ontology images provide strong evidence for relationships (likely same document/context).</span>
<a id="__codelineno-10-62" name="__codelineno-10-62" href="#__codelineno-10-62"></a><span class="s2">Cross-ontology images may indicate genuine conceptual connections or coincidental visual similarity.</span>
<a id="__codelineno-10-63" name="__codelineno-10-63" href="#__codelineno-10-63"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-10-64" name="__codelineno-10-64" href="#__codelineno-10-64"></a>
<a id="__codelineno-10-65" name="__codelineno-10-65" href="#__codelineno-10-65"></a>        <span class="n">base_prompt</span> <span class="o">=</span> <span class="n">base_prompt</span> <span class="o">+</span> <span class="n">visual_section</span>
<a id="__codelineno-10-66" name="__codelineno-10-66" href="#__codelineno-10-66"></a>
<a id="__codelineno-10-67" name="__codelineno-10-67" href="#__codelineno-10-67"></a>    <span class="c1"># Extract concepts from LLM</span>
<a id="__codelineno-10-68" name="__codelineno-10-68" href="#__codelineno-10-68"></a>    <span class="n">extraction</span> <span class="o">=</span> <span class="k">await</span> <span class="n">llm_provider</span><span class="o">.</span><span class="n">extract_concepts</span><span class="p">(</span><span class="n">base_prompt</span><span class="p">)</span>
<a id="__codelineno-10-69" name="__codelineno-10-69" href="#__codelineno-10-69"></a>
<a id="__codelineno-10-70" name="__codelineno-10-70" href="#__codelineno-10-70"></a>    <span class="c1"># Parse and validate</span>
<a id="__codelineno-10-71" name="__codelineno-10-71" href="#__codelineno-10-71"></a>    <span class="n">concepts</span> <span class="o">=</span> <span class="n">parse_extraction_response</span><span class="p">(</span><span class="n">extraction</span><span class="p">)</span>
<a id="__codelineno-10-72" name="__codelineno-10-72" href="#__codelineno-10-72"></a>
<a id="__codelineno-10-73" name="__codelineno-10-73" href="#__codelineno-10-73"></a>    <span class="c1"># EXISTING RECURSIVE UPSERT (unchanged!)</span>
<a id="__codelineno-10-74" name="__codelineno-10-74" href="#__codelineno-10-74"></a>    <span class="n">upserted_concepts</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-10-75" name="__codelineno-10-75" href="#__codelineno-10-75"></a>    <span class="k">for</span> <span class="n">concept</span> <span class="ow">in</span> <span class="n">concepts</span><span class="p">:</span>
<a id="__codelineno-10-76" name="__codelineno-10-76" href="#__codelineno-10-76"></a>        <span class="c1"># Search for existing concept by embedding similarity</span>
<a id="__codelineno-10-77" name="__codelineno-10-77" href="#__codelineno-10-77"></a>        <span class="n">existing</span> <span class="o">=</span> <span class="k">await</span> <span class="n">search_concepts_by_embedding</span><span class="p">(</span>
<a id="__codelineno-10-78" name="__codelineno-10-78" href="#__codelineno-10-78"></a>            <span class="n">embedding</span><span class="o">=</span><span class="n">concept</span><span class="o">.</span><span class="n">embedding</span><span class="p">,</span>
<a id="__codelineno-10-79" name="__codelineno-10-79" href="#__codelineno-10-79"></a>            <span class="n">ontology</span><span class="o">=</span><span class="n">ontology</span><span class="p">,</span>
<a id="__codelineno-10-80" name="__codelineno-10-80" href="#__codelineno-10-80"></a>            <span class="n">threshold</span><span class="o">=</span><span class="mf">0.85</span>
<a id="__codelineno-10-81" name="__codelineno-10-81" href="#__codelineno-10-81"></a>        <span class="p">)</span>
<a id="__codelineno-10-82" name="__codelineno-10-82" href="#__codelineno-10-82"></a>
<a id="__codelineno-10-83" name="__codelineno-10-83" href="#__codelineno-10-83"></a>        <span class="k">if</span> <span class="n">existing</span><span class="p">:</span>
<a id="__codelineno-10-84" name="__codelineno-10-84" href="#__codelineno-10-84"></a>            <span class="c1"># Merge into existing concept</span>
<a id="__codelineno-10-85" name="__codelineno-10-85" href="#__codelineno-10-85"></a>            <span class="n">concept_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">upsert_concept</span><span class="p">(</span><span class="n">existing</span><span class="o">.</span><span class="n">concept_id</span><span class="p">,</span> <span class="n">concept</span><span class="p">,</span> <span class="n">source_id</span><span class="p">)</span>
<a id="__codelineno-10-86" name="__codelineno-10-86" href="#__codelineno-10-86"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-87" name="__codelineno-10-87" href="#__codelineno-10-87"></a>            <span class="c1"># Create new concept</span>
<a id="__codelineno-10-88" name="__codelineno-10-88" href="#__codelineno-10-88"></a>            <span class="n">concept_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_concept</span><span class="p">(</span><span class="n">concept</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">ontology</span><span class="p">)</span>
<a id="__codelineno-10-89" name="__codelineno-10-89" href="#__codelineno-10-89"></a>
<a id="__codelineno-10-90" name="__codelineno-10-90" href="#__codelineno-10-90"></a>        <span class="n">upserted_concepts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">concept_id</span><span class="p">)</span>
<a id="__codelineno-10-91" name="__codelineno-10-91" href="#__codelineno-10-91"></a>
<a id="__codelineno-10-92" name="__codelineno-10-92" href="#__codelineno-10-92"></a>        <span class="c1"># Create relationships (LLM chose types based on visual context)</span>
<a id="__codelineno-10-93" name="__codelineno-10-93" href="#__codelineno-10-93"></a>        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">concept</span><span class="o">.</span><span class="n">relationships</span><span class="p">:</span>
<a id="__codelineno-10-94" name="__codelineno-10-94" href="#__codelineno-10-94"></a>            <span class="k">await</span> <span class="n">create_concept_relationship</span><span class="p">(</span>
<a id="__codelineno-10-95" name="__codelineno-10-95" href="#__codelineno-10-95"></a>                <span class="n">from_concept_id</span><span class="o">=</span><span class="n">concept_id</span><span class="p">,</span>
<a id="__codelineno-10-96" name="__codelineno-10-96" href="#__codelineno-10-96"></a>                <span class="n">to_concept_id</span><span class="o">=</span><span class="n">rel</span><span class="o">.</span><span class="n">target_concept_id</span><span class="p">,</span>
<a id="__codelineno-10-97" name="__codelineno-10-97" href="#__codelineno-10-97"></a>                <span class="n">relationship_type</span><span class="o">=</span><span class="n">rel</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>  <span class="c1"># IMPLIES, SUPPORTS, CONTRADICTS, etc.</span>
<a id="__codelineno-10-98" name="__codelineno-10-98" href="#__codelineno-10-98"></a>                <span class="n">strength</span><span class="o">=</span><span class="n">rel</span><span class="o">.</span><span class="n">strength</span><span class="p">,</span>
<a id="__codelineno-10-99" name="__codelineno-10-99" href="#__codelineno-10-99"></a>                <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-10-100" name="__codelineno-10-100" href="#__codelineno-10-100"></a>                    <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span>
<a id="__codelineno-10-101" name="__codelineno-10-101" href="#__codelineno-10-101"></a>                    <span class="s2">&quot;via_visual_context&quot;</span><span class="p">:</span> <span class="n">additional_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-10-102" name="__codelineno-10-102" href="#__codelineno-10-102"></a>                <span class="p">}</span>
<a id="__codelineno-10-103" name="__codelineno-10-103" href="#__codelineno-10-103"></a>            <span class="p">)</span>
<a id="__codelineno-10-104" name="__codelineno-10-104" href="#__codelineno-10-104"></a>
<a id="__codelineno-10-105" name="__codelineno-10-105" href="#__codelineno-10-105"></a>    <span class="k">return</span> <span class="n">upserted_concepts</span>
</code></pre></div>
<hr />
<h2 id="multimodal-search-capabilities">Multimodal Search Capabilities</h2>
<p>The dual embedding strategy (image + text in same vector space) enables four search modes:</p>
<h3 id="1-text-concepts-existing-unchanged">1. Text  Concepts (Existing, Unchanged)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">POST</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">search</span><span class="o">/</span><span class="n">concepts</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">Body</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;recursive algorithms&quot;</span><span class="p">,</span> <span class="s2">&quot;ontology&quot;</span><span class="p">:</span> <span class="s2">&quot;Computer Science&quot;</span> <span class="p">}</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c1"># Searches concept text embeddings</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="c1"># Returns: Concepts matching query</span>
</code></pre></div>
<h3 id="2-image-images-new-visual-similarity">2. Image  Images (NEW: Visual Similarity)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">POST</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">search</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">image</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">Body</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">uploaded</span><span class="o">-</span><span class="n">flowchart</span><span class="o">.</span><span class="n">jpg</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;ontology&quot;</span><span class="p">:</span> <span class="s2">&quot;Computer Science&quot;</span> <span class="p">}</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="c1"># Embeds uploaded image</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="c1"># Searches image embeddings</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="c1"># Returns: Visually similar images + their concepts</span>
</code></pre></div>
<h3 id="3-text-images-new-cross-modal">3. Text  Images (NEW: Cross-Modal)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">POST</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">search</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">text</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">Body</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;architecture diagram&quot;</span><span class="p">,</span> <span class="s2">&quot;ontology&quot;</span><span class="p">:</span> <span class="s2">&quot;Computer Science&quot;</span> <span class="p">}</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="c1"># Embeds query text</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="c1"># Searches image embeddings (same vector space!)</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="c1"># Returns: Images containing architecture diagrams</span>
</code></pre></div>
<h3 id="4-image-concepts-new-visual-to-semantic">4. Image  Concepts (NEW: Visual to Semantic)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">POST</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">search</span><span class="o">/</span><span class="n">concepts</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">image</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">Body</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">uploaded</span><span class="o">-</span><span class="n">diagram</span><span class="o">.</span><span class="n">jpg</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;ontology&quot;</span><span class="p">:</span> <span class="s2">&quot;Computer Science&quot;</span> <span class="p">}</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c1"># Embeds uploaded image</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="c1"># Finds visually similar images</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="c1"># Returns: Concepts from those images</span>
</code></pre></div>
<hr />
<h2 id="example-scenarios">Example Scenarios</h2>
<h3 id="scenario-1-same-document-text-images">Scenario 1: Same Document, Text + Images</h3>
<p><strong>Step 1</strong>: User ingests <code>watts_lecture_1.txt</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>Ontology: &quot;Watts Lectures&quot;
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>Concepts extracted: [&quot;ego transcendence&quot;, &quot;recursive awareness&quot;, &quot;self-reference&quot;]
</code></pre></div></p>
<p><strong>Step 2</strong>: User converts slide deck <code>watts_lecture_1.pdf</code> to images, ingests page 1
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Ontology: &quot;Watts Lectures&quot;
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>Visual search: No similar images yet
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>Concepts extracted: [&quot;layers of consciousness&quot;, &quot;observer-observed paradox&quot;]
</code></pre></div></p>
<p><strong>Step 3</strong>: User ingests page 2 (flowchart of recursive loops)
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>Ontology: &quot;Watts Lectures&quot;
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>Visual search finds:
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>  - Page 1 (similarity: 0.72)  SAME ONTOLOGY
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>  - Description: &quot;Diagram showing layers of ego consciousness&quot;
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>  - Concepts: [&quot;layers of consciousness&quot;, &quot;observer-observed paradox&quot;]
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>LLM sees visual context:
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>  &quot;This image is from the same ontology as a diagram showing consciousness layers.
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>   Consider strong relationships as they&#39;re likely from the same lecture.&quot;
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>LLM extracts concept: &quot;recursive self-reference&quot;
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>LLM creates relationship:
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>  &quot;recursive self-reference&quot; -[ENABLES {strength: 0.90}]-&gt; &quot;ego transcendence&quot;
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>  Reason: &quot;Understanding recursive nature enables transcendence; same lecture context&quot;
</code></pre></div></p>
<p><strong>Result</strong>: Text and images from same document are strongly linked.</p>
<h3 id="scenario-2-cross-domain-visual-discovery">Scenario 2: Cross-Domain Visual Discovery</h3>
<p><strong>Step 1</strong>: Ingest flowchart in "Watts Lectures"
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>Image: Flowchart showing &quot;recursive awareness feedback loop&quot;
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>Concept: &quot;recursive self-reference&quot;
</code></pre></div></p>
<p><strong>Step 2</strong>: Later, ingest flowchart in "Computer Science"
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>Image: Flowchart showing &quot;recursive function call stack&quot;
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>Visual search finds:
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>  - Watts flowchart (similarity: 0.81) (from &#39;Watts Lectures&#39; ontology)
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>LLM sees visual context:
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>  &quot;Cross-ontology image with similar flowchart structure.
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>   Consider if there&#39;s genuine conceptual parallel or just visual coincidence.&quot;
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>LLM extracts concept: &quot;recursive function call&quot;
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>LLM creates relationship:
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>  &quot;recursive function call&quot; -[RELATES_TO {strength: 0.70}]-&gt; &quot;recursive self-reference&quot;
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>  Reason: &quot;Both describe recursive patterns in different domains; shared structural similarity&quot;
</code></pre></div></p>
<p><strong>Result</strong>: Cross-domain connection discovered through visual similarity.</p>
<h3 id="scenario-3-visual-pattern-clustering">Scenario 3: Visual Pattern Clustering</h3>
<p><strong>Over time</strong>: User ingests 20 documents with bar graphs across ontologies
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>Ontology: &quot;Sales Reports&quot; - 5 bar graphs
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>Ontology: &quot;HR Analytics&quot; - 3 bar graphs
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>Ontology: &quot;Product Metrics&quot; - 12 bar graphs
</code></pre></div></p>
<p><strong>Visual clustering emerges</strong>:
- All bar graphs are visually similar (0.75-0.90 similarity)
- Concepts get RELATES_TO relationships based on shared visualization
- User can query: "Show me all concepts visualized as bar graphs"
- System returns: Concepts from all three ontologies that use bar graph visualization</p>
<p><strong>Insight</strong>: Visual patterns reveal presentation style, even across unrelated domains.</p>
<hr />
<h2 id="api-routes">API Routes</h2>
<h3 id="image-ingestion">Image Ingestion</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">POST</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">ingest</span><span class="o">/</span><span class="n">image</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">multipart</span><span class="o">/</span><span class="n">form</span><span class="o">-</span><span class="n">data</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">Body</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>  <span class="n">image</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>  <span class="n">ontology</span><span class="p">:</span> <span class="s2">&quot;Watts Lectures&quot;</span><span class="p">,</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>  <span class="n">filename</span><span class="p">:</span> <span class="s2">&quot;watts_lecture_1_page_2.jpg&quot;</span>  <span class="c1"># Optional</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="p">}</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="n">Response</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>  <span class="s2">&quot;source_id&quot;</span><span class="p">:</span> <span class="s2">&quot;src-123&quot;</span><span class="p">,</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>  <span class="s2">&quot;asset_id&quot;</span><span class="p">:</span> <span class="s2">&quot;img-456&quot;</span><span class="p">,</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>  <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/sources/src-123/image&quot;</span><span class="p">,</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>  <span class="s2">&quot;concept_ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;concept-789&quot;</span><span class="p">,</span> <span class="s2">&quot;concept-012&quot;</span><span class="p">],</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>  <span class="s2">&quot;prose_description&quot;</span><span class="p">:</span> <span class="s2">&quot;This flowchart shows a recursive awareness loop...&quot;</span><span class="p">,</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>  <span class="s2">&quot;visual_context_used&quot;</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="p">}</span>
</code></pre></div>
<h3 id="image-retrieval">Image Retrieval</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">GET</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">sources</span><span class="o">/</span><span class="p">{</span><span class="n">source_id</span><span class="p">}</span><span class="o">/</span><span class="n">image</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">Query</span><span class="p">:</span> <span class="err">?</span><span class="n">size</span><span class="o">=</span><span class="n">full</span><span class="o">|</span><span class="n">thumb</span>  <span class="c1"># Optional</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="n">Response</span><span class="p">:</span> <span class="n">JPEG</span> <span class="n">image</span> <span class="p">(</span><span class="k">with</span> <span class="n">Cache</span><span class="o">-</span><span class="n">Control</span> <span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="c1"># Alternative: Presigned URL for direct Garage access</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="n">GET</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">sources</span><span class="o">/</span><span class="p">{</span><span class="n">source_id</span><span class="p">}</span><span class="o">/</span><span class="n">image</span><span class="o">/</span><span class="n">presigned</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="n">Response</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>  <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://garage.local/kg-images/images/...&quot;</span><span class="p">,</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>  <span class="s2">&quot;expires_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-11-03T14:45:00Z&quot;</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="p">}</span>
</code></pre></div>
<h3 id="image-similarity-search">Image Similarity Search</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">POST</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">search</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">image</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">multipart</span><span class="o">/</span><span class="n">form</span><span class="o">-</span><span class="n">data</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">Body</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>  <span class="n">image</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>  <span class="n">ontology</span><span class="p">:</span> <span class="s2">&quot;Computer Science&quot;</span><span class="p">,</span>  <span class="c1"># Optional, filters results</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>  <span class="n">limit</span><span class="p">:</span> <span class="mi">10</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="p">}</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="n">Response</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>  <span class="p">{</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>    <span class="s2">&quot;asset_id&quot;</span><span class="p">:</span> <span class="s2">&quot;img-222&quot;</span><span class="p">,</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>    <span class="s2">&quot;similarity&quot;</span><span class="p">:</span> <span class="mf">0.87</span><span class="p">,</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>    <span class="s2">&quot;ontology&quot;</span><span class="p">:</span> <span class="s2">&quot;Computer Science&quot;</span><span class="p">,</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>    <span class="s2">&quot;thumbnail_url&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/sources/src-333/image?size=thumb&quot;</span><span class="p">,</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Flowchart showing algorithm steps...&quot;</span><span class="p">,</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>      <span class="s2">&quot;source_id&quot;</span><span class="p">:</span> <span class="s2">&quot;src-333&quot;</span><span class="p">,</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>      <span class="s2">&quot;document&quot;</span><span class="p">:</span> <span class="s2">&quot;algorithm_lecture_5.jpg&quot;</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>    <span class="p">},</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>    <span class="s2">&quot;concepts&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>      <span class="p">{</span> <span class="s2">&quot;concept_id&quot;</span><span class="p">:</span> <span class="s2">&quot;c-111&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;depth-first search&quot;</span> <span class="p">},</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>      <span class="p">{</span> <span class="s2">&quot;concept_id&quot;</span><span class="p">:</span> <span class="s2">&quot;c-222&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;tree traversal&quot;</span> <span class="p">}</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>    <span class="p">]</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>  <span class="p">}</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="p">]</span>
</code></pre></div>
<h3 id="cross-modal-search-text-images">Cross-Modal Search (Text  Images)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">POST</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">search</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">text</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">Body</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>  <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;architecture diagram&quot;</span><span class="p">,</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>  <span class="s2">&quot;ontology&quot;</span><span class="p">:</span> <span class="s2">&quot;Computer Science&quot;</span><span class="p">,</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>  <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">10</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="p">}</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="n">Response</span><span class="p">:</span> <span class="p">[</span><span class="n">Same</span> <span class="n">structure</span> <span class="k">as</span> <span class="n">by</span><span class="o">-</span><span class="n">image</span> <span class="n">search</span><span class="p">]</span>
</code></pre></div>
<h3 id="visual-to-semantic-search-image-concepts">Visual to Semantic Search (Image  Concepts)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">POST</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">search</span><span class="o">/</span><span class="n">concepts</span><span class="o">/</span><span class="n">by</span><span class="o">-</span><span class="n">image</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">multipart</span><span class="o">/</span><span class="n">form</span><span class="o">-</span><span class="n">data</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="n">Body</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>  <span class="n">image</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">file</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>  <span class="n">ontology</span><span class="p">:</span> <span class="s2">&quot;Computer Science&quot;</span><span class="p">,</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>  <span class="n">limit</span><span class="p">:</span> <span class="mi">10</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="p">}</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="n">Response</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>  <span class="p">{</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>    <span class="s2">&quot;concept_id&quot;</span><span class="p">:</span> <span class="s2">&quot;c-456&quot;</span><span class="p">,</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;event-driven architecture&quot;</span><span class="p">,</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>    <span class="s2">&quot;grounding_strength&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>    <span class="s2">&quot;via_images&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>      <span class="p">{</span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>        <span class="s2">&quot;asset_id&quot;</span><span class="p">:</span> <span class="s2">&quot;img-789&quot;</span><span class="p">,</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>        <span class="s2">&quot;similarity&quot;</span><span class="p">:</span> <span class="mf">0.88</span><span class="p">,</span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>        <span class="s2">&quot;thumbnail_url&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/sources/src-999/image?size=thumb&quot;</span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>      <span class="p">}</span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>    <span class="p">]</span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>  <span class="p">}</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="p">]</span>
</code></pre></div>
<hr />
<h2 id="configuration">Configuration</h2>
<h3 id="environment-variables">Environment Variables</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># Vision Model (image  text) - PRIMARY: OpenAI GPT-4o</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="nv">VISION_PROVIDER</span><span class="o">=</span>openai<span class="w">  </span><span class="c1"># Options: openai (recommended), anthropic, ollama</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="nv">VISION_MODEL</span><span class="o">=</span>gpt-4o<span class="w">  </span><span class="c1"># or gpt-4o-mini for lower cost</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="nv">OPENAI_API_KEY</span><span class="o">=</span>sk-...
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="c1"># For Anthropic (alternate provider)</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="c1"># VISION_PROVIDER=anthropic</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="c1"># VISION_MODEL=claude-3-5-sonnet-20241022  # or claude-3-opus, claude-3-haiku</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="c1"># ANTHROPIC_API_KEY=sk-ant-...</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="c1"># For Ollama (optional local fallback - not recommended per research)</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="c1"># VISION_PROVIDER=ollama</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="c1"># VISION_MODEL=granite-vision-3.3:2b  # or llava, etc.</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="c1"># Note: Research shows inconsistent quality, use only if cloud unavailable</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="c1"># Image Embeddings (image  vector) - Nomic Vision v1.5 (local, transformers)</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="c1"># Note: Uses transformers library, not Ollama</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="nv">IMAGE_EMBEDDING_MODEL</span><span class="o">=</span>nomic-ai/nomic-embed-vision-v1.5
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="nv">IMAGE_EMBEDDING_PROVIDER</span><span class="o">=</span>transformers<span class="w">  </span><span class="c1"># Direct model loading via transformers</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="c1"># Text Embeddings (description  vector) - Nomic Text v1.5 (existing)</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="nv">TEXT_EMBEDDING_MODEL</span><span class="o">=</span>nomic-embed-text:latest
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a><span class="nv">TEXT_EMBEDDING_PROVIDER</span><span class="o">=</span>ollama<span class="w">  </span><span class="c1"># or openai</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a><span class="c1"># Garage Storage (ADR-031: Credentials encrypted in database)</span>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a><span class="c1"># Credentials configured via: ./scripts/setup/initialize-platform.sh (option 7)</span>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a><span class="c1"># Only endpoint configuration in .env:</span>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a><span class="nv">GARAGE_S3_ENDPOINT</span><span class="o">=</span>http://localhost:3900
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a><span class="nv">GARAGE_S3_REGION</span><span class="o">=</span>garage
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a><span class="nv">GARAGE_RPC_HOST</span><span class="o">=</span>localhost:3901
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a><span class="nv">GARAGE_BUCKET</span><span class="o">=</span>knowledge-graph-images
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a><span class="c1"># Note: GARAGE_ACCESS_KEY_ID and GARAGE_SECRET_ACCESS_KEY stored encrypted in PostgreSQL</span>
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a><span class="c1"># for consistent security model with OpenAI/Anthropic API keys</span>
</code></pre></div>
<h3 id="configuration-file">Configuration File</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># config/ingestion.yaml</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="nt">visual_context</span><span class="p">:</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">  </span><span class="c1"># Visual similarity search</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">  </span><span class="nt">search_scope</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;global&quot;</span><span class="w">  </span><span class="c1"># global, same_ontology_only, same_ontology_preferred</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">  </span><span class="nt">min_similarity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.60</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">  </span><span class="nt">max_similar_images</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">  </span><span class="c1"># Ontology boosting</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">  </span><span class="nt">ontology_boost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w">  </span><span class="c1"># Add 0.1 to similarity for same-ontology images</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="w">  </span><span class="c1"># Cross-ontology relationships</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">  </span><span class="nt">allow_cross_ontology_relationships</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="w">  </span><span class="c1"># LLM prompt context</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="w">  </span><span class="nt">include_ontology_info</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="w">  </span><span class="nt">include_document_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="w">  </span><span class="nt">include_concept_list</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="w">  </span><span class="nt">max_concepts_per_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="w">  </span><span class="nt">max_description_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>
<a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a><span class="nt">image_storage</span><span class="p">:</span>
<a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="w">  </span><span class="c1"># Compression</span>
<a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;jpeg&quot;</span><span class="w">  </span><span class="c1"># jpeg, png, webp</span>
<a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a><span class="w">  </span><span class="nt">quality</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">85</span><span class="w">  </span><span class="c1"># 0-100 for JPEG/WebP</span>
<a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a>
<a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a><span class="w">  </span><span class="c1"># Organization</span>
<a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a><span class="w">  </span><span class="nt">organize_by_ontology</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># images/{ontology}/{date}/{uuid}.jpg</span>
<a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a><span class="w">  </span><span class="nt">organize_by_date</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a>
<a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a><span class="w">  </span><span class="c1"># Thumbnails</span>
<a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a><span class="w">  </span><span class="nt">generate_thumbnails</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a><span class="w">  </span><span class="nt">thumbnail_max_width</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>
<a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a>
<a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a><span class="nt">embeddings</span><span class="p">:</span>
<a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a><span class="w">  </span><span class="c1"># Image embeddings</span>
<a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a><span class="w">  </span><span class="nt">image_embedding_model</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nomic-embed-vision:latest&quot;</span>
<a id="__codelineno-27-38" name="__codelineno-27-38" href="#__codelineno-27-38"></a><span class="w">  </span><span class="nt">image_embedding_dimensions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">768</span>
<a id="__codelineno-27-39" name="__codelineno-27-39" href="#__codelineno-27-39"></a>
<a id="__codelineno-27-40" name="__codelineno-27-40" href="#__codelineno-27-40"></a><span class="w">  </span><span class="c1"># Text embeddings (for prose descriptions)</span>
<a id="__codelineno-27-41" name="__codelineno-27-41" href="#__codelineno-27-41"></a><span class="w">  </span><span class="nt">text_embedding_model</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nomic-embed-text:latest&quot;</span>
<a id="__codelineno-27-42" name="__codelineno-27-42" href="#__codelineno-27-42"></a><span class="w">  </span><span class="nt">text_embedding_dimensions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">768</span>
<a id="__codelineno-27-43" name="__codelineno-27-43" href="#__codelineno-27-43"></a>
<a id="__codelineno-27-44" name="__codelineno-27-44" href="#__codelineno-27-44"></a><span class="w">  </span><span class="c1"># Vector search</span>
<a id="__codelineno-27-45" name="__codelineno-27-45" href="#__codelineno-27-45"></a><span class="w">  </span><span class="nt">similarity_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.60</span>
<a id="__codelineno-27-46" name="__codelineno-27-46" href="#__codelineno-27-46"></a><span class="w">  </span><span class="nt">max_candidates</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
</code></pre></div>
<hr />
<h2 id="database-schema-updates">Database Schema Updates</h2>
<h3 id="new-table-image_assets">New Table: image_assets</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">image_assets</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="n">asset_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="n">object_key</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="n">image_embedding</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="mi">768</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="n">ontology</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">    </span><span class="n">mime_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">    </span><span class="n">width</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">    </span><span class="n">height</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">    </span><span class="n">file_size</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">    </span><span class="n">vision_model</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">    </span><span class="n">embedding_model</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="p">);</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="c1">-- Vector index for fast similarity search</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_image_assets_embedding</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="k">ON</span><span class="w"> </span><span class="n">image_assets</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="k">USING</span><span class="w"> </span><span class="n">ivfflat</span><span class="w"> </span><span class="p">(</span><span class="n">image_embedding</span><span class="w"> </span><span class="n">vector_cosine_ops</span><span class="p">)</span>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">lists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a><span class="c1">-- Ontology filter index</span>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_image_assets_ontology</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">image_assets</span><span class="p">(</span><span class="n">ontology</span><span class="p">);</span>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="c1">-- S3 object key lookup</span>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_image_assets_object_key</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">image_assets</span><span class="p">(</span><span class="n">object_key</span><span class="p">);</span>
</code></pre></div>
<h3 id="updated-table-sources">Updated Table: sources</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1">-- Add text_embedding for prose descriptions</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">sources</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">text_embedding</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="mi">768</span><span class="p">);</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_sources_text_embedding</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="k">ON</span><span class="w"> </span><span class="n">sources</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="k">USING</span><span class="w"> </span><span class="n">ivfflat</span><span class="w"> </span><span class="p">(</span><span class="n">text_embedding</span><span class="w"> </span><span class="n">vector_cosine_ops</span><span class="p">)</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">lists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
</code></pre></div>
<h3 id="relationship-table-source_images">Relationship Table: source_images</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">source_images</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="n">source_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">sources</span><span class="p">(</span><span class="n">source_id</span><span class="p">),</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">    </span><span class="n">asset_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">image_assets</span><span class="p">(</span><span class="n">asset_id</span><span class="p">),</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span><span class="w"> </span><span class="n">asset_id</span><span class="p">)</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="p">);</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_source_images_asset</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">source_images</span><span class="p">(</span><span class="n">asset_id</span><span class="p">);</span>
</code></pre></div>
<hr />
<h2 id="deployment">Deployment</h2>
<h3 id="docker-compose-updates">Docker Compose Updates</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># docker-compose.yml</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">  </span><span class="c1"># ... existing services (postgres, ollama, api) ...</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">  </span><span class="nt">garage</span><span class="p">:</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dxflrs/garage:v2.1.0</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">knowledge-graph-garage</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3900:3900&quot;</span><span class="w">  </span><span class="c1"># S3 API</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3903:3903&quot;</span><span class="w">  </span><span class="c1"># Admin API</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">      </span><span class="nt">GARAGE_RPC_SECRET</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${GARAGE_RPC_SECRET}</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garage-data:/data</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garage-meta:/meta</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/garage.toml:/etc/garage.toml:ro</span>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server</span>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kg-network</span>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
<a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;garage&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;status&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
<a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>
<a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a><span class="w">  </span><span class="nt">garage-data</span><span class="p">:</span>
<a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a><span class="w">  </span><span class="nt">garage-meta</span><span class="p">:</span>
<a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</code></pre></div>
<h3 id="management-scripts-postgresql-pattern">Management Scripts (PostgreSQL Pattern)</h3>
<h4 id="scriptsgaragestart-garagesh">scripts/garage/start-garage.sh</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="c1"># Start Garage object storage</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="nb">set</span><span class="w"> </span>-e
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="nv">SCRIPT_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="nv">PROJECT_ROOT</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SCRIPT_DIR</span><span class="s2">/../..&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="c1"># Colors</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span><span class="w"> </span><span class="c1"># No Color</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Starting Garage object storage...</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="c1"># Check if Garage is already running</span>
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a><span class="k">if</span><span class="w"> </span>docker<span class="w"> </span>ps<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span>knowledge-graph-garage<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Garage is already running</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Garage S3 API: http://localhost:3900&quot;</span>
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Garage Admin API: http://localhost:3903&quot;</span>
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a><span class="k">fi</span>
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a>
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a><span class="c1"># Start Garage</span>
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PROJECT_ROOT</span><span class="s2">&quot;</span>
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>garage
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a>
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a><span class="c1"># Wait for Garage to be healthy</span>
<a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Waiting for Garage to be ready...&quot;</span>
<a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a><span class="nv">RETRIES</span><span class="o">=</span><span class="m">30</span>
<a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a><span class="k">until</span><span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>knowledge-graph-garage<span class="w"> </span>garage<span class="w"> </span>status<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a><span class="w">    </span><span class="nv">RETRIES</span><span class="o">=</span><span class="k">$((</span><span class="nv">RETRIES</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
<a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$RETRIES</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Garage failed to start</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-32-36" name="__codelineno-32-36" href="#__codelineno-32-36"></a><span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-32-37" name="__codelineno-32-37" href="#__codelineno-32-37"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-32-38" name="__codelineno-32-38" href="#__codelineno-32-38"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">2</span>
<a id="__codelineno-32-39" name="__codelineno-32-39" href="#__codelineno-32-39"></a><span class="k">done</span>
<a id="__codelineno-32-40" name="__codelineno-32-40" href="#__codelineno-32-40"></a>
<a id="__codelineno-32-41" name="__codelineno-32-41" href="#__codelineno-32-41"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Garage started successfully</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-32-42" name="__codelineno-32-42" href="#__codelineno-32-42"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Garage S3 API: http://localhost:3900&quot;</span>
<a id="__codelineno-32-43" name="__codelineno-32-43" href="#__codelineno-32-43"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Garage Admin API: http://localhost:3903&quot;</span>
<a id="__codelineno-32-44" name="__codelineno-32-44" href="#__codelineno-32-44"></a>
<a id="__codelineno-32-45" name="__codelineno-32-45" href="#__codelineno-32-45"></a><span class="c1"># Run initialization</span>
<a id="__codelineno-32-46" name="__codelineno-32-46" href="#__codelineno-32-46"></a><span class="s2">&quot;</span><span class="nv">$SCRIPT_DIR</span><span class="s2">/init-garage.sh&quot;</span>
</code></pre></div>
<h4 id="scriptsgaragestop-garagesh">scripts/garage/stop-garage.sh</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="c1"># Stop Garage object storage</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="nb">set</span><span class="w"> </span>-e
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="c1"># Colors</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Stopping Garage object storage...</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="c1"># Check if Garage is running</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>docker<span class="w"> </span>ps<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span>knowledge-graph-garage<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Garage is not running&quot;</span>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="k">fi</span>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="c1"># Stop Garage (keep data)</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>docker-compose<span class="w"> </span>stop<span class="w"> </span>garage
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>
<a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Garage stopped successfully</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Note: Data persists in docker volumes &#39;garage-data&#39; and &#39;garage-meta&#39;&quot;</span>
<a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;To remove data: docker volume rm knowledge-graph-system_garage-data knowledge-graph-system_garage-meta&quot;</span>
</code></pre></div>
<h4 id="scriptsgarageinit-garagesh">scripts/garage/init-garage.sh</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="c1"># Initialize Garage buckets and keys</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="nb">set</span><span class="w"> </span>-e
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="nv">SCRIPT_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="c1"># Colors</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Initializing Garage...</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="c1"># Check if Garage is running</span>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>docker<span class="w"> </span>ps<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span>knowledge-graph-garage<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Garage is not running. Start it first with: ./scripts/garage/start-garage.sh</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="k">fi</span>
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="c1"># Initialize Garage cluster and create bucket</span>
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>knowledge-graph-garage<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="s2">    # Create bucket</span>
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="s2">    garage bucket create knowledge-graph-images 2&gt;/dev/null || echo &#39;Bucket may already exist&#39;</span>
<a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>
<a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="s2">    # Create access key for API server</span>
<a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="s2">    garage key create kg-api-key 2&gt;/dev/null || echo &#39;Key may already exist&#39;</span>
<a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a>
<a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="s2">    # Allow access key to use bucket</span>
<a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="s2">    garage bucket allow knowledge-graph-images --read --write --key kg-api-key</span>
<a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a>
<a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="s2">    echo &#39;Garage initialization complete&#39;</span>
<a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a><span class="s2">&quot;</span>
<a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a>
<a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Garage initialized successfully</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Bucket: knowledge-graph-images&quot;</span>
<a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;S3 API: http://localhost:3900&quot;</span>
<a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Admin API: http://localhost:3903&quot;</span>
<a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Retrieve access credentials with:&quot;</span>
<a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  docker exec knowledge-graph-garage garage key info kg-api-key&quot;</span>
</code></pre></div>
<h4 id="scriptsservicesstart-storagesh-combined">scripts/services/start-storage.sh (Combined)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="c1"># Start all storage services (PostgreSQL + Garage)</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="nb">set</span><span class="w"> </span>-e
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="nv">SCRIPT_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="c1"># Colors</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Starting all storage services...</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="c1"># Start PostgreSQL</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Starting PostgreSQL ===&quot;</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="s2">&quot;</span><span class="nv">$SCRIPT_DIR</span><span class="s2">/start-database.sh&quot;</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="c1"># Start Garage</span>
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Starting Garage ===&quot;</span>
<a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a><span class="s2">&quot;</span><span class="nv">$SCRIPT_DIR</span><span class="s2">/../garage/start-garage.sh&quot;</span>
<a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a>
<a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">All storage services started successfully</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;PostgreSQL: localhost:5432&quot;</span>
<a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Garage S3 API: http://localhost:3900&quot;</span>
<a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Garage Admin API: http://localhost:3903&quot;</span>
</code></pre></div>
<h4 id="scriptsservicesstop-storagesh-combined">scripts/services/stop-storage.sh (Combined)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="c1"># Stop all storage services (PostgreSQL + Garage)</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="nb">set</span><span class="w"> </span>-e
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="nv">SCRIPT_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="c1"># Colors</span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Stopping all storage services...</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="c1"># Stop Garage</span>
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="s2">&quot;</span><span class="nv">$SCRIPT_DIR</span><span class="s2">/../garage/stop-garage.sh&quot;</span>
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>
<a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="c1"># Stop PostgreSQL</span>
<a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a><span class="s2">&quot;</span><span class="nv">$SCRIPT_DIR</span><span class="s2">/stop-database.sh&quot;</span>
<a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a>
<a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">All storage services stopped</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
<h3 id="development-mode-quick-start">Development Mode Quick Start</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># Complete fresh setup (first time)</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>./scripts/services/start-storage.sh<span class="w">      </span><span class="c1"># Start PostgreSQL + Garage</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>./scripts/setup/initialize-platform.sh<span class="w">   </span><span class="c1"># Set up authentication</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>./scripts/services/start-api.sh<span class="w"> </span>-y<span class="w">       </span><span class="c1"># Start API server</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="c1"># Pull text embedding model (vision embeddings use transformers, not Ollama)</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>kg-ollama<span class="w"> </span>ollama<span class="w"> </span>pull<span class="w"> </span>nomic-embed-text:latest
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="c1"># Optional: Pull local vision model (not recommended - see research findings)</span>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="c1"># docker exec kg-ollama ollama pull granite-vision-3.3:2b</span>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="c1"># Verify everything is running</span>
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>kg<span class="w"> </span>health<span class="w">                       </span><span class="c1"># Check API</span>
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>kg<span class="w"> </span>database<span class="w"> </span>stats<span class="w">               </span><span class="c1"># Check database</span>
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a>curl<span class="w"> </span>http://localhost:3903/health<span class="w">  </span><span class="c1"># Check Garage admin API</span>
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a>
<a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="c1"># Ingest first image</span>
<a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a>kg<span class="w"> </span>ingest<span class="w"> </span>image<span class="w"> </span>my-diagram.jpg<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;Test Ontology&quot;</span>
</code></pre></div>
<h3 id="daily-development-workflow">Daily Development Workflow</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># Start everything</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>./scripts/services/start-storage.sh<span class="w">      </span><span class="c1"># PostgreSQL + Garage</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>./scripts/services/start-api.sh<span class="w"> </span>-y<span class="w">       </span><span class="c1"># API server</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="c1"># Work...</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>kg<span class="w"> </span>ingest<span class="w"> </span>image<span class="w"> </span>diagram.jpg<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;My Project&quot;</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>kg<span class="w"> </span>search<span class="w"> </span>images<span class="w"> </span>--by-text<span class="w"> </span><span class="s2">&quot;architecture diagram&quot;</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="c1"># Stop everything</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>./scripts/services/stop-api.sh
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>./scripts/services/stop-storage.sh<span class="w">       </span><span class="c1"># PostgreSQL + Garage (data persists)</span>
</code></pre></div>
<h3 id="ollama-model-management-optional">Ollama Model Management (Optional)</h3>
<p><strong>Note</strong>: Primary setup uses GPT-4o (cloud) + Nomic Vision (transformers). Ollama only needed for text embeddings.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># scripts/setup-embedding-models.sh</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="c1">#!/bin/bash</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="c1"># Pull required embedding models</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="nb">set</span><span class="w"> </span>-e
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="c1"># Colors</span>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a>
<a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Setting up embedding models...</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a>
<a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="c1"># Check if Ollama is running</span>
<a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>docker<span class="w"> </span>ps<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span>kg-ollama<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Ollama is not running. Starting...&quot;</span>
<a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="w">    </span>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>ollama
<a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="w">    </span>sleep<span class="w"> </span><span class="m">5</span>
<a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="k">fi</span>
<a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a>
<a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a><span class="c1"># Pull text embedding model (required)</span>
<a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Pulling Nomic Embed Text...&quot;</span>
<a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>kg-ollama<span class="w"> </span>ollama<span class="w"> </span>pull<span class="w"> </span>nomic-embed-text:latest
<a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a>
<a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a><span class="c1"># Note about image embeddings</span>
<a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Note: Image embeddings use Nomic Vision v1.5 via transformers library</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;No Ollama model needed for visual embeddings&quot;</span>
<a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-39-30" name="__codelineno-39-30" href="#__codelineno-39-30"></a>
<a id="__codelineno-39-31" name="__codelineno-39-31" href="#__codelineno-39-31"></a><span class="c1"># Optional: Pull local vision model (not recommended)</span>
<a id="__codelineno-39-32" name="__codelineno-39-32" href="#__codelineno-39-32"></a><span class="nb">read</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;Pull Granite Vision for local fallback? (not recommended, see research) [y/N]: &quot;</span><span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>-r
<a id="__codelineno-39-33" name="__codelineno-39-33" href="#__codelineno-39-33"></a><span class="nb">echo</span>
<a id="__codelineno-39-34" name="__codelineno-39-34" href="#__codelineno-39-34"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span>Yy<span class="o">]</span>$<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-39-35" name="__codelineno-39-35" href="#__codelineno-39-35"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Pulling Granite Vision 3.3 2B...&quot;</span>
<a id="__codelineno-39-36" name="__codelineno-39-36" href="#__codelineno-39-36"></a><span class="w">    </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>kg-ollama<span class="w"> </span>ollama<span class="w"> </span>pull<span class="w"> </span>granite-vision-3.3:2b
<a id="__codelineno-39-37" name="__codelineno-39-37" href="#__codelineno-39-37"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Warning: Research shows Granite Vision has inconsistent quality</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-39-38" name="__codelineno-39-38" href="#__codelineno-39-38"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Use only when cloud APIs unavailable&quot;</span>
<a id="__codelineno-39-39" name="__codelineno-39-39" href="#__codelineno-39-39"></a><span class="k">fi</span>
<a id="__codelineno-39-40" name="__codelineno-39-40" href="#__codelineno-39-40"></a>
<a id="__codelineno-39-41" name="__codelineno-39-41" href="#__codelineno-39-41"></a><span class="c1"># Verify</span>
<a id="__codelineno-39-42" name="__codelineno-39-42" href="#__codelineno-39-42"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-39-43" name="__codelineno-39-43" href="#__codelineno-39-43"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Models installed:</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-39-44" name="__codelineno-39-44" href="#__codelineno-39-44"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>kg-ollama<span class="w"> </span>ollama<span class="w"> </span>list
<a id="__codelineno-39-45" name="__codelineno-39-45" href="#__codelineno-39-45"></a>
<a id="__codelineno-39-46" name="__codelineno-39-46" href="#__codelineno-39-46"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-39-47" name="__codelineno-39-47" href="#__codelineno-39-47"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Text embedding model ready: nomic-embed-text&quot;</span>
<a id="__codelineno-39-48" name="__codelineno-39-48" href="#__codelineno-39-48"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Image embeddings: nomic-ai/nomic-embed-vision-v1.5 (transformers, auto-downloaded)&quot;</span>
<a id="__codelineno-39-49" name="__codelineno-39-49" href="#__codelineno-39-49"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Vision backend: GPT-4o (cloud API, set OPENAI_API_KEY in .env)&quot;</span>
</code></pre></div>
<hr />
<h2 id="benefits">Benefits</h2>
<h3 id="1-unified-architecture">1. <strong>Unified Architecture</strong></h3>
<ul>
<li>Single upsert system for text and images</li>
<li>No code duplication</li>
<li>Consistent behavior across modalities</li>
<li>Easy to maintain and extend</li>
</ul>
<h3 id="2-intelligent-relationship-discovery">2. <strong>Intelligent Relationship Discovery</strong></h3>
<ul>
<li>LLM chooses appropriate relationship types</li>
<li>Considers semantic meaning + visual context</li>
<li>Not limited to rigid rules</li>
<li>Discovers cross-domain connections</li>
</ul>
<h3 id="3-ground-truth-preservation">3. <strong>Ground Truth Preservation</strong></h3>
<ul>
<li>Original images stored forever in Garage</li>
<li>Text descriptions are derived evidence</li>
<li>Users can always verify source material</li>
<li>Addresses "telephone game" fidelity loss</li>
</ul>
<h3 id="4-multimodal-search">4. <strong>Multimodal Search</strong></h3>
<ul>
<li>Text  concepts (existing)</li>
<li>Image  images (visual similarity)</li>
<li>Text  images (cross-modal)</li>
<li>Image  concepts (visual to semantic)</li>
</ul>
<h3 id="5-ontology-aware">5. <strong>Ontology-Aware</strong></h3>
<ul>
<li>Respects knowledge domain boundaries</li>
<li>Boosts same-ontology results</li>
<li>Enables cross-domain discovery</li>
<li>Consistent with text ingestion</li>
</ul>
<h3 id="6-quality-first-with-local-fallback">6. <strong>Quality-First with Local Fallback</strong></h3>
<ul>
<li>GPT-4o Vision (primary): Excellent quality, ~$0.01/image</li>
<li>Nomic Vision embeddings: Local via transformers, 0.847 clustering quality</li>
<li>Ollama vision (optional): Available but not recommended per research</li>
<li>Smart trade-off: Pay for reliability, use local embeddings</li>
</ul>
<h3 id="7-licensing-clean">7. <strong>Licensing Clean</strong></h3>
<ul>
<li>Apache 2.0: Nomic Vision embeddings, Nomic Text embeddings</li>
<li>Garage: Network-isolated (no code integration), cooperative governance</li>
<li>No AGPL contamination</li>
<li>Safe for commercial use</li>
<li>No Enterprise edition trap (learned from Neo4j, MinIO)</li>
</ul>
<h3 id="8-scalable-storage">8. <strong>Scalable Storage</strong></h3>
<ul>
<li>Graph: Lightweight (5KB per image node)</li>
<li>Garage: Heavy blobs (200KB per compressed image)</li>
<li>Can migrate to S3/Azure Blob later if needed (standard S3 API)</li>
<li>Proper separation of concerns</li>
</ul>
<hr />
<h2 id="trade-offs-and-limitations">Trade-offs and Limitations</h2>
<h3 id="trade-offs">Trade-offs</h3>
<p><strong>Pro</strong>: Single unified upsert system
<strong>Con</strong>: Visual context adds complexity to text extraction prompt</p>
<p><strong>Pro</strong>: GPT-4o Vision reliable and fast (~5s per image)
<strong>Con</strong>: API cost (~$0.01/image, ~$10 per 1000 images) vs free local (but unreliable)</p>
<p><strong>Pro</strong>: Ground truth preservation
<strong>Con</strong>: Storage costs (200KB per image vs. text-only)</p>
<p><strong>Pro</strong>: Multimodal search
<strong>Con</strong>: Additional vector index maintenance</p>
<p><strong>Pro</strong>: LLM-driven relationship discovery
<strong>Con</strong>: Less predictable than rigid rules</p>
<h3 id="current-limitations">Current Limitations</h3>
<ol>
<li><strong>PDF Conversion External</strong>: Users must convert PDFimages outside our system (pdftoppm, etc.)</li>
<li><strong>No OCR Fallback</strong>: Pure vision model approach; no text-layer extraction from PDFs</li>
<li><strong>Single Image Per Source</strong>: One Source per image (not multi-page grouping)</li>
<li><strong>No Video Support</strong>: Images only (could extend to video frames later)</li>
<li><strong>Garage Single-Node</strong>: No replication/HA in initial implementation (Garage supports multi-node for future)</li>
<li><strong>English-Centric</strong>: Vision models optimized for English text in images</li>
</ol>
<h3 id="known-issues">Known Issues</h3>
<ol>
<li><strong>Vision Model Hallucination</strong>: LLMs may hallucinate details not in image</li>
<li>
<p><em>Mitigation</em>: Keep original image for verification</p>
</li>
<li>
<p><strong>Embedding Similarity Noise</strong>: High visual similarity doesn't always mean semantic relevance</p>
</li>
<li>
<p><em>Mitigation</em>: LLM reasons about visual context, can ignore irrelevant similarities</p>
</li>
<li>
<p><strong>Cross-Ontology Pollution</strong>: Too many weak cross-ontology relationships</p>
</li>
<li>
<p><em>Mitigation</em>: Ontology boosting (0.1), LLM considers domain relevance</p>
</li>
<li>
<p><strong>Storage Growth</strong>: Images consume more space than text</p>
</li>
<li><em>Mitigation</em>: JPEG compression (85%), can migrate to cheaper object storage</li>
</ol>
<hr />
<h2 id="future-enhancements">Future Enhancements</h2>
<h3 id="near-term">Near-Term</h3>
<ul>
<li>[ ] Thumbnail generation for faster UI loading</li>
<li>[ ] Batch image ingestion (multiple images per API call)</li>
<li>[ ] Image compression options (JPEG quality slider)</li>
<li>[ ] GPT-4V and Claude 4.5 Sonnet backend support</li>
<li>[ ] Garage multi-node replication for HA</li>
</ul>
<h3 id="medium-term">Medium-Term</h3>
<ul>
<li>[ ] Multi-page document grouping (one Source, multiple ImageAssets)</li>
<li>[ ] OCR fallback for text-heavy images</li>
<li>[ ] Image annotation in UI (draw bounding boxes, add notes)</li>
<li>[ ] Visual concept clustering (k-means on image embeddings)</li>
</ul>
<h3 id="long-term">Long-Term</h3>
<ul>
<li>[ ] Video frame extraction and analysis</li>
<li>[ ] Temporal relationships between video frames (PRECEDES, FOLLOWS)</li>
<li>[ ] Interactive image exploration (zoom to region, extract sub-concepts)</li>
<li>[ ] Collaborative annotation (multiple users tag same image)</li>
<li>[ ] Advanced visual analytics (heatmaps, attention visualization)</li>
</ul>
<hr />
<h2 id="security-considerations">Security Considerations</h2>
<h3 id="garage-credential-management-postgresql-pattern">Garage Credential Management (PostgreSQL Pattern)</h3>
<p>Like PostgreSQL, Garage credentials are <strong>never hardcoded</strong> in docker-compose.yml:</p>
<h4 id="development-env-file">Development (.env file)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># .env (gitignored)</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="c1"># PostgreSQL credentials</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="nv">POSTGRES_USER</span><span class="o">=</span>kg_user
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>securepassword123
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="c1"># Garage credentials (mirroring PostgreSQL pattern)</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="nv">GARAGE_RPC_SECRET</span><span class="o">=</span><span class="si">${</span><span class="nv">GARAGE_RPC_SECRET</span><span class="k">:-</span><span class="nv">generate_this_on_first_run</span><span class="si">}</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="nv">GARAGE_ACCESS_KEY_ID</span><span class="o">=</span><span class="si">${</span><span class="nv">GARAGE_ACCESS_KEY_ID</span><span class="si">}</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="nv">GARAGE_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="si">${</span><span class="nv">GARAGE_SECRET_ACCESS_KEY</span><span class="si">}</span>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="c1"># API server needs both</span>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="nv">DATABASE_URL</span><span class="o">=</span>postgresql://kg_user:securepassword123@localhost:5432/knowledge_graph
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="nv">GARAGE_S3_ENDPOINT</span><span class="o">=</span>http://garage:3900
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="nv">GARAGE_REGION</span><span class="o">=</span>garage
</code></pre></div>
<h4 id="docker-compose-no-hardcoded-credentials">Docker Compose (No Hardcoded Credentials)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1"># docker-compose.yml</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">  </span><span class="nt">postgres</span><span class="p">:</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${POSTGRES_USER}</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${POSTGRES_PASSWORD}</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="w">    </span><span class="c1"># No hardcoded passwords!</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">  </span><span class="nt">garage</span><span class="p">:</span>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">      </span><span class="nt">GARAGE_RPC_SECRET</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${GARAGE_RPC_SECRET}</span>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">    </span><span class="c1"># No hardcoded passwords!</span>
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a>
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="w">      </span><span class="c1"># API server trusts both storage backends</span>
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w">      </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DATABASE_URL}</span>
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="w">      </span><span class="nt">GARAGE_S3_ENDPOINT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${GARAGE_S3_ENDPOINT}</span>
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="w">      </span><span class="nt">GARAGE_ACCESS_KEY_ID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${GARAGE_ACCESS_KEY_ID}</span>
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="w">      </span><span class="nt">GARAGE_SECRET_ACCESS_KEY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${GARAGE_SECRET_ACCESS_KEY}</span>
</code></pre></div>
<h4 id="initialize-credentials-first-run">Initialize Credentials (First Run)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># scripts/setup/initialize-storage-credentials.sh</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="c1">#!/bin/bash</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="c1"># Generate secure credentials for PostgreSQL and Garage</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="nb">set</span><span class="w"> </span>-e
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="nv">ENV_FILE</span><span class="o">=</span><span class="s2">&quot;.env&quot;</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="c1"># Colors</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Initializing storage credentials...</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="c1"># Check if .env exists</span>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ENV_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Creating .env from .env.example...&quot;</span>
<a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a><span class="w">    </span>cp<span class="w"> </span>.env.example<span class="w"> </span>.env
<a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a><span class="k">fi</span>
<a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a>
<a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a><span class="c1"># Generate Garage RPC secret if not set</span>
<a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;GARAGE_RPC_SECRET=&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ENV_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;GARAGE_RPC_SECRET=\${&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ENV_FILE</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a><span class="w">    </span><span class="nv">GARAGE_RPC_SECRET</span><span class="o">=</span><span class="k">$(</span>openssl<span class="w"> </span>rand<span class="w"> </span>-hex<span class="w"> </span><span class="m">32</span><span class="k">)</span>
<a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Generated Garage RPC secret:</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;GARAGE_RPC_SECRET=</span><span class="nv">$GARAGE_RPC_SECRET</span><span class="s2">&quot;</span>
<a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a>
<a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a><span class="w">    </span><span class="c1"># Update .env</span>
<a id="__codelineno-42-31" name="__codelineno-42-31" href="#__codelineno-42-31"></a><span class="w">    </span>sed<span class="w"> </span>-i.bak<span class="w"> </span><span class="s2">&quot;s|GARAGE_RPC_SECRET=.*|GARAGE_RPC_SECRET=</span><span class="nv">$GARAGE_RPC_SECRET</span><span class="s2">|&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ENV_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-42-32" name="__codelineno-42-32" href="#__codelineno-42-32"></a><span class="w">    </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ENV_FILE</span><span class="s2">.bak&quot;</span>
<a id="__codelineno-42-33" name="__codelineno-42-33" href="#__codelineno-42-33"></a><span class="k">fi</span>
<a id="__codelineno-42-34" name="__codelineno-42-34" href="#__codelineno-42-34"></a>
<a id="__codelineno-42-35" name="__codelineno-42-35" href="#__codelineno-42-35"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Storage credentials configured</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-42-36" name="__codelineno-42-36" href="#__codelineno-42-36"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Credentials are stored in .env (gitignored)&quot;</span>
<a id="__codelineno-42-37" name="__codelineno-42-37" href="#__codelineno-42-37"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-42-38" name="__codelineno-42-38" href="#__codelineno-42-38"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Note: Garage S3 access keys are generated by Garage during init&quot;</span>
<a id="__codelineno-42-39" name="__codelineno-42-39" href="#__codelineno-42-39"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Run ./scripts/garage/init-garage.sh to create bucket and keys&quot;</span>
</code></pre></div>
<h3 id="garage-api-server-trust">Garage API Server Trust</h3>
<p>API server authenticates to Garage using credentials from environment:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1"># src/api/lib/garage_client.py</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">botocore.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientError</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">GarageClient</span><span class="p">:</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Garage client for image storage with secure credential handling.&quot;&quot;&quot;</span>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a>        <span class="c1"># Load from environment (like PostgreSQL connection)</span>
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GARAGE_S3_ENDPOINT&quot;</span><span class="p">,</span> <span class="s2">&quot;http://garage:3900&quot;</span><span class="p">)</span>
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">access_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GARAGE_ACCESS_KEY_ID&quot;</span><span class="p">)</span>
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GARAGE_SECRET_ACCESS_KEY&quot;</span><span class="p">)</span>
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GARAGE_REGION&quot;</span><span class="p">,</span> <span class="s2">&quot;garage&quot;</span><span class="p">)</span>
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GARAGE_BUCKET&quot;</span><span class="p">,</span> <span class="s2">&quot;knowledge-graph-images&quot;</span><span class="p">)</span>
<a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a>
<a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="p">:</span>
<a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a>                <span class="s2">&quot;Garage credentials not found. Set GARAGE_ACCESS_KEY_ID and GARAGE_SECRET_ACCESS_KEY &quot;</span>
<a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a>                <span class="s2">&quot;in environment (like DATABASE_URL for PostgreSQL)&quot;</span>
<a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a>            <span class="p">)</span>
<a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a>
<a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a>        <span class="c1"># Create S3 client for Garage</span>
<a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
<a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a>            <span class="s1">&#39;s3&#39;</span><span class="p">,</span>
<a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a>            <span class="n">endpoint_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span>
<a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a>            <span class="n">aws_access_key_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">access_key</span><span class="p">,</span>
<a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a>            <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span>
<a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a>            <span class="n">region_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region</span>
<a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a>        <span class="p">)</span>
<a id="__codelineno-43-32" name="__codelineno-43-32" href="#__codelineno-43-32"></a>
<a id="__codelineno-43-33" name="__codelineno-43-33" href="#__codelineno-43-33"></a>        <span class="c1"># Verify connection</span>
<a id="__codelineno-43-34" name="__codelineno-43-34" href="#__codelineno-43-34"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-43-35" name="__codelineno-43-35" href="#__codelineno-43-35"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">head_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">)</span>
<a id="__codelineno-43-36" name="__codelineno-43-36" href="#__codelineno-43-36"></a>        <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-43-37" name="__codelineno-43-37" href="#__codelineno-43-37"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect to Garage: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-43-38" name="__codelineno-43-38" href="#__codelineno-43-38"></a>
<a id="__codelineno-43-39" name="__codelineno-43-39" href="#__codelineno-43-39"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">upload_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;image/jpeg&quot;</span><span class="p">):</span>
<a id="__codelineno-43-40" name="__codelineno-43-40" href="#__codelineno-43-40"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Upload image to Garage (authenticated).&quot;&quot;&quot;</span>
<a id="__codelineno-43-41" name="__codelineno-43-41" href="#__codelineno-43-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span>
<a id="__codelineno-43-42" name="__codelineno-43-42" href="#__codelineno-43-42"></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span>
<a id="__codelineno-43-43" name="__codelineno-43-43" href="#__codelineno-43-43"></a>            <span class="n">Key</span><span class="o">=</span><span class="n">object_name</span><span class="p">,</span>
<a id="__codelineno-43-44" name="__codelineno-43-44" href="#__codelineno-43-44"></a>            <span class="n">Body</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
<a id="__codelineno-43-45" name="__codelineno-43-45" href="#__codelineno-43-45"></a>            <span class="n">ContentType</span><span class="o">=</span><span class="n">content_type</span>
<a id="__codelineno-43-46" name="__codelineno-43-46" href="#__codelineno-43-46"></a>        <span class="p">)</span>
<a id="__codelineno-43-47" name="__codelineno-43-47" href="#__codelineno-43-47"></a>
<a id="__codelineno-43-48" name="__codelineno-43-48" href="#__codelineno-43-48"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<a id="__codelineno-43-49" name="__codelineno-43-49" href="#__codelineno-43-49"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve image from Garage (authenticated).&quot;&quot;&quot;</span>
<a id="__codelineno-43-50" name="__codelineno-43-50" href="#__codelineno-43-50"></a>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">object_name</span><span class="p">)</span>
<a id="__codelineno-43-51" name="__codelineno-43-51" href="#__codelineno-43-51"></a>        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div>
<h3 id="production-considerations">Production Considerations</h3>
<h4 id="docker-secrets-production">Docker Secrets (Production)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1"># docker-compose.prod.yml</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">  </span><span class="nt">garage</span><span class="p">:</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">      </span><span class="nt">GARAGE_RPC_SECRET_FILE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run/secrets/garage_rpc_secret</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">    </span><span class="nt">secrets</span><span class="p">:</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garage_rpc_secret</span>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="nt">secrets</span><span class="p">:</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="w">  </span><span class="nt">garage_rpc_secret</span><span class="p">:</span>
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<h4 id="garage-bucket-policies-advanced">Garage Bucket Policies (Advanced)</h4>
<p>For production, create a dedicated "application key" with scoped access:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1"># Create application key with limited permissions</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>knowledge-graph-garage<span class="w"> </span>garage<span class="w"> </span>key<span class="w"> </span>create<span class="w"> </span>kg-api-key
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="c1"># Create bucket with specific permissions</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>knowledge-graph-garage<span class="w"> </span>garage<span class="w"> </span>bucket<span class="w"> </span>create<span class="w"> </span>knowledge-graph-images
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="c1"># Grant read/write access to API key</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>knowledge-graph-garage<span class="w"> </span>garage<span class="w"> </span>bucket<span class="w"> </span>allow<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w">  </span>knowledge-graph-images<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="w">  </span>--read<span class="w"> </span>--write<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w">  </span>--key<span class="w"> </span>kg-api-key
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a>
<a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="c1"># Deny public access</span>
<a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>knowledge-graph-garage<span class="w"> </span>garage<span class="w"> </span>bucket<span class="w"> </span>deny<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="w">  </span>knowledge-graph-images<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="w">  </span>--read<span class="w"> </span>--write<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="w">  </span>--key<span class="w"> </span><span class="s1">&#39;*&#39;</span>
<a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a>
<a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="c1"># View key credentials</span>
<a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>knowledge-graph-garage<span class="w"> </span>garage<span class="w"> </span>key<span class="w"> </span>info<span class="w"> </span>kg-api-key
</code></pre></div>
<h3 id="security-trust-model">Security Trust Model</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>Development:
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a> .env creds  
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a> API       PostgreSQL 
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a> Server                
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>           .env creds  
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>           Garage     
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>             
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>Production:
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a> secrets     
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a> API       PostgreSQL 
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a> Server                
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>           key policy  
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a>           Garage     
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a>             
</code></pre></div>
<p><strong>Key principles</strong>:
1. <strong>No hardcoded credentials</strong> (like PostgreSQL pattern)
2. <strong>Environment-based config</strong> (dev: .env, prod: secrets)
3. <strong>Least privilege</strong> (prod: scoped bucket permissions per key)
4. <strong>API mediates all access</strong> (users never directly access storage)</p>
<h3 id="input-validation">Input Validation</h3>
<ul>
<li>File type validation (JPEG, PNG only)</li>
<li>File size limits (max 10MB per image)</li>
<li>Image dimension limits (max 80008000 pixels)</li>
<li>Malware scanning for uploaded files</li>
</ul>
<h3 id="garage-access-control">Garage Access Control</h3>
<ul>
<li>Private bucket by default</li>
<li>Presigned URLs for time-limited access</li>
<li>API server mediates all image access</li>
<li>No direct public access to Garage</li>
<li>Ontology-based authorization (users only access their ontologies)</li>
</ul>
<h3 id="rate-limiting">Rate Limiting</h3>
<ul>
<li>Max 10 images per minute per user</li>
<li>Max 100 images per hour per user</li>
<li>Prevents abuse of vision model API</li>
</ul>
<h3 id="data-privacy">Data Privacy</h3>
<ul>
<li>Images stored with UUID filenames (not original names)</li>
<li>Ontology-based access control (users see only their ontologies)</li>
<li>Audit log for all image uploads/retrievals</li>
<li>Option to purge images after concept extraction</li>
</ul>
<hr />
<h2 id="testing-strategy">Testing Strategy</h2>
<h3 id="unit-tests">Unit Tests</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_image_embedding_generation</span><span class="p">():</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test Nomic vision embedding generation&quot;&quot;&quot;</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">load_test_image</span><span class="p">(</span><span class="s2">&quot;flowchart.jpg&quot;</span><span class="p">)</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>    <span class="n">embedding</span> <span class="o">=</span> <span class="n">nomic_vision</span><span class="o">.</span><span class="n">embed_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">embedding</span><span class="p">)</span> <span class="o">==</span> <span class="mi">768</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">embedding</span><span class="p">)</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_visual_similarity_search</span><span class="p">():</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test image similarity search&quot;&quot;&quot;</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>    <span class="n">query_embedding</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">768</span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">search_similar_images</span><span class="p">(</span><span class="n">query_embedding</span><span class="p">,</span> <span class="n">min_similarity</span><span class="o">=</span><span class="mf">0.60</span><span class="p">)</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a>    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">similarity</span> <span class="o">&gt;=</span> <span class="mf">0.60</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">)</span>
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a>
<a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_ontology_boost</span><span class="p">():</span>
<a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test same-ontology results are boosted&quot;&quot;&quot;</span>
<a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">search_similar_images_with_ontology</span><span class="p">(</span>
<a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a>        <span class="n">embedding</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">768</span><span class="p">,</span>
<a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a>        <span class="n">target_ontology</span><span class="o">=</span><span class="s2">&quot;Watts Lectures&quot;</span><span class="p">,</span>
<a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a>        <span class="n">ontology_boost</span><span class="o">=</span><span class="mf">0.1</span>
<a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a>    <span class="p">)</span>
<a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a>    <span class="n">same_ontology</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">same_ontology</span><span class="p">]</span>
<a id="__codelineno-47-22" name="__codelineno-47-22" href="#__codelineno-47-22"></a>    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">adjusted_similarity</span> <span class="o">&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">similarity</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">same_ontology</span><span class="p">)</span>
</code></pre></div>
<h3 id="integration-tests">Integration Tests</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_full_image_ingestion_pipeline</span><span class="p">():</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test complete image  concepts flow&quot;&quot;&quot;</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>    <span class="c1"># Upload image</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">load_test_image</span><span class="p">(</span><span class="s2">&quot;bar_graph.jpg&quot;</span><span class="p">)</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ingest_image</span><span class="p">(</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>        <span class="n">image_bytes</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>        <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;test_graph.jpg&quot;</span><span class="p">,</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>        <span class="n">ontology</span><span class="o">=</span><span class="s2">&quot;Test Ontology&quot;</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a>    <span class="p">)</span>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a>    <span class="c1"># Verify ImageAsset created</span>
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a>    <span class="n">asset</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_image_asset</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;asset_id&quot;</span><span class="p">])</span>
<a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a>    <span class="k">assert</span> <span class="n">asset</span><span class="o">.</span><span class="n">ontology</span> <span class="o">==</span> <span class="s2">&quot;Test Ontology&quot;</span>
<a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">image_embedding</span><span class="p">)</span> <span class="o">==</span> <span class="mi">768</span>
<a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a>
<a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a>    <span class="c1"># Verify Source created</span>
<a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a>    <span class="n">source</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_source</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;source_id&quot;</span><span class="p">])</span>
<a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a>    <span class="k">assert</span> <span class="n">source</span><span class="o">.</span><span class="n">document</span> <span class="o">==</span> <span class="s2">&quot;test_graph.jpg&quot;</span>
<a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">full_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># Prose description exists</span>
<a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a>
<a id="__codelineno-48-22" name="__codelineno-48-22" href="#__codelineno-48-22"></a>    <span class="c1"># Verify concepts extracted</span>
<a id="__codelineno-48-23" name="__codelineno-48-23" href="#__codelineno-48-23"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;concept_ids&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-48-24" name="__codelineno-48-24" href="#__codelineno-48-24"></a>    <span class="n">concepts</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_concepts</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;concept_ids&quot;</span><span class="p">])</span>
<a id="__codelineno-48-25" name="__codelineno-48-25" href="#__codelineno-48-25"></a>    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ontology</span> <span class="o">==</span> <span class="s2">&quot;Test Ontology&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">concepts</span><span class="p">)</span>
<a id="__codelineno-48-26" name="__codelineno-48-26" href="#__codelineno-48-26"></a>
<a id="__codelineno-48-27" name="__codelineno-48-27" href="#__codelineno-48-27"></a>    <span class="c1"># Verify image retrievable</span>
<a id="__codelineno-48-28" name="__codelineno-48-28" href="#__codelineno-48-28"></a>    <span class="n">image_bytes</span> <span class="o">=</span> <span class="k">await</span> <span class="n">retrieve_image</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">source_id</span><span class="p">)</span>
<a id="__codelineno-48-29" name="__codelineno-48-29" href="#__codelineno-48-29"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_bytes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-48-30" name="__codelineno-48-30" href="#__codelineno-48-30"></a>
<a id="__codelineno-48-31" name="__codelineno-48-31" href="#__codelineno-48-31"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
<a id="__codelineno-48-32" name="__codelineno-48-32" href="#__codelineno-48-32"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_visual_context_injection</span><span class="p">():</span>
<a id="__codelineno-48-33" name="__codelineno-48-33" href="#__codelineno-48-33"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that similar images provide context&quot;&quot;&quot;</span>
<a id="__codelineno-48-34" name="__codelineno-48-34" href="#__codelineno-48-34"></a>    <span class="c1"># Ingest first image</span>
<a id="__codelineno-48-35" name="__codelineno-48-35" href="#__codelineno-48-35"></a>    <span class="n">image1</span> <span class="o">=</span> <span class="n">load_test_image</span><span class="p">(</span><span class="s2">&quot;flowchart_1.jpg&quot;</span><span class="p">)</span>
<a id="__codelineno-48-36" name="__codelineno-48-36" href="#__codelineno-48-36"></a>    <span class="n">result1</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ingest_image</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="s2">&quot;flowchart_1.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">)</span>
<a id="__codelineno-48-37" name="__codelineno-48-37" href="#__codelineno-48-37"></a>
<a id="__codelineno-48-38" name="__codelineno-48-38" href="#__codelineno-48-38"></a>    <span class="c1"># Ingest similar image</span>
<a id="__codelineno-48-39" name="__codelineno-48-39" href="#__codelineno-48-39"></a>    <span class="n">image2</span> <span class="o">=</span> <span class="n">load_test_image</span><span class="p">(</span><span class="s2">&quot;flowchart_2.jpg&quot;</span><span class="p">)</span>  <span class="c1"># Visually similar</span>
<a id="__codelineno-48-40" name="__codelineno-48-40" href="#__codelineno-48-40"></a>    <span class="n">result2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ingest_image</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span> <span class="s2">&quot;flowchart_2.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">)</span>
<a id="__codelineno-48-41" name="__codelineno-48-41" href="#__codelineno-48-41"></a>
<a id="__codelineno-48-42" name="__codelineno-48-42" href="#__codelineno-48-42"></a>    <span class="c1"># Check that visual context was used</span>
<a id="__codelineno-48-43" name="__codelineno-48-43" href="#__codelineno-48-43"></a>    <span class="k">assert</span> <span class="n">result2</span><span class="p">[</span><span class="s2">&quot;visual_context_used&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-48-44" name="__codelineno-48-44" href="#__codelineno-48-44"></a>
<a id="__codelineno-48-45" name="__codelineno-48-45" href="#__codelineno-48-45"></a>    <span class="c1"># Check that concepts are related</span>
<a id="__codelineno-48-46" name="__codelineno-48-46" href="#__codelineno-48-46"></a>    <span class="n">concepts1</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_concepts</span><span class="p">(</span><span class="n">result1</span><span class="p">[</span><span class="s2">&quot;concept_ids&quot;</span><span class="p">])</span>
<a id="__codelineno-48-47" name="__codelineno-48-47" href="#__codelineno-48-47"></a>    <span class="n">concepts2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_concepts</span><span class="p">(</span><span class="n">result2</span><span class="p">[</span><span class="s2">&quot;concept_ids&quot;</span><span class="p">])</span>
<a id="__codelineno-48-48" name="__codelineno-48-48" href="#__codelineno-48-48"></a>    <span class="n">relationships</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_relationships_between</span><span class="p">(</span><span class="n">concepts1</span><span class="p">,</span> <span class="n">concepts2</span><span class="p">)</span>
<a id="__codelineno-48-49" name="__codelineno-48-49" href="#__codelineno-48-49"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">relationships</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># LLM created relationships based on visual similarity</span>
</code></pre></div>
<h3 id="load-tests">Load Tests</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">load</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_concurrent_image_ingestion</span><span class="p">():</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test system under concurrent load&quot;&quot;&quot;</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>    <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">load_test_image</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)]</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>    <span class="c1"># Ingest 50 images concurrently</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a>    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>        <span class="n">ingest_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;test_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;Load Test&quot;</span><span class="p">)</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>    <span class="p">]</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>    <span class="c1"># Verify all succeeded</span>
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">50</span>
<a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="s2">&quot;source_id&quot;</span> <span class="ow">in</span> <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">)</span>
<a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a>
<a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>    <span class="c1"># Verify Garage has all images</span>
<a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a>    <span class="k">assert</span> <span class="k">await</span> <span class="n">garage_client</span><span class="o">.</span><span class="n">object_count</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">50</span>
</code></pre></div>
<hr />
<h2 id="monitoring-and-observability">Monitoring and Observability</h2>
<h3 id="key-metrics">Key Metrics</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1"># Ingestion metrics</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="n">image_ingestion_duration_seconds</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="s2">&quot;image_ingestion_duration_seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="n">image_ingestion_total</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s2">&quot;image_ingestion_total&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ontology&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">])</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="n">visual_context_matches</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="s2">&quot;visual_context_matches&quot;</span><span class="p">)</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="c1"># Storage metrics</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="n">garage_storage_bytes</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span><span class="s2">&quot;garage_storage_bytes&quot;</span><span class="p">)</span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="n">garage_object_count</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span><span class="s2">&quot;garage_object_count&quot;</span><span class="p">)</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="n">image_embedding_dimension</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span><span class="s2">&quot;image_embedding_dimension&quot;</span><span class="p">)</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="c1"># Search metrics</span>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="n">image_search_duration_seconds</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="s2">&quot;image_search_duration_seconds&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;search_type&quot;</span><span class="p">])</span>
<a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="n">image_search_results</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="s2">&quot;image_search_results&quot;</span><span class="p">)</span>
<a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a>
<a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="c1"># Vision model metrics</span>
<a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="n">vision_model_latency_seconds</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="s2">&quot;vision_model_latency_seconds&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;provider&quot;</span><span class="p">])</span>
<a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="n">vision_model_errors</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s2">&quot;vision_model_errors&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;provider&quot;</span><span class="p">,</span> <span class="s2">&quot;error_type&quot;</span><span class="p">])</span>
</code></pre></div>
<h3 id="logging">Logging</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1"># Structured logging with context</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>    <span class="s2">&quot;Image ingested successfully&quot;</span><span class="p">,</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>        <span class="s2">&quot;source_id&quot;</span><span class="p">:</span> <span class="n">source</span><span class="o">.</span><span class="n">source_id</span><span class="p">,</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>        <span class="s2">&quot;asset_id&quot;</span><span class="p">:</span> <span class="n">asset</span><span class="o">.</span><span class="n">asset_id</span><span class="p">,</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>        <span class="s2">&quot;ontology&quot;</span><span class="p">:</span> <span class="n">ontology</span><span class="p">,</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>        <span class="s2">&quot;file_size&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_bytes</span><span class="p">),</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>        <span class="s2">&quot;vision_model&quot;</span><span class="p">:</span> <span class="s2">&quot;granite-vision-3.3:2b&quot;</span><span class="p">,</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a>        <span class="s2">&quot;visual_context_matches&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">similar_images</span><span class="p">),</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a>        <span class="s2">&quot;concepts_extracted&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">concept_ids</span><span class="p">)</span>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a>    <span class="p">}</span>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="implementation-checklist">Implementation Checklist</h2>
<h3 id="infrastructure">Infrastructure</h3>
<ul>
<li>[ ] Add Garage to docker-compose</li>
<li>[ ] Create initialization script (create bucket, set keys)</li>
<li>[ ] Pull Ollama models (granite-vision-3.3:2b for optional local vision)</li>
</ul>
<h3 id="database-schema">Database Schema</h3>
<ul>
<li>[ ] Create image_assets table with vector index</li>
<li>[ ] Add text_embedding column to sources table</li>
<li>[ ] Create source_images relationship table</li>
<li>[ ] Run database migration</li>
</ul>
<h3 id="vision-backend">Vision Backend</h3>
<ul>
<li>[ ] Implement VisionBackend abstract class</li>
<li>[ ] Implement GraniteVisionBackend (Ollama)</li>
<li>[ ] Implement OpenAIVisionBackend (GPT-4o)</li>
<li>[ ] Implement AnthropicVisionBackend (Claude)</li>
<li>[ ] Add provider factory function</li>
</ul>
<h3 id="core-pipeline">Core Pipeline</h3>
<ul>
<li>[ ] Implement image embedding generation (Nomic Vision)</li>
<li>[ ] Implement visual similarity search with ontology awareness</li>
<li>[ ] Implement visual context builder</li>
<li>[ ] Implement image  prose description</li>
<li>[ ] Integrate visual context injection into existing upsert</li>
<li>[ ] Test hairpin pattern with existing text pipeline</li>
</ul>
<h3 id="storage">Storage</h3>
<ul>
<li>[ ] Implement Garage S3 client wrapper</li>
<li>[ ] Implement image upload/compression</li>
<li>[ ] Implement image retrieval (full + thumbnail)</li>
<li>[ ] Implement presigned URL generation</li>
</ul>
<h3 id="api-routes_1">API Routes</h3>
<ul>
<li>[ ] POST /api/ingest/image (image ingestion)</li>
<li>[ ] GET /api/sources/{id}/image (image retrieval)</li>
<li>[ ] GET /api/sources/{id}/image/presigned (presigned URL)</li>
<li>[ ] POST /api/search/images/by-image (visual similarity)</li>
<li>[ ] POST /api/search/images/by-text (cross-modal)</li>
<li>[ ] POST /api/search/concepts/by-image (visual to semantic)</li>
</ul>
<h3 id="cli-commands">CLI Commands</h3>
<ul>
<li>[ ] kg ingest image (upload image)</li>
<li>[ ] kg search images --by-image (visual similarity)</li>
<li>[ ] kg search images --by-text (cross-modal)</li>
<li>[ ] kg search concepts --by-image (visual to semantic)</li>
</ul>
<h3 id="testing">Testing</h3>
<ul>
<li>[ ] Unit tests for vision backend</li>
<li>[ ] Unit tests for visual similarity search</li>
<li>[ ] Integration test for full pipeline</li>
<li>[ ] Load test for concurrent ingestion</li>
</ul>
<h3 id="documentation">Documentation</h3>
<ul>
<li>[ ] Update QUICKSTART.md with image ingestion</li>
<li>[ ] Add image ingestion guide</li>
<li>[ ] Update API documentation</li>
<li>[ ] Add troubleshooting guide</li>
</ul>
<hr />
<h2 id="success-criteria">Success Criteria</h2>
<p>The implementation will be considered successful when:</p>
<ol>
<li> <strong>Images can be ingested</strong> into the knowledge graph with concepts extracted</li>
<li> <strong>Visual similarity search works</strong> (find similar images by uploading an image)</li>
<li> <strong>Cross-modal search works</strong> (find images by text query)</li>
<li> <strong>Ontology awareness functions</strong> (same-ontology results are boosted)</li>
<li> <strong>Visual context injection works</strong> (similar images provide context for concept extraction)</li>
<li> <strong>Relationships are created</strong> based on visual similarity (IMPLIES, SUPPORTS, RELATES_TO, etc.)</li>
<li> <strong>Ground truth is preserved</strong> (original images retrievable from MinIO)</li>
<li> <strong>Unified pipeline works</strong> (image ingestion uses existing text upsert)</li>
<li> <strong>Performance is acceptable</strong> (&lt;30s per image with local models, &lt;10s with cloud)</li>
<li> <strong>Storage is manageable</strong> (&lt;500KB per image including embeddings and metadata)</li>
</ol>
<hr />
<h2 id="considered-alternatives">Considered Alternatives</h2>
<h3 id="minio-initially-implemented-then-rejected">MinIO (Initially Implemented, Then Rejected)</h3>
<p><strong>Why initially chosen:</strong>
- Mature S3-compatible object storage
- Well-documented API
- Popular in self-hosted environments
- Initially appeared to be open-source friendly</p>
<p><strong>Why rejected:</strong>
- <strong>Enterprise license trap</strong>: In March 2025, MinIO gutted the admin UI from Community Edition
- <strong>Pricing</strong>: Enterprise edition costs $96,000/year for admin features we considered table-stakes
- <strong>Pattern recognition</strong>: Follows exact same bait-and-switch as Neo4j ($180k/year for RBAC)
- <strong>Community vs Enterprise split</strong>: Essential management features moved to proprietary license
- <strong>Governance risk</strong>: For-profit company that demonstrated willingness to gut open-source offering</p>
<p><strong>Migration to Garage:</strong>
- Drop-in S3 API replacement (zero code changes required)
- Standard boto3 library works identically
- All architectural patterns preserved (presigned URLs, bucket policies, etc.)
- Cooperative governance (Deuxfleurs) prevents future license traps</p>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p>This ADR proposes a <strong>multimodal image ingestion system</strong> that extends our text-based knowledge graph to visual documents while maintaining architectural consistency through:</p>
<ul>
<li><strong>Single unified upsert system</strong> (no parallel pipelines)</li>
<li><strong>Visual context injection</strong> (LLM-driven relationship discovery)</li>
<li><strong>Ontology-aware search</strong> (respects knowledge domains)</li>
<li><strong>Ground truth preservation</strong> (original images stored)</li>
<li><strong>Local-first approach</strong> (Granite Vision, Nomic embeddings)</li>
<li><strong>Licensing clean</strong> (Apache 2.0, no AGPL contamination)</li>
</ul>
<p>The "hairpin pattern" allows images to flow through the existing text upsert pipeline with visual context injected, enabling intelligent relationship discovery without code duplication.</p>
<p>This approach balances:
- <strong>Simplicity</strong>: One extraction system, one upsert logic
- <strong>Intelligence</strong>: LLM reasons about visual similarity
- <strong>Performance</strong>: Lightweight embeddings in graph, heavy blobs in MinIO
- <strong>Flexibility</strong>: Supports multiple vision backends (Granite, GPT-4V, Claude)
- <strong>Cost</strong>: Local inference for zero per-image cost</p>
<p>By treating images as first-class citizens with dual embeddings (visual + textual), we enable true multimodal knowledge discovery where concepts can be found through text queries, image similarity, or cross-modal search.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>