
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Multi-dimensional knowledge extraction system using Apache AGE">
      
      
        <meta name="author" content="Knowledge Graph System Contributors">
      
      
      
        <link rel="prev" href="../../ingestion-content/ADR-057b-appendix-single-vs-two-stage/">
      
      
        <link rel="next" href="../../query-search/ADR-030-concept-deduplication-validation/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Parallel Graph Query Execution - Design Proposal - Knowledge Graph System</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#parallel-graph-query-execution-design-proposal" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Knowledge Graph System" class="md-header__button md-logo" aria-label="Knowledge Graph System" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Knowledge Graph System
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Parallel Graph Query Execution - Design Proposal
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/aaronsb/knowledge-graph-system" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    aaronsb/knowledge-graph-system
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Knowledge Graph System" class="md-nav__button md-logo" aria-label="Knowledge Graph System" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Knowledge Graph System
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aaronsb/knowledge-graph-system" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    aaronsb/knowledge-graph-system
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation Index
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/COLD-START.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5-Minute Cold Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/DEPLOYMENT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/VOCABULARY_CATEGORIES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vocabulary Categories
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Manual
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Manual
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Graph System Manual
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Introduction
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/00-introduction/01-WHAT_AND_WHY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What is the Knowledge Graph System?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/01-getting-started/02-CLI_USAGE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg CLI Usage Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/01-getting-started/03-INGESTION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document Ingestion Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/02-configuration/01-AI_PROVIDERS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Provider Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/02-configuration/02-EXTRACTION_CONFIGURATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Extraction Configuration Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/02-configuration/03-EMBEDDING_CONFIGURATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Embedding Configuration Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/02-configuration/04-SWITCHING_EXTRACTION_PROVIDERS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Switching Extraction Providers - Quick Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/02-configuration/05-LOCAL_INFERENCE_IMPLEMENTATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local LLM Inference Implementation Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/02-configuration/06-EXTRACTION_QUALITY_COMPARISON/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Extraction Quality Comparison
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/03-integration/01-MCP_SETUP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Server Setup Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/03-integration/02-VOCABULARY_CONSOLIDATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Edge Vocabulary Consolidation Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security & Access
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security & Access
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/04-security-and-access/01-AUTHENTICATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/04-security-and-access/02-RBAC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RBAC Operations Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/04-security-and-access/03-SECURITY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/04-security-and-access/04-PASSWORD_RECOVERY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Password Recovery and Account Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Maintenance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Maintenance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/05-maintenance/01-BACKUP_RESTORE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup and Restore Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/05-maintenance/02-DATABASE_MIGRATIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Migrations Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/01-SCHEMA_REFERENCE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PostgreSQL Schema Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/02-USE_CASES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Use Cases: Practical Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/03-EXAMPLES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Examples: Real Queries, Real Results
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/04-github_project_history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub Project History Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/05-CONCEPTS_AND_TERMINOLOGY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concepts and Terminology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/06-CONCEPT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concept: Why Knowledge Graphs, Not Just RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/07-ENRICHMENT_JOURNEY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Enrichment Journey: From Empty Graph to Multi-Perspective Understanding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/08-DISTRIBUTED_SHARDING_RESEARCH/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Distributed Graph Database Sharding: Research and Architectural Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/09-CYPHER_PATTERNS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced Cypher Query Patterns for Apache AGE
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/10-OPENCYPHER_QUERIES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    openCypher Query Examples
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/06-reference/11-LLM_EDGE_DISCOVERY_FLOW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Edge Discovery Flow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tool Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tool Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tool &amp; API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CLI Commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    CLI Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Command Reference (Auto-Generated)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/admin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg admin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/health/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg health
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/ingest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg ingest
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/job/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg job
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/login/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg login
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/logout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg logout
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/oauth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg oauth
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/ontology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg ontology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/commands/vocabulary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kg vocabulary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    media
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    media
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/cli/media/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Media Assets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    MCP Tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    MCP Tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Server Tool Reference (Auto-Generated)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_2" >
        
          
          <label class="md-nav__link" for="__nav_4_3_2" id="__nav_4_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    media
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    media
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/media/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Media Assets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3_3" id="__nav_4_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    concept
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/ingest-directory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ingest-directory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/ingest-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ingest-file
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/ingest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ingest
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/inspect-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    inspect-file
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/job/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    job
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/ontology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ontology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/mcp/tools/source/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    source
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    REST API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    REST API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    REST API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ADR-071a-parallel-implementation-findings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-071a: Parallel Graph Query Implementation Findings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ARCHITECTURE_DECISIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture Decision Records (ADRs)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ARCHITECTURE_OVERVIEW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Graph System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../QUERY_SAFETY_BASELINE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Query Safety Baseline - Technical Debt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../RECURSIVE_UPSERT_ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Recursive Upsert Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    access-workflow
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    access-workflow
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-001-multi-tier-agent-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-001: Multi-Tier Agent Access Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-002-node-fitness-scoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-002: Node Fitness Scoring System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-003-semantic-tool-hints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-003: Semantic Tool Hint Networks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-004-pure-graph-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-004: Pure Graph Design (Library Metaphor)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-005-source-text-tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-005: Source Text Tracking and Retrieval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-006-staging-migration-workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-006: Staging and Migration Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../access-workflow/ADR-038-official-project-apparel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-038: Official Project Apparel Design Specifications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_7" >
        
          
          <label class="md-nav__link" for="__nav_6_7" id="__nav_6_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ai-embeddings
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    ai-embeddings
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-039-local-embedding-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-039: Local Embedding Service with Hybrid Client/Server Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-041-ai-extraction-config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-041: AI Extraction Provider Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-042-local-extraction-inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-042: Local LLM Inference for Concept Extraction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-043-single-node-resource-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-043: Single-Node Resource Management for Local Inference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-044-probabilistic-truth-convergence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-044: Probabilistic Truth Convergence Through Contradiction Resolution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-045-046-MIGRATION-PLAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migration Plan: ADR-045/046 Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-045-unified-embedding-generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-045: Unified Embedding Generation System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-049-rate-limiting-and-concurrency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-049: Rate Limiting and Per-Provider Concurrency Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-058-polarity-axis-triangulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-058: Polarity Axis Triangulation for Grounding Calculation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-068-implementation-plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-068 Source Text Embeddings - Implementation Plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-068-source-text-embeddings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-068: Source Text Embeddings for Grounding Truth Retrieval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/ADR-070-polarity-axis-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-070: Polarity Axis Analysis for Bidirectional Semantic Dimensions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_7_13" >
        
          
          <label class="md-nav__link" for="__nav_6_7_13" id="__nav_6_7_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    media-ADR-058
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_7_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_7_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    media-ADR-058
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ai-embeddings/media-ADR-058/README_VISUALIZATIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Polarity Axis Triangulation Visualizations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_8" >
        
          
          <label class="md-nav__link" for="__nav_6_8" id="__nav_6_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    authentication-security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    authentication-security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-017-sensitive-auth-verification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture Decision Record: Client-Initiated Token Revocation for Elevated Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-027-user-management-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-027: User Management API with Lightweight JWT Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-028-dynamic-rbac-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-028: Dynamic Role-Based Access Control (RBAC) System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-031-encrypted-api-key-storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-031: Encrypted API Key Storage with Container Secrets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-054-oauth-client-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-054: OAuth 2.0 Client Management for Multi-Client Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-060-endpoint-security-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-060: API Endpoint Security Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-security/ADR-062-mcp-file-ingestion-security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-062: MCP File Ingestion Security Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_9" >
        
          
          <label class="md-nav__link" for="__nav_6_9" id="__nav_6_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    database-schema
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    database-schema
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database-schema/ADR-016-apache-age-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-016: Apache AGE Migration (Neo4j Replacement)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database-schema/ADR-024-multi-schema-postgresql-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-024: Multi-Schema PostgreSQL Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database-schema/ADR-040-database-schema-migrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-040: Database Schema Migration Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database-schema/ADR-061-operator-pattern-lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-061: Operator Pattern for Platform Lifecycle Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_10" >
        
          
          <label class="md-nav__link" for="__nav_6_10" id="__nav_6_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-012-api-server-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-012: API Server Architecture for Scalable Neo4j Access
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-015-backup-restore-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-015: Backup/Restore Streaming Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-018-server-sent-events-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-018: Server-Sent Events for Real-Time Progress Streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-020-admin-module-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-020: Admin Module Architecture Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-021-live-man-switch-ai-safety/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-021: Live Man Switch - AI Safety for Critical Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-050-scheduled-jobs-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-050: Scheduled Jobs System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-055-cdn-serverless-deployment-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-055: CDN and Serverless Deployment Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/ADR-056-timezone-aware-datetime-utilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-056: Timezone-Aware Datetime Utilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_11" >
        
          
          <label class="md-nav__link" for="__nav_6_11" id="__nav_6_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ingestion-content
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    ingestion-content
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-content/ADR-014-job-approval-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-014: Job Approval Workflow with Pre-Ingestion Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-content/ADR-023-markdown-structured-content-preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-023: Markdown Structured Content Preprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-content/ADR-033-multimodal-ingestion-configurable-prompts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-033: Multimodal Image Ingestion with Configurable Prompt System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-content/ADR-037-human-guided-graph-editing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-037: Human-Guided Graph Editing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-content/ADR-051a-graph-document-deduplication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-051: Graph-Based Provenance Tracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-content/ADR-051b-API-CHANGES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-051: API Changes for Graph-Based Document Deduplication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-content/ADR-057a-multimodal-image-ingestion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-057: Multimodal Image Ingestion with Visual Context Injection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion-content/ADR-057b-appendix-single-vs-two-stage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-057 Appendix: Single-Stage vs Two-Stage Image Processing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_12" checked>
        
          
          <label class="md-nav__link" for="__nav_6_12" id="__nav_6_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    proposals
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_12_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    proposals
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Parallel Graph Query Execution - Design Proposal
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Parallel Graph Query Execution - Design Proposal
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Executive Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-statement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Problem Statement
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Problem Statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-performance-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Current Performance Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#affected-query-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Affected Query Patterns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proposed-solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proposed Solution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Proposed Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-2-phase-parallel-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture: 2-Phase Parallel Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-it-actually-works-a-concrete-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        How It Actually Works (A Concrete Example)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-this-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Works
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-reusable-parallelizer-class" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design: Reusable Parallelizer Class
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-polarity-candidate-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 1: Polarity Candidate Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-neighborhood-queries-diversity-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 2: Neighborhood Queries (Diversity Analysis)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-path-enrichment-web-ui" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 3: Path Enrichment (Web UI)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safety-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Safety Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Safety Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-hilariously-bad-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        The "Hilariously Bad" Scenarios
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The &#34;Hilariously Bad&#34; Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-global-semaphore-preventing-multi-user-deadlock" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Global Semaphore (Preventing Multi-User Deadlock)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-per-worker-result-limits-preventing-memory-explosions" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Per-Worker Result Limits (Preventing Memory Explosions)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-timeouts-preventing-infinite-waits" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Timeouts (Preventing Infinite Waits)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-graceful-degradation-partial-results-are-ok" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Graceful Degradation (Partial Results Are OK)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-security-parameter-binding-preventing-cypher-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Security: Parameter Binding (Preventing Cypher Injection)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-wall-clock-timeout-strictly-bounded-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Wall-Clock Timeout (Strictly Bounded Execution)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-database-side-safety" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Database-Side Safety
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-first-like-adr-049" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database-First (Like ADR-049)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Loading Config
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-estimates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Estimates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Estimates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#polarity-discovery-max_hops2-20-candidates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Polarity Discovery (max_hops=2, 20 candidates)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neighborhood-queries-diversity-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Neighborhood Queries (diversity analysis)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unit Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Load Tests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-plan" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Plan
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-core-parallelizer-week-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: Core Parallelizer (Week 1)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-polarity-integration-week-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: Polarity Integration (Week 2)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-neighborhood-queries-week-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: Neighborhood Queries (Week 3)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-path-enrichment-week-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: Path Enrichment (Week 4)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-monitoring-tuning-week-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 5: Monitoring &amp; Tuning (Week 5)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternatives-considered" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alternatives Considered
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Alternatives Considered">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-a-postgresql-parallel-workers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option A: PostgreSQL Parallel Workers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-b-asyncawait-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option B: Async/Await (asyncio)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-c-distributed-queue-celery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option C: Distributed Queue (Celery)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-d-graphql-dataloader-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option D: GraphQL DataLoader Pattern
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Enhancements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Enhancements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-2-3-hop-parallelization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: 3-Hop Parallelization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-query-result-caching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: Query Result Caching
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-adaptive-worker-count" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: Adaptive Worker Count
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#open-questions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Open Questions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_13" >
        
          
          <label class="md-nav__link" for="__nav_6_13" id="__nav_6_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    query-search
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    query-search
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-search/ADR-030-concept-deduplication-validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-030: Concept Deduplication Quality Validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-search/ADR-063-semantic-diversity-authenticity-signal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-063: Semantic Diversity as Authenticity Signal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-search/ADR-066-published-query-endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-066: Published Query Endpoints
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_14" >
        
          
          <label class="md-nav__link" for="__nav_6_14" id="__nav_6_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    user-interfaces
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    user-interfaces
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-011-cli-admin-separation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-011: CLI and Admin Tooling Separation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-013-unified-typescript-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-013: Unified TypeScript Client (CLI + MCP Server)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-019-type-based-table-formatting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-019: Type-Based Table Formatting System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-029-cli-theory-of-operation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-029: CLI Theory of Operation - Hybrid Unix/Domain-Specific Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-034-graph-visualization-query-workbench/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-034: Graph Visualization &amp; Interactive Query Explorers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-035-explorer-methods-uses-capabilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-035: Explorer Methods, Uses, and Capabilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-036-universal-visual-query-builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-036: Universal Visual Query Builder
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-064-specialized-truth-convergence-visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-064: Specialized Truth Convergence Visualizations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-067-web-app-workstation-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-067: Web Application Workstation Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-interfaces/ADR-069-semantic-fuse-filesystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-069: Semantic FUSE Filesystem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_15" >
        
          
          <label class="md-nav__link" for="__nav_6_15" id="__nav_6_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    vocabulary-relationships
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    vocabulary-relationships
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-022-semantic-relationship-taxonomy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-022: Semantically Sparse 30-Type Relationship Taxonomy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-025-dynamic-relationship-vocabulary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-025: Dynamic Relationship Vocabulary Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-026-autonomous-vocabulary-curation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-026: Autonomous Vocabulary Curation and Ontology Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-032a-automatic-edge-vocabulary-expansion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-032: Automatic Edge Vocabulary Expansion with Intelligent Pruning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-032b-IMPLEMENTATION-NOTES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-032 Implementation Quick Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-046-grounding-aware-vocabulary-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-046: Grounding-Aware Vocabulary Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-047-probabilistic-vocabulary-categorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-047: Probabilistic Vocabulary Categorization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-048-vocabulary-metadata-as-graph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-048: Vocabulary Metadata as First-Class Graph
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-052-vocabulary-expansion-consolidation-cycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-052: Vocabulary Expansion-Consolidation Cycle (The "Dreaming" Pattern)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-053-eager-vocabulary-categorization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-053: Eager Vocabulary Categorization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-059-llm-determined-relationship-direction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-059: LLM-Determined Relationship Direction Semantics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vocabulary-relationships/ADR-065-vocabulary-based-provenance-relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-065: Vocabulary-Based Provenance Relationships
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/AUTO-DOCUMENTATION-STRATEGY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Auto-Documentation Strategy for CLI Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/DEV_JOURNAL_chunked_ingestion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development Journal: Chunked Ingestion System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/DEV_JOURNAL_minio_integration_and_emergent_visual_relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development Journal: MinIO Integration &amp; Emergent Visual Relationships
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/LEARNED_KNOWLEDGE_MCP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Learned Knowledge Synthesis - MCP Enhancement Plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/pattern-repetition-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pattern Repetition in Growth Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/relationship-semantics-comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Relationship Semantics: How Others Do It vs. Our Proposal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/vocabulary-direction-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vocabulary Direction Semantics Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/API_AUTH_AUDIT_RESULTS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Endpoint Authentication Audit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/API_AUTH_AUDIT_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Authentication Audit Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/API_AUTH_TESTING_RESEARCH/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Authentication Testing Research
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/INTEGRATION_TEST_NOTES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integration Test Notes - Working Commands &amp; Observations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/INTEGRATION_TEST_PLAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Knowledge Graph System - Integration Test Plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/SCHEMA_MIGRATION_TEST_REPORT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PostgreSQL Schema Migration - Functional Test Report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/TEST_COVERAGE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Coverage Areas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Executive Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-statement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Problem Statement
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Problem Statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-performance-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Current Performance Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#affected-query-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Affected Query Patterns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proposed-solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proposed Solution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Proposed Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-2-phase-parallel-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture: 2-Phase Parallel Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-it-actually-works-a-concrete-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        How It Actually Works (A Concrete Example)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-this-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Works
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-reusable-parallelizer-class" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design: Reusable Parallelizer Class
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-polarity-candidate-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 1: Polarity Candidate Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-neighborhood-queries-diversity-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 2: Neighborhood Queries (Diversity Analysis)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-path-enrichment-web-ui" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 3: Path Enrichment (Web UI)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safety-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Safety Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Safety Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-hilariously-bad-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        The "Hilariously Bad" Scenarios
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The &#34;Hilariously Bad&#34; Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-global-semaphore-preventing-multi-user-deadlock" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Global Semaphore (Preventing Multi-User Deadlock)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-per-worker-result-limits-preventing-memory-explosions" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Per-Worker Result Limits (Preventing Memory Explosions)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-timeouts-preventing-infinite-waits" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Timeouts (Preventing Infinite Waits)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-graceful-degradation-partial-results-are-ok" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Graceful Degradation (Partial Results Are OK)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-security-parameter-binding-preventing-cypher-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Security: Parameter Binding (Preventing Cypher Injection)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-wall-clock-timeout-strictly-bounded-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Wall-Clock Timeout (Strictly Bounded Execution)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-database-side-safety" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Database-Side Safety
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-first-like-adr-049" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database-First (Like ADR-049)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Loading Config
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-estimates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Estimates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Estimates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#polarity-discovery-max_hops2-20-candidates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Polarity Discovery (max_hops=2, 20 candidates)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neighborhood-queries-diversity-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Neighborhood Queries (diversity analysis)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unit Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Load Tests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-plan" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Plan
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-core-parallelizer-week-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: Core Parallelizer (Week 1)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-polarity-integration-week-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: Polarity Integration (Week 2)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-neighborhood-queries-week-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: Neighborhood Queries (Week 3)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-path-enrichment-week-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: Path Enrichment (Week 4)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-monitoring-tuning-week-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 5: Monitoring &amp; Tuning (Week 5)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternatives-considered" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alternatives Considered
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Alternatives Considered">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-a-postgresql-parallel-workers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option A: PostgreSQL Parallel Workers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-b-asyncawait-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option B: Async/Await (asyncio)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-c-distributed-queue-celery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option C: Distributed Queue (Celery)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-d-graphql-dataloader-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option D: GraphQL DataLoader Pattern
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Enhancements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Enhancements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-2-3-hop-parallelization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: 3-Hop Parallelization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-query-result-caching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: Query Result Caching
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-adaptive-worker-count" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: Adaptive Worker Count
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#open-questions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Open Questions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="parallel-graph-query-execution-design-proposal">Parallel Graph Query Execution - Design Proposal</h1>
<p><strong>Related:</strong> Issue #155, ADR-049 (Concurrency), ADR-050 (Worker Pattern)
<strong>Date:</strong> 2025-12-01
<strong>Status:</strong> Draft</p>
<h2 id="executive-summary">Executive Summary</h2>
<p>Alright, so here's the situation: we've got these graph traversal queries that are taking 3+ minutes to run, which is just ridiculous. The problem is that when you ask "find me all concepts within 2 hops of these poles," PostgreSQL ends up exploring every single path one after another like it's walking through a maze with a blindfold on. It's methodical, but painfully slow.</p>
<p>The fix? We're going to implement a reusable <strong>n-hop parallelizer</strong> that uses connection pooling and Python's <code>ThreadPoolExecutor</code> to turn this sequential slog into a parallel sprint. Instead of one query doing all the work, we'll have 8 (or 16, or 32) queries running simultaneously, each handling a small chunk of the graph.</p>
<p><strong>The Key Insight That Makes This Work:</strong> PostgreSQL can't parallelize AGE Cypher queries on its own. Why? Because AGE queries aren't actually SQL queriesthey're function calls to <code>ag_catalog.cypher()</code>. From PostgreSQL's perspective, it's just calling a function that returns some data, and it has no idea that function is doing complex graph traversal underneath. So PostgreSQL's parallel query machinery never kicks in.</p>
<p>But here's the beautiful part: while PostgreSQL can't parallelize a <em>single</em> graph query, it's perfectly happy running <em>multiple</em> graph queries at the same time. That's what connection pooling is for! So we flip the problem on its headinstead of asking the database to parallelize one big query, we break it into many small queries and run them in parallel ourselves. The database just sees "oh, I've got 8 concurrent connections asking for small chunks of data" and handles it beautifully.</p>
<h2 id="problem-statement">Problem Statement</h2>
<h3 id="current-performance-issues">Current Performance Issues</h3>
<p>Let me show you what's happening right now with polarity candidate discovery (<code>api/lib/polarity_axis.py:190-280</code>). We've got this query:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">pole</span><span class="p">:</span><span class="n">Concept</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">pole</span><span class="p">.</span><span class="n">concept_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="o">[</span><span class="s">&#39;pole1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;pole2&#39;</span><span class="o">]</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">pole</span><span class="p">)</span><span class="o">-[</span><span class="p">*</span><span class="m">1</span><span class="p">..</span><span class="m">2</span><span class="o">]-</span><span class="p">(</span><span class="n">candidate</span><span class="p">:</span><span class="n">Concept</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">candidate</span><span class="p">.</span><span class="n">embedding</span><span class="w"> </span><span class="n">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">RETURN</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">candidate</span><span class="p">.</span><span class="n">concept_id</span>
</code></pre></div>
<p>See that <code>[*1..2]</code> part? That's a variable-length path pattern, and it's where things go sideways. When you run this:</p>
<ul>
<li>
<p><strong>max_hops=1</strong>: Takes about 500ms. Not bad! The query finds the immediate neighbors of your two pole concepts and returns them. We're talking maybe 100-200 concepts total.</p>
</li>
<li>
<p><strong>max_hops=2</strong>: Takes <strong>over 3 minutes</strong>. Completely unacceptable. What changed?</p>
</li>
</ul>
<p>Here's what's happening under the hood. When you say "find me concepts within 2 hops," the database has to:</p>
<ol>
<li>Find all 1-hop neighbors of pole1 and pole2 (let's say 100 concepts each = 200 total)</li>
<li>For each of those 200 concepts, find <em>their</em> neighbors (100 each again)</li>
<li>That's 200  100 = <strong>20,000 potential paths</strong> to explore</li>
</ol>
<p>And here's the kicker: it's doing all of this <strong>sequentially</strong>, in a single thread. It's like asking one person to individually check 20,000 mailboxes when you could have 8 people each check 2,500 mailboxes at the same time.</p>
<p><strong>Why This Happens:</strong></p>
<p>The Cypher variable-length path pattern <code>[*1..N]</code> is powerful, but it evaluates all possible paths before filtering. So even though we only care about distinct concepts at the end, the database is internally tracking every possible way to reach each concept. For highly connected graphs (which ours isconcepts in a knowledge graph tend to be hubs), this creates a combinatorial explosion.</p>
<p>The statement timeout we tried to add? Doesn't work because of a connection pooling quirk. We set the timeout on connection A, but the query might run on connection B from the pool. Classic distributed systems gotcha.</p>
<h3 id="affected-query-patterns">Affected Query Patterns</h3>
<p>This problem affects <strong>three major query types</strong>:</p>
<table>
<thead>
<tr>
<th>Query Type</th>
<th>Current Implementation</th>
<th>Performance Issue</th>
<th>File Location</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Polarity Discovery</strong></td>
<td><code>(pole)-[*1..N]-(candidate)</code></td>
<td>3+ min @ N=2</td>
<td><code>api/lib/polarity_axis.py:190</code></td>
</tr>
<tr>
<td><strong>Neighborhood Queries</strong></td>
<td><code>(center)-[*1..N]-(neighbor)</code></td>
<td>Slow on hubs</td>
<td><code>api/services/diversity_analyzer.py:174</code></td>
</tr>
<tr>
<td><strong>Path Enrichment</strong></td>
<td>Get neighborhoods around each hop</td>
<td>Sequential, slow</td>
<td><code>web/src/views/ExplorerView.tsx:199</code></td>
</tr>
</tbody>
</table>
<p><strong>Shared Pattern:</strong> All need multi-hop traversal from seed concepts.</p>
<h2 id="proposed-solution">Proposed Solution</h2>
<h3 id="architecture-2-phase-parallel-execution">Architecture: 2-Phase Parallel Execution</h3>
<p><strong>Phase 1: Direct Neighbors (1-hop) - Single Query</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Fast query: Get immediate neighbors of all seed concepts</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="c1"># Returns 100-500 concepts typically</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">neighbors_1hop</span> <span class="o">=</span> <span class="n">execute_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="s2">    MATCH (seed:Concept)-[]-(neighbor:Concept)</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="s2">    WHERE seed.concept_id IN $seed_ids</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="s2">    AND neighbor.embedding IS NOT NULL</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="s2">    RETURN DISTINCT neighbor.concept_id</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Phase 2: Extended Neighbors (2-hop) - Parallel Queries</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Parallel execution: For each 1-hop neighbor, get their neighbors</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="k">for</span> <span class="n">neighbor_id</span> <span class="ow">in</span> <span class="n">neighbors_1hop</span><span class="p">:</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>        <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>            <span class="n">get_1hop_neighbors</span><span class="p">,</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>            <span class="n">neighbor_id</span><span class="p">,</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>            <span class="n">connection_pool</span>  <span class="c1"># psycopg2 pool (already configured)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>        <span class="p">)</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="c1"># Collect and merge results</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">neighbors_2hop</span> <span class="o">=</span> <span class="n">merge_and_deduplicate</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="how-it-actually-works-a-concrete-example">How It Actually Works (A Concrete Example)</h3>
<p>Let me walk you through a real polarity analysis query to show you exactly what happens at each step.</p>
<p><strong>Scenario:</strong> You're analyzing the polarity axis between "Centralized" and "Decentralized" with <code>max_hops=2</code>.</p>
<p><strong>Phase 1: The Fast Part (Single Query)</strong></p>
<p>We start with a simple, fast query to get all 1-hop neighbors of both poles:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">seed</span><span class="p">:</span><span class="n">Concept</span><span class="p">)</span><span class="o">-[]-</span><span class="p">(</span><span class="n">neighbor</span><span class="p">:</span><span class="n">Concept</span><span class="p">)</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">seed</span><span class="p">.</span><span class="n">concept_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="o">[</span><span class="s">&#39;centralized_abc123&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;decentralized_def456&#39;</span><span class="o">]</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="n">AND</span><span class="w"> </span><span class="n">neighbor</span><span class="p">.</span><span class="n">embedding</span><span class="w"> </span><span class="n">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="k">RETURN</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">neighbor</span><span class="p">.</span><span class="n">concept_id</span>
</code></pre></div>
<p>This runs in ~500ms and returns, let's say, 150 concepts:
- 80 neighbors of "Centralized" (things like "Authority," "Control," "Hierarchy")
- 70 neighbors of "Decentralized" (things like "Autonomy," "Distribution," "Peer-to-peer")</p>
<p>Total: 150 concepts that are directly connected to our poles.</p>
<p><strong>Phase 2: The Parallel Part (8 Workers with Chunking)</strong></p>
<p>Now we need the neighbors of those 150 concepts. Instead of one query with <code>[*1..2]</code> (which would explore 150  100 = 15,000 paths sequentially), we use <strong>chunking</strong> to minimize network overhead.</p>
<p><strong>The Optimization:</strong> Instead of 1 worker = 1 concept = 1 query (150 total queries), we do 1 worker = 1 chunk of concepts = 1 batched query (8 total queries).</p>
<p>Split 150 concepts into 8 chunks:
- Chunk 1: Concepts 1-19 (19 IDs)
- Chunk 2: Concepts 20-37 (18 IDs)
- Chunk 3: Concepts 38-56 (19 IDs)
- ... and so on ...
- Chunk 8: Concepts 134-150 (17 IDs)</p>
<p>Each worker:
1. Grabs a connection from the pool
2. Runs <strong>ONE</strong> batched query for its entire chunk:
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">seed</span><span class="p">:</span><span class="n">Concept</span><span class="p">)</span><span class="o">-[]-</span><span class="p">(</span><span class="n">neighbor</span><span class="p">:</span><span class="n">Concept</span><span class="p">)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">seed</span><span class="p">.</span><span class="n">concept_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">$</span><span class="n">seed_ids</span><span class="w">  </span><span class="err">--</span><span class="w"> </span><span class="k">All</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="n">IDs</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">parameter</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="n">AND</span><span class="w"> </span><span class="n">neighbor</span><span class="p">.</span><span class="n">embedding</span><span class="w"> </span><span class="n">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="k">RETURN</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">neighbor</span><span class="p">.</span><span class="n">concept_id</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="k">LIMIT</span><span class="w"> </span><span class="m">2000</span><span class="w">  </span><span class="err">--</span><span class="w"> </span><span class="n">Higher</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">we</span><span class="err">&#39;</span><span class="n">re</span><span class="w"> </span><span class="n">batching</span>
</code></pre></div>
3. Collects all neighbor IDs (deduped by DISTINCT)
4. Returns the connection to the pool
5. Reports its results back</p>
<p><strong>Why Chunking Matters:</strong></p>
<ul>
<li><strong>Network overhead:</strong> Each query has ~10ms latency (connection setup, query parse, result marshal)</li>
<li><strong>Old approach:</strong> 150 concepts  10ms = 1,500ms wasted in network overhead</li>
<li><strong>New approach:</strong> 8 chunks  10ms = 80ms network overhead</li>
<li><strong>Savings:</strong> 1,420ms (1.4 seconds) just from batching!</li>
</ul>
<p>Plus, the database can optimize a single batched query better than 19 separate queries (shared query plan, shared index lookups).</p>
<p><strong>The Timeline (With Chunking):</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>T=0ms:     Start Phase 1 query
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>T=500ms:   Phase 1 complete (150 1-hop neighbors found)
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>T=500ms:   Split into 8 chunks of ~19 IDs each
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>T=502ms:   Launch 8 workers in parallel
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>T=504ms:   All 8 workers grab connections from pool
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>T=504ms:   All 8 workers start their batched queries
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>T=1500ms:  Worker 1 finishes its batched query (19 seeds)  returns connection
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>T=1520ms:  Worker 2 finishes its batched query (18 seeds)  returns connection
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>T=1540ms:  Worker 3 finishes its batched query (19 seeds)  returns connection
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>... workers finish between 1.5-1.8 seconds ...
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>T=1800ms:  Worker 8 finishes its batched query (17 seeds)  returns connection
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>T=1810ms:  Merge and deduplicate all results
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>T=1850ms:  Return final set of ~2,500 unique concepts
</code></pre></div>
<p><strong>Total Time:</strong> ~1.85 seconds (less than 2 seconds!)</p>
<p><strong>Compare to Sequential:</strong></p>
<p>If we'd done this sequentially:
- Phase 1: 500ms (same)
- Phase 2: 150 concepts  2s per query = 300s = <strong>5 minutes</strong></p>
<p><strong>Total Time:</strong> 5+ minutes</p>
<p><strong>Compare to Parallel Without Chunking:</strong></p>
<p>If we'd done parallel but with 150 individual queries:
- Phase 1: 500ms
- Phase 2: (150  8)  2s + 1.5s network overhead = ~5 seconds</p>
<p><strong>Total Time:</strong> ~5.5 seconds</p>
<p><strong>With Chunking:</strong> ~1.85 seconds</p>
<p>We just went from 5 minutes (sequential) to 1.85 seconds (parallel + chunked). That's a <strong>160x speedup</strong>.</p>
<p>Even compared to "parallel without chunking" (5.5s), chunking gives us a <strong>3x improvement</strong>.</p>
<h3 id="why-this-works">Why This Works</h3>
<p>Let me walk you through why this approach is actually brilliant (and why it won't blow up in our faces).</p>
<p><strong>We're Not Reinventing Anything:</strong></p>
<p>First off, we're not adding new infrastructure. We already have connection pooling set up (<code>AGEClient.pool</code>)that's been there since day one. And <code>ThreadPoolExecutor</code>? That's Python standard library. No new dependencies to manage, no new services to deploy, no new things to break at 2am.</p>
<p>Here's how it works in practice: Each thread in our pool grabs a connection from the existing pool, runs its query, and puts the connection back. It's like a checkout counter at a librarythere are 20 books (connections), and people (threads) can check them out, use them, and return them. As long as you don't have more people trying to check out books than you have books, everything flows smoothly.</p>
<p><strong>The Math That Makes You Smile:</strong></p>
<p>Let's say we have 100 concepts from our 1-hop query, and each needs a 1-hop query of its own to find their neighbors. Currently:</p>
<ul>
<li><strong>Sequential (what we have now):</strong> 100 queries  2 seconds each = 200 seconds (over 3 minutes)</li>
</ul>
<p>That's one query finishing, then the next starting, then the next... it's agonizing.</p>
<p>With 8 workers in parallel:
- <strong>Parallel (8 workers):</strong> 100 queries  8 workers  2 seconds = 25 seconds</p>
<p>We just went from 3+ minutes to 25 seconds. That's an <strong>8x speedup</strong>. And if we're feeling ambitious and bump it to 32 workers (which we can, if we increase the connection pool size):</p>
<ul>
<li><strong>Parallel (32 workers):</strong> 100 queries  32 workers  2 seconds = 6.25 seconds</li>
</ul>
<p>From 3 minutes to 6 seconds. That's a <strong>30x speedup</strong>. Your polarity analysis goes from "go grab a coffee" to "blink and you miss it."</p>
<p><strong>Why It's Actually Safe:</strong></p>
<p>You might be thinking "wait, won't 32 concurrent queries just overwhelm the database?" Great question! Here's why it won't:</p>
<ol>
<li>
<p><strong>PostgreSQL is Built for This:</strong> PostgreSQL uses MVCC (Multi-Version Concurrency Control), which means it can handle tons of concurrent reads without them blocking each other. Each query sees its own consistent snapshot of the data. This is literally what PostgreSQL was designed to do.</p>
</li>
<li>
<p><strong>Connection Pooling Prevents Chaos:</strong> We're not creating 32 new connections to the database. We have a pool of (let's say) 20 connections. If we try to use more than 20 at once, the extras just wait in line. The pool acts as a natural rate limiter.</p>
</li>
<li>
<p><strong>It's Like ADR-049, But for Queries:</strong> Remember how we solved the "100 concurrent OpenAI API calls = rate limit hell" problem? We used semaphores to limit concurrent requests. This is the exact same pattern, just applied to database queries instead of API calls. We're not cowboys herewe're using proven patterns.</p>
</li>
</ol>
<h2 id="design-reusable-parallelizer-class">Design: Reusable Parallelizer Class</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># api/lib/graph_parallelizer.py</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="nd">@dataclass</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">ParallelQueryConfig</span><span class="p">:</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for parallel query execution&quot;&quot;&quot;</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>    <span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># Like ADR-049 semaphores</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>    <span class="n">max_results_per_worker</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Prevent runaway queries</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>    <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># Per-worker timeout</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>    <span class="n">deduplicate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Remove duplicate results</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">GraphParallelizer</span><span class="p">:</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="sd">    Reusable n-hop query parallelizer using connection pooling.</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="sd">    Breaks multi-hop graph queries into:</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="sd">    1. Phase 1: Fast single query for 1-hop neighbors</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="sd">    2. Phase 2: Parallel queries for 2-hop neighbors</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="sd">    Use Cases:</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="sd">    - Polarity candidate discovery</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="sd">    - Neighborhood queries</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="sd">    - Path enrichment</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age_client</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ParallelQueryConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">age_client</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">ParallelQueryConfig</span><span class="p">()</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_nhop_neighbors</span><span class="p">(</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>        <span class="n">seed_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>        <span class="n">max_hops</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>        <span class="n">filter_clause</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;neighbor.embedding IS NOT NULL&quot;</span><span class="p">,</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>        <span class="n">relationship_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="sd">        Get n-hop neighbors of seed concepts using parallel execution.</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="sd">        Args:</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="sd">            seed_ids: Starting concept IDs</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="sd">            max_hops: Maximum hops (1 or 2 recommended)</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="sd">            filter_clause: Cypher WHERE clause for neighbors</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="sd">            relationship_filter: Optional relationship type filter</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="sd">        Returns:</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="sd">            Set of neighbor concept IDs (deduped)</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a>        <span class="k">if</span> <span class="n">max_hops</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a>            <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a>        <span class="c1"># Validate seed IDs to prevent injection</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a>        <span class="k">for</span> <span class="n">seed_id</span> <span class="ow">in</span> <span class="n">seed_ids</span><span class="p">:</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">api.lib.polarity_axis</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_concept_id</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a>            <span class="n">validate_concept_id</span><span class="p">(</span><span class="n">seed_id</span><span class="p">)</span>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a>        <span class="c1"># Phase 1: Get 1-hop neighbors (fast single query)</span>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a>        <span class="n">neighbors_1hop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_1hop_neighbors</span><span class="p">(</span>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a>            <span class="n">seed_ids</span><span class="p">,</span>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a>            <span class="n">filter_clause</span><span class="p">,</span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a>            <span class="n">relationship_filter</span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a>        <span class="p">)</span>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Phase 1: Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">neighbors_1hop</span><span class="p">)</span><span class="si">}</span><span class="s2"> 1-hop neighbors&quot;</span><span class="p">)</span>
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a>
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a>        <span class="k">if</span> <span class="n">max_hops</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a>            <span class="k">return</span> <span class="n">neighbors_1hop</span>
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a>
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a>        <span class="c1"># Phase 2: Get 2-hop neighbors in parallel</span>
<a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a>        <span class="n">neighbors_2hop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_2hop_neighbors_parallel</span><span class="p">(</span>
<a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a>            <span class="nb">list</span><span class="p">(</span><span class="n">neighbors_1hop</span><span class="p">),</span>
<a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a>            <span class="n">filter_clause</span><span class="p">,</span>
<a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a>            <span class="n">relationship_filter</span>
<a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a>        <span class="p">)</span>
<a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a>
<a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Phase 2: Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">neighbors_2hop</span><span class="p">)</span><span class="si">}</span><span class="s2"> total 2-hop neighbors&quot;</span><span class="p">)</span>
<a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a>
<a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a>        <span class="c1"># Merge 1-hop and 2-hop (dedupe)</span>
<a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a>        <span class="n">all_neighbors</span> <span class="o">=</span> <span class="n">neighbors_1hop</span> <span class="o">|</span> <span class="n">neighbors_2hop</span>
<a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a>
<a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a>        <span class="c1"># Remove seeds from results</span>
<a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a>        <span class="n">all_neighbors</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">(</span><span class="n">seed_ids</span><span class="p">)</span>
<a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a>
<a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a>        <span class="k">return</span> <span class="n">all_neighbors</span>
<a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a>
<a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_1hop_neighbors</span><span class="p">(</span>
<a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a>        <span class="n">seed_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a>        <span class="n">filter_clause</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a>        <span class="n">relationship_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get 1-hop neighbors in single query&quot;&quot;&quot;</span>
<a id="__codelineno-6-99" name="__codelineno-6-99" href="#__codelineno-6-99"></a>
<a id="__codelineno-6-100" name="__codelineno-6-100" href="#__codelineno-6-100"></a>        <span class="c1"># Build relationship pattern</span>
<a id="__codelineno-6-101" name="__codelineno-6-101" href="#__codelineno-6-101"></a>        <span class="n">rel_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[:</span><span class="si">{</span><span class="n">relationship_filter</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">if</span> <span class="n">relationship_filter</span> <span class="k">else</span> <span class="s2">&quot;[]&quot;</span>
<a id="__codelineno-6-102" name="__codelineno-6-102" href="#__codelineno-6-102"></a>
<a id="__codelineno-6-103" name="__codelineno-6-103" href="#__codelineno-6-103"></a>        <span class="c1"># Safe: IDs validated above, using parameterized query</span>
<a id="__codelineno-6-104" name="__codelineno-6-104" href="#__codelineno-6-104"></a>        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-6-105" name="__codelineno-6-105" href="#__codelineno-6-105"></a><span class="s2">            MATCH (seed:Concept)-</span><span class="si">{</span><span class="n">rel_pattern</span><span class="si">}</span><span class="s2">-(neighbor:Concept)</span>
<a id="__codelineno-6-106" name="__codelineno-6-106" href="#__codelineno-6-106"></a><span class="s2">            WHERE seed.concept_id IN $seed_ids</span>
<a id="__codelineno-6-107" name="__codelineno-6-107" href="#__codelineno-6-107"></a><span class="s2">              AND </span><span class="si">{</span><span class="n">filter_clause</span><span class="si">}</span>
<a id="__codelineno-6-108" name="__codelineno-6-108" href="#__codelineno-6-108"></a><span class="s2">            RETURN DISTINCT neighbor.concept_id as concept_id</span>
<a id="__codelineno-6-109" name="__codelineno-6-109" href="#__codelineno-6-109"></a><span class="s2">            LIMIT </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_results_per_worker</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">seed_ids</span><span class="p">)</span><span class="si">}</span>
<a id="__codelineno-6-110" name="__codelineno-6-110" href="#__codelineno-6-110"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-6-111" name="__codelineno-6-111" href="#__codelineno-6-111"></a>
<a id="__codelineno-6-112" name="__codelineno-6-112" href="#__codelineno-6-112"></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">facade</span><span class="o">.</span><span class="n">execute_raw</span><span class="p">(</span>
<a id="__codelineno-6-113" name="__codelineno-6-113" href="#__codelineno-6-113"></a>            <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
<a id="__codelineno-6-114" name="__codelineno-6-114" href="#__codelineno-6-114"></a>            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;seed_ids&quot;</span><span class="p">:</span> <span class="n">seed_ids</span><span class="p">},</span>
<a id="__codelineno-6-115" name="__codelineno-6-115" href="#__codelineno-6-115"></a>            <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;concept&quot;</span>
<a id="__codelineno-6-116" name="__codelineno-6-116" href="#__codelineno-6-116"></a>        <span class="p">)</span>
<a id="__codelineno-6-117" name="__codelineno-6-117" href="#__codelineno-6-117"></a>
<a id="__codelineno-6-118" name="__codelineno-6-118" href="#__codelineno-6-118"></a>        <span class="k">return</span> <span class="p">{</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;concept_id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">}</span>
<a id="__codelineno-6-119" name="__codelineno-6-119" href="#__codelineno-6-119"></a>
<a id="__codelineno-6-120" name="__codelineno-6-120" href="#__codelineno-6-120"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_2hop_neighbors_parallel</span><span class="p">(</span>
<a id="__codelineno-6-121" name="__codelineno-6-121" href="#__codelineno-6-121"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-6-122" name="__codelineno-6-122" href="#__codelineno-6-122"></a>        <span class="n">hop1_neighbors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-6-123" name="__codelineno-6-123" href="#__codelineno-6-123"></a>        <span class="n">filter_clause</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-6-124" name="__codelineno-6-124" href="#__codelineno-6-124"></a>        <span class="n">relationship_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<a id="__codelineno-6-125" name="__codelineno-6-125" href="#__codelineno-6-125"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-6-126" name="__codelineno-6-126" href="#__codelineno-6-126"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get 2-hop neighbors using parallel worker pool&quot;&quot;&quot;</span>
<a id="__codelineno-6-127" name="__codelineno-6-127" href="#__codelineno-6-127"></a>
<a id="__codelineno-6-128" name="__codelineno-6-128" href="#__codelineno-6-128"></a>        <span class="n">all_neighbors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-6-129" name="__codelineno-6-129" href="#__codelineno-6-129"></a>
<a id="__codelineno-6-130" name="__codelineno-6-130" href="#__codelineno-6-130"></a>        <span class="c1"># Use ThreadPoolExecutor for parallel queries</span>
<a id="__codelineno-6-131" name="__codelineno-6-131" href="#__codelineno-6-131"></a>        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-6-132" name="__codelineno-6-132" href="#__codelineno-6-132"></a>            <span class="c1"># Submit all 1-hop neighbors for parallel processing</span>
<a id="__codelineno-6-133" name="__codelineno-6-133" href="#__codelineno-6-133"></a>            <span class="n">futures</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-6-134" name="__codelineno-6-134" href="#__codelineno-6-134"></a>                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
<a id="__codelineno-6-135" name="__codelineno-6-135" href="#__codelineno-6-135"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_1hop_neighbors_worker</span><span class="p">,</span>
<a id="__codelineno-6-136" name="__codelineno-6-136" href="#__codelineno-6-136"></a>                    <span class="n">neighbor_id</span><span class="p">,</span>
<a id="__codelineno-6-137" name="__codelineno-6-137" href="#__codelineno-6-137"></a>                    <span class="n">filter_clause</span><span class="p">,</span>
<a id="__codelineno-6-138" name="__codelineno-6-138" href="#__codelineno-6-138"></a>                    <span class="n">relationship_filter</span>
<a id="__codelineno-6-139" name="__codelineno-6-139" href="#__codelineno-6-139"></a>                <span class="p">):</span> <span class="n">neighbor_id</span>
<a id="__codelineno-6-140" name="__codelineno-6-140" href="#__codelineno-6-140"></a>                <span class="k">for</span> <span class="n">neighbor_id</span> <span class="ow">in</span> <span class="n">hop1_neighbors</span>
<a id="__codelineno-6-141" name="__codelineno-6-141" href="#__codelineno-6-141"></a>            <span class="p">}</span>
<a id="__codelineno-6-142" name="__codelineno-6-142" href="#__codelineno-6-142"></a>
<a id="__codelineno-6-143" name="__codelineno-6-143" href="#__codelineno-6-143"></a>            <span class="c1"># Collect results as they complete</span>
<a id="__codelineno-6-144" name="__codelineno-6-144" href="#__codelineno-6-144"></a>            <span class="n">completed</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-6-145" name="__codelineno-6-145" href="#__codelineno-6-145"></a>            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeout_seconds</span><span class="p">):</span>
<a id="__codelineno-6-146" name="__codelineno-6-146" href="#__codelineno-6-146"></a>                <span class="n">neighbor_id</span> <span class="o">=</span> <span class="n">futures</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
<a id="__codelineno-6-147" name="__codelineno-6-147" href="#__codelineno-6-147"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-6-148" name="__codelineno-6-148" href="#__codelineno-6-148"></a>                    <span class="n">neighbors</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<a id="__codelineno-6-149" name="__codelineno-6-149" href="#__codelineno-6-149"></a>                    <span class="n">all_neighbors</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span>
<a id="__codelineno-6-150" name="__codelineno-6-150" href="#__codelineno-6-150"></a>                    <span class="n">completed</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-6-151" name="__codelineno-6-151" href="#__codelineno-6-151"></a>
<a id="__codelineno-6-152" name="__codelineno-6-152" href="#__codelineno-6-152"></a>                    <span class="k">if</span> <span class="n">completed</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-6-153" name="__codelineno-6-153" href="#__codelineno-6-153"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed </span><span class="si">{</span><span class="n">completed</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">hop1_neighbors</span><span class="p">)</span><span class="si">}</span><span class="s2"> workers&quot;</span><span class="p">)</span>
<a id="__codelineno-6-154" name="__codelineno-6-154" href="#__codelineno-6-154"></a>
<a id="__codelineno-6-155" name="__codelineno-6-155" href="#__codelineno-6-155"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-6-156" name="__codelineno-6-156" href="#__codelineno-6-156"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker failed for </span><span class="si">{</span><span class="n">neighbor_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-157" name="__codelineno-6-157" href="#__codelineno-6-157"></a>                    <span class="c1"># Continue processing other workers</span>
<a id="__codelineno-6-158" name="__codelineno-6-158" href="#__codelineno-6-158"></a>
<a id="__codelineno-6-159" name="__codelineno-6-159" href="#__codelineno-6-159"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parallel phase completed: </span><span class="si">{</span><span class="n">completed</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">hop1_neighbors</span><span class="p">)</span><span class="si">}</span><span class="s2"> workers succeeded&quot;</span><span class="p">)</span>
<a id="__codelineno-6-160" name="__codelineno-6-160" href="#__codelineno-6-160"></a>
<a id="__codelineno-6-161" name="__codelineno-6-161" href="#__codelineno-6-161"></a>        <span class="k">return</span> <span class="n">all_neighbors</span>
<a id="__codelineno-6-162" name="__codelineno-6-162" href="#__codelineno-6-162"></a>
<a id="__codelineno-6-163" name="__codelineno-6-163" href="#__codelineno-6-163"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_1hop_neighbors_worker</span><span class="p">(</span>
<a id="__codelineno-6-164" name="__codelineno-6-164" href="#__codelineno-6-164"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-6-165" name="__codelineno-6-165" href="#__codelineno-6-165"></a>        <span class="n">seed_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-6-166" name="__codelineno-6-166" href="#__codelineno-6-166"></a>        <span class="n">filter_clause</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-6-167" name="__codelineno-6-167" href="#__codelineno-6-167"></a>        <span class="n">relationship_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<a id="__codelineno-6-168" name="__codelineno-6-168" href="#__codelineno-6-168"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-6-169" name="__codelineno-6-169" href="#__codelineno-6-169"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-6-170" name="__codelineno-6-170" href="#__codelineno-6-170"></a><span class="sd">        Worker function: Get 1-hop neighbors for single seed.</span>
<a id="__codelineno-6-171" name="__codelineno-6-171" href="#__codelineno-6-171"></a>
<a id="__codelineno-6-172" name="__codelineno-6-172" href="#__codelineno-6-172"></a><span class="sd">        Runs in thread pool - gets connection from pool, returns after query.</span>
<a id="__codelineno-6-173" name="__codelineno-6-173" href="#__codelineno-6-173"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-6-174" name="__codelineno-6-174" href="#__codelineno-6-174"></a>        <span class="c1"># Get connection from pool (thread-safe)</span>
<a id="__codelineno-6-175" name="__codelineno-6-175" href="#__codelineno-6-175"></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
<a id="__codelineno-6-176" name="__codelineno-6-176" href="#__codelineno-6-176"></a>
<a id="__codelineno-6-177" name="__codelineno-6-177" href="#__codelineno-6-177"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-6-178" name="__codelineno-6-178" href="#__codelineno-6-178"></a>            <span class="c1"># Build query</span>
<a id="__codelineno-6-179" name="__codelineno-6-179" href="#__codelineno-6-179"></a>            <span class="n">rel_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[:</span><span class="si">{</span><span class="n">relationship_filter</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">if</span> <span class="n">relationship_filter</span> <span class="k">else</span> <span class="s2">&quot;[]&quot;</span>
<a id="__codelineno-6-180" name="__codelineno-6-180" href="#__codelineno-6-180"></a>
<a id="__codelineno-6-181" name="__codelineno-6-181" href="#__codelineno-6-181"></a>            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-6-182" name="__codelineno-6-182" href="#__codelineno-6-182"></a><span class="s2">                SELECT * FROM ag_catalog.cypher(&#39;concept&#39;, $$</span>
<a id="__codelineno-6-183" name="__codelineno-6-183" href="#__codelineno-6-183"></a><span class="s2">                    MATCH (seed:Concept </span><span class="se">{{</span><span class="s2">concept_id: &#39;</span><span class="si">{</span><span class="n">seed_id</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">}}</span><span class="s2">)-</span><span class="si">{</span><span class="n">rel_pattern</span><span class="si">}</span><span class="s2">-(neighbor:Concept)</span>
<a id="__codelineno-6-184" name="__codelineno-6-184" href="#__codelineno-6-184"></a><span class="s2">                    WHERE </span><span class="si">{</span><span class="n">filter_clause</span><span class="si">}</span>
<a id="__codelineno-6-185" name="__codelineno-6-185" href="#__codelineno-6-185"></a><span class="s2">                    RETURN DISTINCT neighbor.concept_id as concept_id</span>
<a id="__codelineno-6-186" name="__codelineno-6-186" href="#__codelineno-6-186"></a><span class="s2">                    LIMIT </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_results_per_worker</span><span class="si">}</span>
<a id="__codelineno-6-187" name="__codelineno-6-187" href="#__codelineno-6-187"></a><span class="s2">                $$) as (concept_id agtype);</span>
<a id="__codelineno-6-188" name="__codelineno-6-188" href="#__codelineno-6-188"></a><span class="s2">            &quot;&quot;&quot;</span>
<a id="__codelineno-6-189" name="__codelineno-6-189" href="#__codelineno-6-189"></a>
<a id="__codelineno-6-190" name="__codelineno-6-190" href="#__codelineno-6-190"></a>            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
<a id="__codelineno-6-191" name="__codelineno-6-191" href="#__codelineno-6-191"></a>                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-6-192" name="__codelineno-6-192" href="#__codelineno-6-192"></a>                <span class="n">results</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-6-193" name="__codelineno-6-193" href="#__codelineno-6-193"></a>
<a id="__codelineno-6-194" name="__codelineno-6-194" href="#__codelineno-6-194"></a>            <span class="c1"># Extract concept IDs from agtype results</span>
<a id="__codelineno-6-195" name="__codelineno-6-195" href="#__codelineno-6-195"></a>            <span class="n">neighbor_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-6-196" name="__codelineno-6-196" href="#__codelineno-6-196"></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
<a id="__codelineno-6-197" name="__codelineno-6-197" href="#__codelineno-6-197"></a>                <span class="c1"># Parse agtype JSON</span>
<a id="__codelineno-6-198" name="__codelineno-6-198" href="#__codelineno-6-198"></a>                <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-6-199" name="__codelineno-6-199" href="#__codelineno-6-199"></a>                <span class="n">concept_id</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-6-200" name="__codelineno-6-200" href="#__codelineno-6-200"></a>                <span class="n">neighbor_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">concept_id</span><span class="p">)</span>
<a id="__codelineno-6-201" name="__codelineno-6-201" href="#__codelineno-6-201"></a>
<a id="__codelineno-6-202" name="__codelineno-6-202" href="#__codelineno-6-202"></a>            <span class="k">return</span> <span class="n">neighbor_ids</span>
<a id="__codelineno-6-203" name="__codelineno-6-203" href="#__codelineno-6-203"></a>
<a id="__codelineno-6-204" name="__codelineno-6-204" href="#__codelineno-6-204"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-6-205" name="__codelineno-6-205" href="#__codelineno-6-205"></a>            <span class="c1"># Always return connection to pool</span>
<a id="__codelineno-6-206" name="__codelineno-6-206" href="#__codelineno-6-206"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</code></pre></div>
<h2 id="integration-examples">Integration Examples</h2>
<h3 id="example-1-polarity-candidate-discovery">Example 1: Polarity Candidate Discovery</h3>
<p><strong>Before (Sequential):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">discover_candidate_concepts</span><span class="p">(</span><span class="n">positive_pole_id</span><span class="p">,</span> <span class="n">negative_pole_id</span><span class="p">,</span> <span class="n">age_client</span><span class="p">,</span> <span class="n">max_hops</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="c1"># Single query with variable-length path</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="c1"># Takes 3+ minutes for max_hops=2</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">age_client</span><span class="o">.</span><span class="n">facade</span><span class="o">.</span><span class="n">execute_raw</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="s2">        MATCH (pole)-[*1..</span><span class="si">{</span><span class="n">max_hops</span><span class="si">}</span><span class="s2">]-(candidate)</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="s2">        WHERE pole.concept_id IN [&#39;</span><span class="si">{</span><span class="n">positive_pole_id</span><span class="si">}</span><span class="s2">&#39;, &#39;</span><span class="si">{</span><span class="n">negative_pole_id</span><span class="si">}</span><span class="s2">&#39;]</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="s2">        RETURN DISTINCT candidate.concept_id</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;concept_id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
</code></pre></div></p>
<p><strong>After (Parallel):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">discover_candidate_concepts</span><span class="p">(</span><span class="n">positive_pole_id</span><span class="p">,</span> <span class="n">negative_pole_id</span><span class="p">,</span> <span class="n">age_client</span><span class="p">,</span> <span class="n">max_hops</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="c1"># Use parallelizer</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="n">parallelizer</span> <span class="o">=</span> <span class="n">GraphParallelizer</span><span class="p">(</span><span class="n">age_client</span><span class="p">)</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="n">neighbor_ids</span> <span class="o">=</span> <span class="n">parallelizer</span><span class="o">.</span><span class="n">get_nhop_neighbors</span><span class="p">(</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>        <span class="n">seed_ids</span><span class="o">=</span><span class="p">[</span><span class="n">positive_pole_id</span><span class="p">,</span> <span class="n">negative_pole_id</span><span class="p">],</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>        <span class="n">max_hops</span><span class="o">=</span><span class="n">max_hops</span><span class="p">,</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>        <span class="n">filter_clause</span><span class="o">=</span><span class="s2">&quot;candidate.embedding IS NOT NULL&quot;</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    <span class="p">)</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">neighbor_ids</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Performance Improvement:</strong> 3+ minutes  ~25 seconds (8x faster)</p>
<h3 id="example-2-neighborhood-queries-diversity-analysis">Example 2: Neighborhood Queries (Diversity Analysis)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># In api/services/diversity_analyzer.py</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_related_concepts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">concept_id</span><span class="p">,</span> <span class="n">max_hops</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="n">parallelizer</span> <span class="o">=</span> <span class="n">GraphParallelizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">)</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="n">related_ids</span> <span class="o">=</span> <span class="n">parallelizer</span><span class="o">.</span><span class="n">get_nhop_neighbors</span><span class="p">(</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>        <span class="n">seed_ids</span><span class="o">=</span><span class="p">[</span><span class="n">concept_id</span><span class="p">],</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>        <span class="n">max_hops</span><span class="o">=</span><span class="n">max_hops</span><span class="p">,</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>        <span class="n">filter_clause</span><span class="o">=</span><span class="s2">&quot;neighbor.embedding IS NOT NULL&quot;</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    <span class="p">)</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="k">return</span> <span class="n">related_ids</span>
</code></pre></div>
<h3 id="example-3-path-enrichment-web-ui">Example 3: Path Enrichment (Web UI)</h3>
<p><strong>Before (Sequential in React):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1">// web/src/views/ExplorerView.tsx:199</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">neighborhoods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="nx">nodeIds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">nodeId</span><span class="w"> </span><span class="p">=&gt;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">        </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">getSubgraph</span><span class="p">({</span><span class="w"> </span><span class="nx">center_concept_id</span><span class="o">:</span><span class="w"> </span><span class="kt">nodeId</span><span class="p">,</span><span class="w"> </span><span class="nx">depth</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="w"> </span><span class="p">})</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="p">);</span>
</code></pre></div></p>
<p><strong>After (Parallel in Backend):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># New endpoint: POST /query/enriched-path</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_enriched_path</span><span class="p">(</span><span class="n">from_id</span><span class="p">,</span> <span class="n">to_id</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="c1"># Get path</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="n">path</span> <span class="o">=</span> <span class="n">find_connection</span><span class="p">(</span><span class="n">from_id</span><span class="p">,</span> <span class="n">to_id</span><span class="p">)</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="c1"># Parallel neighborhood queries</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    <span class="n">parallelizer</span> <span class="o">=</span> <span class="n">GraphParallelizer</span><span class="p">(</span><span class="n">age_client</span><span class="p">)</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>    <span class="n">all_neighbors</span> <span class="o">=</span> <span class="n">parallelizer</span><span class="o">.</span><span class="n">get_nhop_neighbors</span><span class="p">(</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>        <span class="n">seed_ids</span><span class="o">=</span><span class="n">node_ids</span><span class="p">,</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>        <span class="n">max_hops</span><span class="o">=</span><span class="n">depth</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>    <span class="p">)</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    <span class="c1"># Fetch full nodes and return</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>    <span class="k">return</span> <span class="n">build_graph</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">nodes</span> <span class="o">+</span> <span class="n">all_neighbors</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">relationships</span><span class="p">)</span>
</code></pre></div></p>
<h2 id="safety-considerations">Safety Considerations</h2>
<h3 id="the-hilariously-bad-scenarios">The "Hilariously Bad" Scenarios</h3>
<p>Okay, so parallelization is great, but let me tell you about the ways this can go spectacularly, <em>exponentially</em> wrong if we're not careful. I'm talking "accidentally DoS your own database at 2am" wrong.</p>
<p><strong>Scenario 1: The Connection Pool Death Spiral</strong></p>
<p>Imagine this: You decide "more workers = faster!" and crank <code>max_workers</code> up to 100. Your code happily creates 100 threads, and each thread tries to grab a connection from the pool. But your pool only has 20 connections.</p>
<p>What happens? 20 threads get connections and start working. The other 80 threads sit there waiting. Forever. They never timeout because they're waiting on the pool's internal lock, not on a database query. Meanwhile, the 20 working threads finish and try to return their connections... but they can't, because the pool is deadlocked trying to satisfy the 80 waiting threads.</p>
<p><strong>Result:</strong> Your entire application freezes. No queries run. You've created a perfect deadlock. Congratulations, you've just invented a way to DoS yourself with <em>parallelism</em>.</p>
<p><strong>Scenario 2: The Exponential Query Explosion</strong></p>
<p>Let's say you're feeling clever and decide to parallelize 3-hop queries. "If 2-hop with 8 workers is good, 3-hop with nested parallelism must be better!"</p>
<p>Here's the math:
- Phase 1: Get 1-hop neighbors  200 concepts
- Phase 2: For each of 200 concepts, spawn 8 workers to get their neighbors  1,600 concurrent queries
- Phase 3: For each of <em>those</em> results (let's say 10,000 concepts), spawn 8 workers  <strong>80,000 concurrent queries</strong></p>
<p>Your database server: "Why do I hear boss music?"</p>
<p>Your connection pool (with 20 connections): <em>quiet sobbing</em></p>
<p>Your RAM: "I'm sorry, Dave. I'm afraid I can't do that."</p>
<p><strong>Result:</strong> You've just created an exponential explosion of concurrent work that will either exhaust connections, max out CPU, or fill RAM with millions of query results. The database doesn't crashit just gets slower and slower until every query is waiting for every other query, and your monitoring starts sending you alerts that look like a Christmas tree.</p>
<p><strong>Scenario 3: The Memory Cascade Failure</strong></p>
<p>Each worker finds 100 neighbors. You have 200 workers. That's 20,000 concept IDs returned. "Great!" you think. But then your code loads the <em>full</em> concept objects (with embeddings, descriptions, relationships) for all 20,000.</p>
<p>Each concept with embedding: ~4KB (1536 floats  4 bytes + metadata)
20,000 concepts  4KB = <strong>80MB</strong></p>
<p>Not too bad, right? But you're running this in a web request. And someone else is running a polarity analysis. And someone else is running a neighborhood query. And suddenly you've got 5 parallel operations each loading 80MB of concept data.</p>
<p>Python's garbage collector: "I'm working as fast as I can!"</p>
<p>Your API server: <em>OOM killed by Linux</em></p>
<p><strong>Result:</strong> Your API container gets OOM-killed, restarts, and immediately gets hit with the same queries again because they're in the retry queue. Welcome to the restart loop. Population: you, at 3am, wondering why you ever thought caching was optional.</p>
<p><strong>Scenario 4: The Thundering Herd Returns</strong></p>
<p>Remember ADR-049, where we solved the "100 concurrent API calls hit rate limits" problem? Imagine doing the exact same thing, but to your own database.</p>
<p>You spawn 100 workers, they all hit the database at once. PostgreSQL goes "okay, I can handle this... barely." But then:
- Each query takes 2 seconds
- During those 2 seconds, more polarity analyses start
- Each new analysis spawns 100 more workers
- You now have 400 concurrent database queries</p>
<p>PostgreSQL's connection limit: 100 connections
Your query count: 400 connections needed</p>
<p><strong>Result:</strong> 300 queries waiting for connections, blocking their threads, blocking your threadpool, cascading back to block your API endpoints. Your entire API becomes unresponsive. Your users think the site is down. Your monitoring thinks the database is down. The database is fineit's just laughing at you.</p>
<p><strong>How We Prevent All This (The Mitigations):</strong></p>
<p>These aren't just theoretical horror stories. This is what <em>will</em> happen if we ship this without guardrails. So here's how we keep the wheels on:</p>
<h4 id="1-global-semaphore-preventing-multi-user-deadlock">1. Global Semaphore (Preventing Multi-User Deadlock)</h4>
<p><strong>The Critical Bug in the Original Design:</strong></p>
<p>The original plan said "8 workers per request is safe with a 20-connection pool." But that only works for a <strong>single user</strong>. Here's what actually happens in production:</p>
<ul>
<li>User A starts polarity analysis: 1 main + 8 workers = <strong>9 connections</strong></li>
<li>User B starts polarity analysis: 1 main + 8 workers = <strong>9 connections</strong></li>
<li>Total: <strong>18/20 connections used</strong></li>
<li>User C (or a health check endpoint): <strong>BLOCKED</strong></li>
</ul>
<p>Two simultaneous analysts lock out the entire application. This is a showstopper bug.</p>
<p><strong>The Fix: Application-Level Global Semaphore</strong></p>
<p>We need to limit the total number of graph workers <strong>across the entire application</strong>, not per request:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># Global singleton semaphore (initialized once at app startup)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">_GRAPH_WORKER_SEMAPHORE</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_global_graph_semaphore</span><span class="p">(</span><span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">threading</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">:</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="sd">    Get or create the global graph worker semaphore.</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="sd">    This limits TOTAL concurrent graph workers across ALL requests.</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="k">global</span> <span class="n">_GRAPH_WORKER_SEMAPHORE</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>    <span class="k">if</span> <span class="n">_GRAPH_WORKER_SEMAPHORE</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>        <span class="n">_GRAPH_WORKER_SEMAPHORE</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">max_workers</span><span class="p">)</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    <span class="k">return</span> <span class="n">_GRAPH_WORKER_SEMAPHORE</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">GraphParallelizer</span><span class="p">:</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age_client</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ParallelQueryConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">age_client</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">ParallelQueryConfig</span><span class="p">()</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">global_semaphore</span> <span class="o">=</span> <span class="n">get_global_graph_semaphore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_workers</span><span class="p">)</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_1hop_neighbors_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed_id</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>        <span class="c1"># Acquire from GLOBAL semaphore, not per-request</span>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_semaphore</span><span class="p">:</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>            <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>                <span class="c1"># ... run query ...</span>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>            <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</code></pre></div>
<p><strong>How This Works:</strong></p>
<p>With <code>max_workers=8</code> globally:</p>
<ul>
<li>User A starts query: Acquires 8 slots from global semaphore</li>
<li>User B starts query: Tries to acquire 8 slots, but only 0 available  <strong>waits</strong></li>
<li>User A finishes: Releases 8 slots</li>
<li>User B proceeds: Acquires 8 slots</li>
</ul>
<p><strong>Graceful Degradation Option:</strong></p>
<p>Instead of blocking User B, we could degrade to sequential execution:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_nhop_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed_ids</span><span class="p">,</span> <span class="n">max_hops</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="c1"># Try to acquire workers from global pool</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="n">available_workers</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="n">acquired_slots</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_workers</span><span class="p">):</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_semaphore</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>            <span class="n">acquired_slots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>            <span class="n">available_workers</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>            <span class="k">break</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>    <span class="k">if</span> <span class="n">available_workers</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>        <span class="c1"># No workers available - degrade to sequential</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Global worker pool exhausted, running sequentially&quot;</span><span class="p">)</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequential_fallback</span><span class="p">(</span><span class="n">seed_ids</span><span class="p">,</span> <span class="n">max_hops</span><span class="p">)</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>    <span class="c1"># Use however many workers we got</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Acquired </span><span class="si">{</span><span class="n">available_workers</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_workers</span><span class="si">}</span><span class="s2"> workers&quot;</span><span class="p">)</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>    <span class="c1"># ... proceed with available_workers ...</span>
</code></pre></div>
<p><strong>Alternative: Dedicated Connection Pool</strong></p>
<p>Another approach is separate pools:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># Main API pool: 10 connections</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">main_pool</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">SimpleConnectionPool</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c1"># Graph worker pool: 10 connections</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="n">graph_worker_pool</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">SimpleConnectionPool</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div>
<p><strong>Benefit:</strong> API endpoints never hang even if graph workers are maxed out.</p>
<p><strong>Trade-off:</strong> More complex connection management, but better isolation.</p>
<p><strong>Recommended Configuration:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>Total PostgreSQL connections: 100
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>Main API pool: 10 connections
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>Graph worker pool: 10 connections (8 workers + 2 buffer)
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>Reserved for monitoring/admin: 5 connections
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>Result: 2 concurrent graph analyses can run without blocking API
</code></pre></div></p>
<h4 id="2-per-worker-result-limits-preventing-memory-explosions">2. Per-Worker Result Limits (Preventing Memory Explosions)</h4>
<p><strong>The Fix:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">max_results_per_worker</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Prevent runaway queries</span>
</code></pre></div></p>
<p>Each worker is allowed to return a maximum of 100 concepts. Why? Because if we have 200 workers and each one can return unlimited results, one "hub" concept with 10,000 neighbors could single-handedly blow up our memory.</p>
<p><strong>The Implementation:</strong></p>
<p>Every query we generate has a hard LIMIT clause:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">seed</span><span class="p">:</span><span class="n">Concept</span><span class="w"> </span><span class="p">{</span><span class="n">concept_id</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;abc123&#39;</span><span class="p">})</span><span class="o">-[]-</span><span class="p">(</span><span class="n">neighbor</span><span class="p">:</span><span class="n">Concept</span><span class="p">)</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">neighbor</span><span class="p">.</span><span class="n">embedding</span><span class="w"> </span><span class="n">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="k">RETURN</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">neighbor</span><span class="p">.</span><span class="n">concept_id</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="k">LIMIT</span><span class="w"> </span><span class="m">100</span><span class="w">  </span><span class="err">--</span><span class="w"> </span><span class="n">Hard</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">worker</span>
</code></pre></div>
<p>So even if a concept has 10,000 neighbors (looking at you, highly connected hub nodes), each worker only returns 100. This means:</p>
<ul>
<li>200 workers  100 results = 20,000 concepts maximum</li>
<li>20,000 concepts  4KB each = 80MB maximum memory</li>
<li>Totally manageable, even with multiple concurrent analyses</li>
</ul>
<p><strong>The Trade-off:</strong></p>
<p>"But what if I'm missing important concepts?" Fair question. Here's the thing: if a concept has 10,000 neighbors, the first 100 are going to be pretty representative. You're not losing critical informationyou're avoiding exponential explosion for marginal gains. And remember, we're usually looking for concepts with embeddings for similarity analysis. Those 100 are likely the most relevant anyway (if we're smart about ordering, which we can be).</p>
<h4 id="3-timeouts-preventing-infinite-waits">3. Timeouts (Preventing Infinite Waits)</h4>
<p><strong>The Fix:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># Kill slow workers</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="c1"># In executor</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">futures</span> <span class="o">=</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Per-future timeout</span>
</code></pre></div></p>
<p>We have two levels of timeouts:</p>
<ol>
<li>
<p><strong>Batch timeout (30s):</strong> The entire parallel batch must complete within 30 seconds. If it doesn't, we stop waiting for stragglers and return what we have.</p>
</li>
<li>
<p><strong>Per-worker timeout (5s):</strong> Each individual worker gets 5 seconds to complete its query. If a query is still running after 5 seconds, something's wrong (probably hit a super-connected hub node), and we kill it.</p>
</li>
</ol>
<p><strong>Why This Matters:</strong></p>
<p>Without timeouts, one pathological query can block your entire parallelizer. Imagine:
- Worker 1-7: Complete in 2 seconds each 
- Worker 8: Hits a concept with 100,000 neighbors, takes 5 minutes </p>
<p>With timeouts, worker 8 gets killed after 5 seconds, and we return the results from workers 1-7. You get 87.5% of your data in 5 seconds instead of 100% of your data in 5 minutes. That's a trade worth making.</p>
<h4 id="4-graceful-degradation-partial-results-are-ok">4. Graceful Degradation (Partial Results Are OK)</h4>
<p><strong>The Philosophy:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    <span class="n">neighbors</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>    <span class="n">all_neighbors</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="k">except</span> <span class="ne">TimeoutError</span><span class="p">:</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker failed for </span><span class="si">{</span><span class="n">neighbor_id</span><span class="si">}</span><span class="s2">, skipping&quot;</span><span class="p">)</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>    <span class="c1"># Continue with other workers - partial results OK</span>
</code></pre></div>
<p>Here's a key insight: for graph discovery queries, <strong>partial results are perfectly acceptable</strong>. If we're discovering 20 candidate concepts for a polarity analysis, and one worker fails, we still have 19 concepts. That's enough to do meaningful analysis.</p>
<p>This is different from, say, a database transaction where you need all-or-nothing. Graph exploration is inherently fuzzyyou're sampling the graph, not enumerating it exhaustively. So we embrace partial failures:</p>
<ul>
<li>Worker succeeds  add its results to the set</li>
<li>Worker times out  log a warning, keep going</li>
<li>Worker crashes  log an error, keep going</li>
<li>All workers fail  okay, <em>now</em> we return an error</li>
</ul>
<p>This makes the system resilient. One bad concept with pathological connectivity can't bring down the entire analysis.</p>
<h4 id="5-security-parameter-binding-preventing-cypher-injection">5. Security: Parameter Binding (Preventing Cypher Injection)</h4>
<p><strong>The Vulnerability:</strong></p>
<p>The original implementation used f-strings to build Cypher queries:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="s2">    MATCH (seed:Concept </span><span class="se">{{</span><span class="s2">concept_id: &#39;</span><span class="si">{</span><span class="n">seed_id</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">}}</span><span class="s2">)...</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="s2">&quot;&quot;&quot;</span>
</code></pre></div>
<p>Even with <code>validate_concept_id()</code>, this is technically a <strong>Cypher injection vulnerability</strong>. If validation has a bug, or if IDs come from a different source, an attacker could inject:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">seed_id</span> <span class="o">=</span> <span class="s2">&quot;abc&#39;})-[:ADMIN]-&gt;(u:User) WHERE u.username=&#39;admin&#39; SET u.password=&#39;&quot;</span>
</code></pre></div>
<p><strong>The Limitation:</strong></p>
<p>AGE's <code>ag_catalog.cypher()</code> function takes a Cypher string literal. Unlike regular SQL with <code>%s</code> placeholders, we can't easily pass parameters <em>into</em> the Cypher string from psycopg2.</p>
<p><strong>The Solution: Strict Validation + Safe Escaping</strong></p>
<ol>
<li>
<p><strong>Allowlist Validation:</strong> Only allow alphanumeric, underscores, hyphens, and colons:
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_concept_id</span><span class="p">(</span><span class="n">concept_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9_\-:]+$&#39;</span><span class="p">,</span> <span class="n">concept_id</span><span class="p">):</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid concept ID format&quot;</span><span class="p">)</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Parameter Binding Where Possible:</strong> Use the Cypher <code>$param</code> syntax inside the string:
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="s2">    SELECT * FROM ag_catalog.cypher(&#39;concept&#39;, $$</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="s2">        MATCH (seed:Concept)-[]-(neighbor:Concept)</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="s2">        WHERE seed.concept_id IN $seed_ids</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="s2">        RETURN DISTINCT neighbor.concept_id</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="s2">    $$) as (concept_id agtype);</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="c1"># Pass seed_ids as psycopg2 parameter (safe)</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;seed_ids&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">seed_ids</span><span class="p">)})</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Escape Single Quotes:</strong> If we must use f-strings, escape any quotes:
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">seed_id_safe</span> <span class="o">=</span> <span class="n">seed_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&#39;&quot;</span><span class="p">)</span>  <span class="c1"># SQL escaping</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (seed </span><span class="se">{{</span><span class="s2">concept_id: &#39;</span><span class="si">{</span><span class="n">seed_id_safe</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">}}</span><span class="s2">)&quot;</span>
</code></pre></div></p>
</li>
</ol>
<p><strong>Recommended Approach:</strong></p>
<p>Use chunking (as described above), which allows us to pass lists via parameterized queries instead of individual f-string interpolation.</p>
<h4 id="6-wall-clock-timeout-strictly-bounded-execution">6. Wall-Clock Timeout (Strictly Bounded Execution)</h4>
<p><strong>The Bug:</strong></p>
<p>The original code used:
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Problem:</strong> <code>as_completed(timeout=30)</code> only times out if it's waiting for the <em>next</em> result, not for the <em>total</em> execution time. If you have 8 workers that each take 29 seconds, <code>as_completed</code> never times out because results keep arriving.</p>
<p><strong>The Fix: Track Deadline</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_get_2hop_neighbors_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hop1_neighbors</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>    <span class="n">deadline</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeout_seconds</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>    <span class="n">all_neighbors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>        <span class="n">futures</span> <span class="o">=</span> <span class="p">{</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="o">...</span><span class="p">):</span> <span class="n">nid</span> <span class="k">for</span> <span class="n">nid</span> <span class="ow">in</span> <span class="n">hop1_neighbors</span><span class="p">}</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>        <span class="k">while</span> <span class="n">futures</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">deadline</span><span class="p">:</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>            <span class="c1"># Calculate remaining time</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>            <span class="n">remaining</span> <span class="o">=</span> <span class="n">deadline</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>            <span class="k">if</span> <span class="n">remaining</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Wall-clock timeout reached, returning partial results&quot;</span><span class="p">)</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>                <span class="k">break</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>            <span class="c1"># Wait for next result with adjusted timeout</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>                <span class="n">done</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>                    <span class="n">futures</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>                    <span class="n">timeout</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">remaining</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>  <span class="c1"># At most 5s per iteration</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>                    <span class="n">return_when</span><span class="o">=</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>                <span class="p">)</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>                <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>                    <span class="n">nid</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>                        <span class="n">neighbors</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Already done</span>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>                        <span class="n">all_neighbors</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker failed for </span><span class="si">{</span><span class="n">nid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>            <span class="k">except</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>                <span class="c1"># No results ready yet, loop will check deadline</span>
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>                <span class="k">pass</span>
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a>        <span class="c1"># Cancel any remaining workers if we hit deadline</span>
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a>        <span class="k">if</span> <span class="n">futures</span><span class="p">:</span>
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cancelling </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span><span class="si">}</span><span class="s2"> slow workers due to timeout&quot;</span><span class="p">)</span>
<a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a>            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">:</span>
<a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a>                <span class="n">future</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
<a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a>
<a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a>    <span class="k">return</span> <span class="n">all_neighbors</span>
</code></pre></div>
<p><strong>Benefit:</strong> Guarantees total execution time  <code>timeout_seconds</code>, regardless of worker count or individual query times.</p>
<h4 id="7-database-side-safety">7. Database-Side Safety</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1">-- PostgreSQL connection limits (already configured)</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">max_connections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="n">superuser_reserved_connections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="c1">-- AGE client pool (already configured)</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="n">minconn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="n">maxconn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="w">  </span><span class="c1">-- Conservative default</span>
</code></pre></div>
<p><strong>Rule of Thumb:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>max_workers  (connection_pool_size - 2)
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>max_workers = 8  (default safe)
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>max_workers = 16 (if pool_size  18)
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>max_workers = 32 (if pool_size  34, requires tuning)
</code></pre></div></p>
<h2 id="configuration-management">Configuration Management</h2>
<h3 id="database-first-like-adr-049">Database-First (Like ADR-049)</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1">-- Migration 020: Add parallel query configuration</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">kg_api</span><span class="p">.</span><span class="n">ai_extraction_config</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">parallel_query_max_workers</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">8</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">    </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">parallel_query_max_workers</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">parallel_query_max_workers</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">kg_api</span><span class="p">.</span><span class="n">ai_extraction_config</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">parallel_query_timeout_seconds</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">    </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">parallel_query_timeout_seconds</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">parallel_query_timeout_seconds</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">120</span><span class="p">);</span>
</code></pre></div>
<h3 id="loading-config">Loading Config</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_parallel_config</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ParallelQueryConfig</span><span class="p">:</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load configuration from database (ADR-041/049 pattern)&quot;&quot;&quot;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>        <span class="c1"># Try database first</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT parallel_query_max_workers, parallel_query_timeout_seconds ...&quot;</span><span class="p">)</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>        <span class="k">return</span> <span class="n">ParallelQueryConfig</span><span class="p">(</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>            <span class="n">max_workers</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;parallel_query_max_workers&#39;</span><span class="p">],</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>            <span class="n">timeout_seconds</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;parallel_query_timeout_seconds&#39;</span><span class="p">]</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>        <span class="p">)</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>    <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>        <span class="c1"># Fallback to environment variables</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>        <span class="k">return</span> <span class="n">ParallelQueryConfig</span><span class="p">(</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>            <span class="n">max_workers</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;PARALLEL_QUERY_MAX_WORKERS&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)),</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>            <span class="n">timeout_seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;PARALLEL_QUERY_TIMEOUT_SECONDS&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>        <span class="p">)</span>
</code></pre></div>
<h2 id="performance-estimates">Performance Estimates</h2>
<h3 id="polarity-discovery-max_hops2-20-candidates">Polarity Discovery (max_hops=2, 20 candidates)</h3>
<table>
<thead>
<tr>
<th>Configuration</th>
<th>Estimated Time</th>
<th>Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Current (sequential)</strong></td>
<td>180s (3 min)</td>
<td>1x baseline</td>
</tr>
<tr>
<td><strong>Parallel (4 workers)</strong></td>
<td>45s</td>
<td>4x faster</td>
</tr>
<tr>
<td><strong>Parallel (8 workers)</strong></td>
<td>22s</td>
<td>8x faster</td>
</tr>
<tr>
<td><strong>Parallel (16 workers)</strong></td>
<td>11s</td>
<td>16x faster</td>
</tr>
<tr>
<td><strong>Parallel (32 workers)</strong></td>
<td>6s</td>
<td>30x faster</td>
</tr>
</tbody>
</table>
<p><strong>Assumptions:</strong>
- 100 1-hop neighbors per pole
- 2s per 1-hop query
- Database can handle concurrent load
- Connection pool has capacity</p>
<h3 id="neighborhood-queries-diversity-analysis">Neighborhood Queries (diversity analysis)</h3>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Current</th>
<th>Parallel (8 workers)</th>
<th>Improvement</th>
</tr>
</thead>
<tbody>
<tr>
<td>1-hop</td>
<td>~500ms</td>
<td>~500ms</td>
<td>No change (already fast)</td>
</tr>
<tr>
<td>2-hop</td>
<td>~8s</td>
<td>~2s</td>
<td><strong>4x faster</strong></td>
</tr>
<tr>
<td>3-hop</td>
<td>~60s</td>
<td>~15s</td>
<td><strong>4x faster</strong></td>
</tr>
</tbody>
</table>
<h2 id="testing-strategy">Testing Strategy</h2>
<h3 id="unit-tests">Unit Tests</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_parallel_nhop_neighbors</span><span class="p">():</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test parallel 2-hop neighbor discovery&quot;&quot;&quot;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>    <span class="n">parallelizer</span> <span class="o">=</span> <span class="n">GraphParallelizer</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">ParallelQueryConfig</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>    <span class="n">neighbors</span> <span class="o">=</span> <span class="n">parallelizer</span><span class="o">.</span><span class="n">get_nhop_neighbors</span><span class="p">(</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>        <span class="n">seed_ids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;concept1&#39;</span><span class="p">,</span> <span class="s1">&#39;concept2&#39;</span><span class="p">],</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>        <span class="n">max_hops</span><span class="o">=</span><span class="mi">2</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>    <span class="p">)</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>    <span class="k">assert</span> <span class="s1">&#39;concept1&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">neighbors</span>  <span class="c1"># Seeds excluded</span>
</code></pre></div>
<h3 id="integration-tests">Integration Tests</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_polarity_discovery_parallel</span><span class="p">():</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare sequential vs parallel performance&quot;&quot;&quot;</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>    <span class="c1"># Sequential</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>    <span class="n">sequential_results</span> <span class="o">=</span> <span class="n">discover_candidate_concepts_sequential</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>    <span class="n">sequential_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>    <span class="c1"># Parallel</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>    <span class="n">parallel_results</span> <span class="o">=</span> <span class="n">discover_candidate_concepts_parallel</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>    <span class="n">parallel_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>    <span class="c1"># Same results</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">sequential_results</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">parallel_results</span><span class="p">)</span>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>    <span class="c1"># Faster (at least 2x for max_hops=2)</span>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>    <span class="k">assert</span> <span class="n">parallel_time</span> <span class="o">&lt;</span> <span class="n">sequential_time</span> <span class="o">/</span> <span class="mi">2</span>
</code></pre></div>
<h3 id="load-tests">Load Tests</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_connection_pool_saturation</span><span class="p">():</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Verify workers don&#39;t exhaust connection pool&quot;&quot;&quot;</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>    <span class="c1"># Simulate 100 concurrent queries</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>    <span class="n">parallelizer</span> <span class="o">=</span> <span class="n">GraphParallelizer</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">ParallelQueryConfig</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">32</span><span class="p">))</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>    <span class="c1"># Should not deadlock or fail</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">parallelizer</span><span class="o">.</span><span class="n">get_nhop_neighbors</span><span class="p">(</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>        <span class="n">seed_ids</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)),</span>  <span class="c1"># Many seeds</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>        <span class="n">max_hops</span><span class="o">=</span><span class="mi">2</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>    <span class="p">)</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>    <span class="c1"># Should complete without errors</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div>
<h2 id="implementation-plan">Implementation Plan</h2>
<h3 id="phase-1-core-parallelizer-week-1">Phase 1: Core Parallelizer (Week 1)</h3>
<ul>
<li>[ ] Implement <code>GraphParallelizer</code> class</li>
<li>[ ] Add configuration schema (migration 020)</li>
<li>[ ] Write unit tests</li>
<li>[ ] Document API</li>
</ul>
<h3 id="phase-2-polarity-integration-week-2">Phase 2: Polarity Integration (Week 2)</h3>
<ul>
<li>[ ] Update <code>discover_candidate_concepts()</code> to use parallelizer</li>
<li>[ ] Add performance logging</li>
<li>[ ] Test with max_hops=1,2,3</li>
<li>[ ] Update issue #155 with results</li>
</ul>
<h3 id="phase-3-neighborhood-queries-week-3">Phase 3: Neighborhood Queries (Week 3)</h3>
<ul>
<li>[ ] Update <code>DiversityAnalyzer</code> to use parallelizer</li>
<li>[ ] Update related concepts endpoint</li>
<li>[ ] Performance benchmarks</li>
</ul>
<h3 id="phase-4-path-enrichment-week-4">Phase 4: Path Enrichment (Week 4)</h3>
<ul>
<li>[ ] Create enriched path endpoint</li>
<li>[ ] Update web UI to use new endpoint</li>
<li>[ ] End-to-end testing</li>
</ul>
<h3 id="phase-5-monitoring-tuning-week-5">Phase 5: Monitoring &amp; Tuning (Week 5)</h3>
<ul>
<li>[ ] Add performance metrics</li>
<li>[ ] Connection pool monitoring</li>
<li>[ ] Auto-tuning recommendations</li>
<li>[ ] Production deployment</li>
</ul>
<h2 id="alternatives-considered">Alternatives Considered</h2>
<h3 id="option-a-postgresql-parallel-workers">Option A: PostgreSQL Parallel Workers</h3>
<p><strong>Pros:</strong> Native parallelism
<strong>Cons:</strong> Doesn't work with AGE Cypher queries (they're function calls)
<strong>Decision:</strong> Rejected</p>
<h3 id="option-b-asyncawait-asyncio">Option B: Async/Await (asyncio)</h3>
<p><strong>Pros:</strong> Python-native async
<strong>Cons:</strong> psycopg2 is blocking (would need psycopg3 or aiopg)
<strong>Decision:</strong> Rejected (too much refactoring)</p>
<h3 id="option-c-distributed-queue-celery">Option C: Distributed Queue (Celery)</h3>
<p><strong>Pros:</strong> Battle-tested, scales horizontally
<strong>Cons:</strong> Massive complexity, external dependencies (Redis/RabbitMQ)
<strong>Decision:</strong> Rejected (overkill for current scale)</p>
<h3 id="option-d-graphql-dataloader-pattern">Option D: GraphQL DataLoader Pattern</h3>
<p><strong>Pros:</strong> Batch + cache
<strong>Cons:</strong> Designed for request-scoped batching, not multi-hop traversal
<strong>Decision:</strong> Rejected (different use case)</p>
<h2 id="future-enhancements">Future Enhancements</h2>
<h3 id="phase-2-3-hop-parallelization">Phase 2: 3-Hop Parallelization</h3>
<p>Extend to 3 hops with nested parallelization:
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>1-hop: Single query
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>2-hop: Parallel (8 workers)
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>3-hop: Nested parallel (8  8 = 64 sub-workers)
</code></pre></div></p>
<h3 id="phase-3-query-result-caching">Phase 3: Query Result Caching</h3>
<p>Cache 1-hop neighbor results for frequently queried concepts:
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_cached_1hop_neighbors</span><span class="p">(</span><span class="n">concept_id</span><span class="p">):</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>    <span class="k">return</span> <span class="n">_get_1hop_neighbors_uncached</span><span class="p">(</span><span class="n">concept_id</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="phase-4-adaptive-worker-count">Phase 4: Adaptive Worker Count</h3>
<p>Automatically adjust worker count based on query load:
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_optimal_workers</span><span class="p">(</span><span class="n">query_count</span><span class="p">,</span> <span class="n">avg_query_time</span><span class="p">):</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>    <span class="c1"># More workers for large batches, fewer for small</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">query_count</span> <span class="o">//</span> <span class="mi">10</span><span class="p">))</span>
</code></pre></div></p>
<h2 id="open-questions">Open Questions</h2>
<ol>
<li><strong>Connection pool sizing:</strong> Should we increase default pool size from 20 to 40?</li>
<li><strong>Worker count tuning:</strong> Start with 8 or go aggressive with 16?</li>
<li><strong>Timeout handling:</strong> Should timeout kill entire batch or just slow workers?</li>
<li><strong>Result ordering:</strong> Does order matter for candidate discovery?</li>
<li><strong>Caching layer:</strong> Worth adding Redis cache for 1-hop neighbors?</li>
</ol>
<h2 id="references">References</h2>
<ul>
<li><strong>Issue #155:</strong> Polarity Candidate Discovery Optimization</li>
<li><strong>ADR-049:</strong> Rate Limiting and Per-Provider Concurrency</li>
<li><strong>ADR-050:</strong> Scheduled Jobs System (Worker Pattern)</li>
<li><strong>PostgreSQL Parallel Query:</strong> https://www.postgresql.org/docs/current/how-parallel-query-works.html</li>
<li><strong>Python ThreadPoolExecutor:</strong> https://docs.python.org/3/library/concurrent.futures.html</li>
<li><strong>psycopg2 Connection Pooling:</strong> https://www.psycopg.org/docs/pool.html</li>
</ul>
<hr />
<p><strong>Last Updated:</strong> 2025-12-01
<strong>Next Steps:</strong> Review with team, validate approach, begin Phase 1 implementation</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>